<html>
<head>
  <title>CGView</title>
  <!-- <script src="http://code.jquery.com/jquery&#45;1.11.1.min.js"></script> -->
  <script src="javascript/jquery-1.11.1.min.js"></script>
  <!-- Local -->
  <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
  <script src="javascript/d3.v4.min.js"></script>
  <!-- <script src='src/jspectra_viewer.js'></script> -->
  <script src='dev/Viewer.js'></script>
  <script src='dev/Viewer-Drag.js'></script>
  <script src='dev/Viewer-Zoom.js'></script>
  <script src='dev/Canvas.js'></script>
  <script src='dev/Ruler.js'></script>
  <script src='dev/IO.js'></script>
  <script src='dev/CGArray.js'></script>
  <script src='dev/FeatureSlot.js'></script>
  <script src='dev/Feature.js'></script>
  <script src='dev/ArcPlot.js'></script>
  <script src='dev/Legend.js'></script>
  <script src='dev/LegendItem.js'></script>
  <script src='dev/Debug.js'></script>
  <script src='dev/Color.js'></script>
  <script src='dev/ColorPicker.js'></script>
  <script src='dev/Font.js'></script>
  <script src='dev/Utils.js'></script>

  <script src="javascript/xml2json.min.js"></script>
  <script src="javascript/canvas2svg.js"></script>
  <script src="javascript/colorpicker.js"></script>
  <link rel="stylesheet" href="stylesheets/cgview.css" />
  <style type="text/css">
    #picker-wrapper {
      width: 100px;
      height: 100px;
      position: relative;
      display: inline-block;
      border: 1px black solid;
      cursor: pointer;
    }
    #picker-indicator {
      width: 3px;
      height: 3px;
      position: absolute;
      border: 1px solid white;
    }
    #slider-wrapper {
      width: 20px;
      height: 100px;
      position: relative;
      display: inline-block;
      border: 1px black solid;
      cursor: pointer;
    }
    #slider-indicator {
      /* width: 100%; */
      left: -2;
      width: 22px; 
      height: 3px;
      position: absolute;
      border: 1px solid black;
    }
    #alpha-wrapper {
      width: 120px;
      height: 10px;
      position: relative;
      display: block;
      border: 1px black solid;
      cursor: pointer;
    }
    #alpha-indicator {
      /* width: 100%; */
      /* left: -2; */
      width: 5px; 
      height: 100%;
      position: absolute;
      border: 1px solid black;
    }
  </style>
</head>
<body>
  <div id='cgview'></div>
  <a id='download-svg' href='#'>SVG</a>
  <a href='docs/index.html'>Docs</a>
  <div id='svg-out'></div>
  <!-- <div id="picker&#45;wrapper"> -->
  <!--   <div id="picker"></div> -->
  <!--   <div id="picker&#45;indicator"></div> -->
  <!-- </div> -->
  <!-- <div id="slider&#45;wrapper"> -->
  <!--   <div id="slider"></div> -->
  <!--   <div id="slider&#45;indicator"></div> -->
  <!-- </div> -->
  <!-- <div id="alpha&#45;wrapper"> -->
  <!--   <div id="alpha"></div> -->
  <!--   <div id="alpha&#45;indicator"></div> -->
  <!-- </div> -->

  <div id='my-color-picker'></div>
  <script>
    var cgv = new CGV.Viewer('#cgview', {
      // width: 1000,
      // width: 1500,
      // height: 950,
      debug: true
    });
    window.cgv = cgv;
    cgv.flash('Loading...');

    $.ajax({
      // url: 'data/cgview_1_no_cg.json',
      // url: 'data/TEST_cgview_1.json',
      // url: 'data/cgview_1.json',
      url: 'data/cgview_legends.json',
      // url: 'data/cgview_3.json',
      // url: 'data/cgview-94889.json',
      dataType: 'json',
      success: function(json) {
        console.log('loading...')
        window.data = json;
        cgv.load_json(json.cgview);
        console.log('done!');
        cgv.draw();
        var color = cgv.swatchedLegendItems(1)._swatchColor;
        // cp.setRgb({r: color.rgb.r, g: color.rgb.g, b: color.rgb.b});
        // cp.hsv = color.hsv;
        // cp.opacity = color.opacity;
        // cp.updateIndicators();
      },
      error: function(xhr, status, error) {
        console.log(status)
        console.log(error)
      }
    });

    $('#download-svg').on('click', function() {
      var origCtx = cgv.canvas.ctx;
      var ctx = new C2S(1200, 1200);
      cgv.canvas.ctx = ctx;
      cgv.draw_full();
      var svg = ctx.getSerializedSvg();
      $('#svg-out').html(svg);
      cgv.canvas.ctx = origCtx;
    });

    // ColorPicker.fixIndicators(
    //   document.getElementById('slider-indicator'),
    //   document.getElementById('picker-indicator'));
    // var cp2 = ColorPicker(
    //   document.getElementById('slider'),
    //   document.getElementById('picker'),
    //   document.getElementById('alpha'),
    //   function(hex, hsv, rgb, pickerCoordinate, sliderCoordinate) {
    //     ColorPicker.positionIndicators(
    //       document.getElementById('slider-indicator'),
    //       document.getElementById('picker-indicator'),
    //       sliderCoordinate, pickerCoordinate
    //     );
    //     // cgv.swatchedLegendItems(1).swatchColor = 'rgb(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ')';
    //     // cgv.draw_fast()
    //   });

      // var cp = new CGV.ColorPicker('my-color-picker', {
      //   onChange: function(color) {
      //     // console.log(color.hsv)
      //     cgv.swatchedLegendItems(1).swatchColor = color.rgbaString;
      //     cgv.draw_fast();
      //
      //   }
      // });

  </script>
</body>
