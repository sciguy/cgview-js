<html>
<head>
  <title>CGView</title>
  <meta charset="UTF-8">
  <!-- <script src="http://code.jquery.com/jquery&#45;1.11.1.min.js"></script> -->
  <script src="javascript/jquery-1.11.1.min.js"></script>
  <!-- Local -->
  <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
  <script src="javascript/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-selection-multi.v0.4.min.js"></script>

  <!-- CGView ES5 -->
  <!-- <script src='src/CGView.min.js'></script> -->
  <!-- CGView CONCATENATED -->
  <!-- <script src='src/CGView.js'></script> -->
  <!-- CGView DEV -->
  <script src='dev/Viewer.js'></script>
  <script src='dev/Viewer-Drag.js'></script>
  <script src='dev/Viewer-Zoom.js'></script>
  <script src='dev/CGObject.js'></script>
  <script src='dev/Sequence.js'></script>
  <script src='dev/SequenceExtractor.js'></script>
  <script src='dev/Events.js'></script>
  <script src='dev/EventMonitor.js'></script>
  <script src='dev/Canvas.js'></script>
  <script src='dev/Backbone.js'></script>
  <script src='dev/Ruler.js'></script>
  <script src='dev/IO.js'></script>
  <script src='dev/Layout.js'></script>
  <script src='dev/CGArray.js'></script>
  <script src='dev/CGRange.js'></script>
  <script src='dev/NCList.js'></script>
  <script src='dev/Slot.js'></script>
  <script src='dev/Track.js'></script>
  <script src='dev/Settings.js'></script>
  <script src='dev/Divider.js'></script>
  <script src='dev/Feature.js'></script>
  <script src='dev/FeatureType.js'></script>
  <script src='dev/Messenger.js'></script>
  <script src='dev/Highlighter.js'></script>
  <script src='dev/Label.js'></script>
  <script src='dev/Annotation.js'></script>
  <script src='dev/Plot.js'></script>
  <script src='dev/Caption.js'></script>
  <script src='dev/CaptionItem.js'></script>
  <script src='dev/Legend.js'></script>
  <script src='dev/LegendItem.js'></script>
  <script src='dev/Debug.js'></script>
  <script src='dev/Color.js'></script>
  <script src='dev/ColorPicker.js'></script>
  <script src='dev/Font.js'></script>
  <script src='dev/Rect.js'></script>
  <script src='dev/Utils.js'></script>
  <script src='dev/WorkerFeatureExtraction.js'></script>
  <script src='dev/WorkerPlotExtraction.js'></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0&#45;alpha.6/css/bootstrap.min.css" integrity="sha384&#45;rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"> -->
  <link rel="stylesheet" href="stylesheets/cgview.css" />
  <style>
    div#main {
      margin-top: 55px;
      margin-left: 5px;
    }
  </style>
</head>
<body>

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-nav" aria-expanded="false">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">CGView.js</a>
			</div>
			<div class="collapse navbar-collapse" id="main-nav">
				<ul class="nav navbar-nav">
					<li class='active'><a href="#">Demo</a></li>
					<li><a href="docs/index.html">Docs</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Tutorials <span class="caret"></span></a>
            <ul class="dropdown-menu">
              <li><a href="docs/basic_map.html">Basic Map</a></li>
              <li><a href="docs/sequence_map.html">Sequence Map</a></li>
              <li><a href="#">JSON Map</a></li>
            </ul>
          </li>
				</ul>
			</div>
		</div>
	</div>

	<div id='main'>
		<div id='cgview'></div>
		<!-- <a id='download&#45;svg' href='#'>SVG</a> -->
    <div style='margin-top: 5px;'>
      <a class='btn btn-default btn-xs' href='http://wishart.biology.ualberta.ca/cgview/xml_overview.html'>XML</a>
      <a class='btn btn-default btn-xs' href='http://stothard.afns.ualberta.ca/cgview_server/'>P-Server</a>
      <a class='btn btn-default btn-xs' href='http://localhost:3010'>J-Server</a>
      <a class='btn btn-default btn-xs' id='save-600' href='#'>Download-600</a>
      <a class='btn btn-default btn-xs' id='save-1200' href='#'>Download-1200</a>
      <a class='btn btn-default btn-xs' id='save-3000' href='#'>Download-3000</a>
    </div>
		<div id='svg-out'></div>
  </div>

  <script>

    var demo = false;
    // var demo = true;

    if (demo) {

      cgv = new CGV.Viewer('#cgview', {
        height: 500,
        width: 500,
        debug: {sections: ['time', 'position']},
        sequence: {
          length: 1000
        }
      });



      new CGV.Feature(cgv, {
        type: 'CDS',
        label: 'My Feature Name',
        start: 100,
        stop: 250,
        strand: 1,
        source: 'genome-features',
        legend: 'CDS'
      });

      new CGV.Feature(cgv, {
        type: 'CDS',
        label: 'Another Feature',
        start: 400,
        stop: 750,
        strand: -1,
        source: 'genome-features',
        legend: 'CDS'
      });

      var positions = [];
      var scores = [];
      var currentScore = 0.5;
      for (var i = 1, len = 1000; i < len; i++) {
        positions.push(i);
        currentScore += (currentScore > Math.random()) ? -0.01 : 0.01;
        scores.push( currentScore );
      }

      positions = [50, 200, 400, 500, 600, 800]
      scores = [0.4, 0.75, 0.25, 0.5, 0.6, 0.1]
      // positions = [1, 50, 200, 400, 500, 600, 800]
      // scores = [0.6, 0.4, 0.75, 0.25, 0.5, 0.6, 0.1]

      var p = new CGV.Plot(cgv, {
        positions: positions,
        scores: scores,
        baseline: 0.5,
        source: 'genome-plot'
      });

      // p.legendItem = new CGV.LegendItem(cgv.legend, {swatchColor: 'blue', text: 'Plot'});
      p.legendItemPositive = new CGV.LegendItem(cgv.legend, {swatchColor: 'blue', text: '+ Plot'});
      p.legendItemNegative = new CGV.LegendItem(cgv.legend, {swatchColor: 'red', text: '- Plot'});

      new CGV.Track(cgv.layout, {
        name: 'My track',
        readingFrame: 'combined',
        strand: 'separated',
        position: 'both',
        contents: {
          features: {
            source: 'genome-features'
          }
        }
      });

      new CGV.Track(cgv.layout, {
        name: 'My Plot Track',
        position: 'inside',
        contents: {
          plot: {
            source: 'genome-plot'
          }
        }
      });

      cgv.drawFull();
      cgv.canvas._testDrawRange = true;
    } else {

    var cgv = new CGV.Viewer('#cgview', {
      // width: 1000,
      // width: 1300,
      // height: 950,
      // debug: true
      debug: {sections: ['time', 'position']}
    });
    window.cgv = cgv;
    cgv.flash('Loading...');

    $.ajax({
      // url: 'data/cgview_1.json',
      // url: 'JSON_FORMAT.json',
      url: 'data/tests/builder.json',
      dataType: 'json',
      success: function(json) {
        console.log('loading...')
        window.data = json;
        // cgv.load_json(json.cgview);
        cgv.io.loadJSON(json.cgview);
        console.log('done!');
        $(window).trigger('resize');
        cgv.draw();
      },
      error: function(xhr, status, error) {
        console.log(status)
        console.log(error)
      }
    });

}

    $('#save-600').on('click', function() { cgv.io.exportImage(600,600); return false });
    $('#save-1200').on('click', function() { cgv.io.exportImage(1200,1200); return false });
    $('#save-3000').on('click', function() { cgv.io.exportImage(3000,3000); return false });

    // Resizing
    $(window).resize(function() {
      var width = window.innerWidth - 20;
      var height = window.innerHeight - 100;
      var dimension = Math.min(width, height);
      cgv.resize(dimension, dimension);
    });

  </script>
</body>
