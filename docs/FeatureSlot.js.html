<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>CGView.js</title>
    
    
    
    
    
    <meta property="og:title" content=""/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content=""/>
    
    <meta property="og:url" content=""/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"CGView.js","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"CGView.js","description":"","keyword":""},"linenums":false};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation">
    <h3 class="applicationName"><a href="index.html">CGView.js</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="ArcPlot">
            <span class="title">
                <a href="ArcPlot.html">ArcPlot</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="ArcPlot#featureSlot"><a href="ArcPlot.html#featureSlot">featureSlot</a></li>
            
                <li data-name="ArcPlot#viewer"><a href="ArcPlot.html#viewer">viewer</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Canvas">
            <span class="title">
                <a href="Canvas.html">Canvas</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Canvas#clear"><a href="Canvas.html#clear">clear</a></li>
            
                <li data-name="Canvas#flash"><a href="Canvas.html#flash">flash</a></li>
            
                <li data-name="Canvas#maximumVisibleRadius"><a href="Canvas.html#maximumVisibleRadius">maximumVisibleRadius</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Color">
            <span class="title">
                <a href="Color.html">Color</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Color#color"><a href="Color.html#color">color</a></li>
            
                <li data-name="Color#color"><a href="Color.html#color">color</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Color.hexToRgba"><a href="Color.html#.hexToRgba">hexToRgba</a></li>
            
                <li data-name="Color.hexToRgba"><a href="Color.html#.hexToRgba">hexToRgba</a></li>
            
                <li data-name="Color.hslToRgba"><a href="Color.html#.hslToRgba">hslToRgba</a></li>
            
                <li data-name="Color.nameToRgba"><a href="Color.html#.nameToRgba">nameToRgba</a></li>
            
                <li data-name="Color.rgbToRgba"><a href="Color.html#.rgbToRgba">rgbToRgba</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Feature">
            <span class="title">
                <a href="Feature.html">Feature</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Feature#color"><a href="Feature.html#color">color</a></li>
            
                <li data-name="Feature#decoration"><a href="Feature.html#decoration">decoration</a></li>
            
                <li data-name="Feature#featureSlot"><a href="Feature.html#featureSlot">featureSlot</a></li>
            
                <li data-name="Feature#legendItem"><a href="Feature.html#legendItem">legendItem</a></li>
            
                <li data-name="Feature#opacity"><a href="Feature.html#opacity">opacity</a></li>
            
                <li data-name="Feature#start"><a href="Feature.html#start">start</a></li>
            
                <li data-name="Feature#stop"><a href="Feature.html#stop">stop</a></li>
            
                <li data-name="Feature#viewer"><a href="Feature.html#viewer">viewer</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="FeatureSlot">
            <span class="title">
                <a href="FeatureSlot.html">FeatureSlot</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="FeatureSlot#viewer"><a href="FeatureSlot.html#viewer">viewer</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Font">
            <span class="title">
                <a href="Font.html">Font</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Font#asCss"><a href="Font.html#asCss">asCss</a></li>
            
                <li data-name="Font#font"><a href="Font.html#font">font</a></li>
            
                <li data-name="Font#font"><a href="Font.html#font">font</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IO">
            <span class="title">
                <a href="IO.html">IO</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="IO#load_json"><a href="IO.html#load_json">load_json</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Ruler">
            <span class="title">
                <a href="Ruler.html">Ruler</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="Viewer">
            <span class="title">
                <a href="Viewer.html">Viewer</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="Viewer#backboneRadius"><a href="Viewer.html#backboneRadius">backboneRadius</a></li>
            
                <li data-name="Viewer#height"><a href="Viewer.html#height">height</a></li>
            
                <li data-name="Viewer#sequenceLength"><a href="Viewer.html#sequenceLength">sequenceLength</a></li>
            
                <li data-name="Viewer#width"><a href="Viewer.html#width">width</a></li>
            
                <li data-name="Viewer#zoomFactor"><a href="Viewer.html#zoomFactor">zoomFactor</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="Viewer#addBp"><a href="Viewer.html#addBp">addBp</a></li>
            
                <li data-name="Viewer#clear"><a href="Viewer.html#clear">clear</a></li>
            
                <li data-name="Viewer#features"><a href="Viewer.html#features">features</a></li>
            
                <li data-name="Viewer#flash"><a href="Viewer.html#flash">flash</a></li>
            
                <li data-name="Viewer#subtractBp"><a href="Viewer.html#subtractBp">subtractBp</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="FeatureSlot.js.html">Source: FeatureSlot.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source "><code>//////////////////////////////////////////////////////////////////////////////
// FeatureSlot
//////////////////////////////////////////////////////////////////////////////
(function(CGV) {

  class FeatureSlot {

    /**
     * TEST
     */
    constructor(viewer, data = {}, display = {}, meta = {}) {
      this.viewer = viewer;
      this._strand = CGV.defaultFor(data.strand, 'direct');
      this._features = new CGV.CGArray();
      this._arcPlot;
      this._proportionOfRadius = CGV.defaultFor(data.proportionOfRadius, 0.1)

      this._featureStarts = new CGV.CGArray();

      if (data.features) {
        data.features.forEach((featureData) => {
          new CGV.Feature(this, featureData);
        });
        this.refresh();
      }

      if (data.arcPlot) {
        new CGV.ArcPlot(this, data.arcPlot);
      }
    }

    /**
     * @member {Viewer} - Get or set the *Viewer*
     */
    get viewer() {
      return this._viewer
    }

    set viewer(viewer) {
      if (this.viewer) {
        // TODO: Remove if already attached to Viewer
      }
      this._viewer = viewer;
      viewer._featureSlots.push(this);
    }

    get strand() {
      return this._strand;
    }

    isDirect() {
      return this.strand == 'direct'
    }

    isReverse() {
      return this.strand == 'reverse'
    }

    get hasFeatures() {
      return this._features.length > 0
    }

    get hasArcPlot() {
      return this._arcPlot
    }


    // Refresh needs to be called when new features are added, etc
    // Features need to be sorted by start position
    // NOTE: consider using d3 bisect for inserting new features in the proper sort order
    refresh() {
      // Sort the features by start
      this._features.sort( (a, b) => {
        return a.start - b.start
      });
      // Clear feature starts
      this._featureStarts = new CGV.CGArray();
      for (var i = 0, len = this._features.length; i &lt; len; i++) {
        this._featureStarts.push(this._features[i].start);
      }
      this._largestFeatureLength = this.findLargestFeatureLength();
    }

    length() {
      return this.viewer.sequenceLength;
    }

    visibleRanges(canvas, slotRadius, slotThickness) {
      var ranges = canvas.visibleRangesForRadius(slotRadius, slotThickness);
      if (ranges.length == 2) {
        return ranges
      } else if (ranges.length > 2) {
        return [ ranges[0], ranges[ranges.length -1] ]
      } else {
        return undefined
      }
    }

    get largestFeatureLength() {
      return this._largestFeatureLength
    }

    findLargestFeatureLength() {
      var length = 0;
      for (var i = 0, len = this._features.length; i &lt; len; i++) {
        var nextLength = this._features[i].length;
        if (nextLength > length) {
          length = nextLength
        }
      }
      return length
    }

    draw(canvas, fast, slotRadius, slotThickness) {
      var ranges = this.visibleRanges(canvas, slotRadius, slotThickness)
      var start = ranges ? ranges[0] : 1;
      var stop = ranges ? ranges[1] : this.viewer.sequenceLength;
      var featureCount = this._features.length;
      if (this.hasFeatures) {
        var largestLength = this.largestFeatureLength;
        // Case where the largest feature should not be subtracted
        // _____ Visible
        // ----- Not Visbile
        // Do no subtract the largest feature so that the start loops around to before the stop
        // -----Start_____Stop-----
        // In cases where the start is shortly after the stop, make sure that subtracting the largest feature does not put the start before the stop
        // _____Stop-----Start_____
        if (ranges &amp;&amp;
             (largestLength &lt;= (this.viewer.sequenceLength - Math.abs(start - stop))) &amp;&amp;
             (this.viewer.subtractBp(start, stop) > largestLength) ) {
          start = this.viewer.subtractBp(start, largestLength);
          featureCount = this._featureStarts.countFromRange(start, stop);
        }
        if (fast &amp;&amp; featureCount > 2000) {
          canvas.drawArc(1, this.viewer.sequenceLength, slotRadius, 'rgba(0,0,200,0.03)', slotThickness);
        } else {
          this._featureStarts.eachFromRange(start, stop, 1, (i) => {
            this._features[i].draw(canvas, slotRadius, slotThickness);
          })
        }
      } else if (this.hasArcPlot) {
        if (ranges) {
          this._arcPlot.draw(canvas, slotRadius, slotThickness, fast, ranges[0], ranges[1]);
        } else {
          this._arcPlot.draw(canvas, slotRadius, slotThickness, fast);
        }
      }
    }

  }

  CGV.FeatureSlot = FeatureSlot;

})(CGView);
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Dec 01 2016 09:28:17 GMT-0700 (MST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
