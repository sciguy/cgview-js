<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Icon -->
    <link rel="shortcut icon" type="image/png" href="../images/logo-tab.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <link rel="stylesheet" href="../styles/prism.css" />
    <!-- <link rel="stylesheet" href="../styles/tables.css" /> -->
    <link rel="stylesheet" href="../styles/general.css" />
    <script src='../scripts/marked.min.js'></script>
    <script src='../scripts/general.js'></script>

    <!-- D3 -->
    <script src="../scripts/d3.v4.min.js"></script>
    <!-- CGView -->
    <script src='../dist/cgview.min.js'></script>
    <link rel="stylesheet" href="../dist/cgview.css" />
    <!-- Controls -->
    <link rel="stylesheet" href="../styles/controls.css" />

    <title>CGView.js - Tutorials</title>
  </head>
  <body>
    <!-- Nav Bar -->
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img class='logo-sm' src='../images/logo.png' />CGView.js</a>
        <!-- Docs Toggle -->
        <button class="btn sidebar-toggle d-sm-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-nav" aria-controls="cgv-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="bi bi-expand" fill="currentColor" viewBox="0 0 16 16"> <title>Expand</title> <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zM7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10z"></path> </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" class="bi bi-collapse" fill="currentColor" viewBox="0 0 16 16"> <title>Collapse</title> <path fill-rule="evenodd" d="M1 8a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13A.5.5 0 0 1 1 8zm7-8a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 4.293V.5A.5.5 0 0 1 8 0zm-.5 11.707l-1.146 1.147a.5.5 0 0 1-.708-.708l2-2a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 11.707V15.5a.5.5 0 0 1-1 0v-3.793z"></path> </svg>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <div class="navbar-nav">
            <a class="nav-link" href="../examples/index.html">Examples</a>
            <a class="nav-link active" aria-current="page" href="index.html">Tutorials</a>
            <a class="nav-link" href="../docs.html">Docs</a>
            <a class="nav-link" href="../api/index.html">API</a>
            <a class="nav-link" href="../json.html">JSON</a>
            <a class="nav-link github-logo" href="https://github.com/stothard-group/cgview-js"><img src='../images/GitHub-Mark-Light-64px.png' /></a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Side Nav -->
    <nav id='sidebar-nav'>
      <ul id='gumshoe-list' class='sidebar-list'>
        <li><a class="side-link nav-index" href="index.html">Index</a></li>
        <p>Tutorials</p>
        <li><a class="side-link indent" href="tutorial-basic.html">Basic Map</a></li>
        <li><a class="side-link indent" href="tutorial-sequence.html">Sequence Map</a></li>
        <li><a class="side-link indent" href="tutorial-json.html">JSON Map</a></li>
        <li><a class="side-link indent" href="tutorial-builder.html">CGViewBuilder</a></li>
        <li class='active'><a class="side-link indent" href="tutorial-controls.html">Map Controls</a></li>
        <p>Details</p>
        <li><a class="side-link indent" href="details-json-files.html">JSON Files</a></li>
        <li><a class="side-link indent" href="details-meta-data.html">Meta Data</a></li>
        <li><a class="side-link indent" href="details-map-scales.html">Map Scales</a></li>
      </ul>
    </nav>

    <main>
      <!-- Processed Markdown will be inserted here -->
      <div id='markdown-out'></div>
      <!-- Generated CGView Map will be inserted here -->
      <div id='my-viewer'></div>
      <div class='cgv-controls'>
        <div class='cgv-btn' id='btn-reset' title='Reset Map'></div>
        <div class='cgv-btn' id='btn-zoom-in' title='Zoom In'></div>
        <div class='cgv-btn' id='btn-zoom-out' title='Zoom Out'></div>
        <div class='cgv-btn' id='btn-move-left' title='Move Left/Counterclockwise'></div>
        <div class='cgv-btn' id='btn-move-right' title='Move Right/Clockwise'></div>
        <div class='cgv-btn' id='btn-toggle-format' title='Toggle Linear/Circular Format'></div>
        <div class='cgv-btn' id='btn-invert-colors' title='Invert Map Colors'></div>
        <div class='cgv-btn' id='btn-random-feature' title='Move to Random Feature'></div>
        <div class='cgv-btn' id='btn-download' title='Download Map PNG'></div>
        <div class='cgv-btn' id='btn-toggle-labels' title='Toggle Labels'></div>
      </div>

      <!-- Compiled final code will be inserted here -->
      <div id='final-code'>
        <h2>Complete Code without Comments:</h2>
        <pre class='prettyprint'><code class='lang-js final'></code></pre>
      </div>
    </main>

    <div id='markdown-in' style='display:none;'>

# Making Controls for a Map

CGView.js does not provide any interface controls for interacting with a map
(with the exception of the color picker when a legend swatch is clicked). 

Adding controls is easy, as this tutorial will show. And the code used here to
generate controls can be used as a starting point in other projects.

All the [examples](../examples/index.html) use the same controls created here.

## Adding HTML for Controls

Below the 'my-viewer' div, we will add a number of buttons which will be hooked up to perform actions on the map.

Here is the HTML
```html
  <div id='my-viewer'></div>
  <div class='cgv-controls'>
    <div class='cgv-btn' id='btn-reset' title='Reset Map'></div>
    <div class='cgv-btn' id='btn-zoom-in' title='Zoom In'></div>
    <div class='cgv-btn' id='btn-zoom-out' title='Zoom Out'></div>
    <div class='cgv-btn' id='btn-move-left' title='Move Left/Counterclockwise'></div>
    <div class='cgv-btn' id='btn-move-right' title='Move Right/Clockwise'></div>
    <div class='cgv-btn' id='btn-toggle-format' title='Toggle Linear/Circular Format'></div>
    <div class='cgv-btn' id='btn-invert-colors' title='Invert Map Colors'></div>
    <div class='cgv-btn' id='btn-random-feature' title='Move to Random Feature'></div>
    <div class='cgv-btn' id='btn-download' title='Download Map PNG'></div>
    <div class='cgv-btn' id='btn-toggle-labels' title='Toggle Labels'></div>
  </div>
```

Here is what the controls will look like:
<div class='cgv-controls'>
  <div class='cgv-btn btn-reset' title='Reset Map'></div>
  <div class='cgv-btn btn-zoom-in' title='Zoom In'></div>
  <div class='cgv-btn btn-zoom-out' title='Zoom Out'></div>
  <div class='cgv-btn btn-move-left' title='Move Left/Counterclockwise'></div>
  <div class='cgv-btn btn-move-right' title='Move Right/Clockwise'></div>
  <div class='cgv-btn btn-toggle-format' title='Toggle Linear/Circular Format'></div>
  <div class='cgv-btn btn-invert-colors' title='Invert Map Colors'></div>
  <div class='cgv-btn btn-random-feature' title='Move to Random Feature'></div>
  <div class='cgv-btn btn-download' title='Download Map PNG'></div>
  <div class='cgv-btn btn-toggle-labels' title='Toggle Labels'></div>
</div>

<br />

For simplicity, the SVG images are embedded in the CSS. The CSS for the example
controls is available here: [controls.css](../styles/controls.css)

The complete JavaScript for the controls (described below) can be downloaded
here: [controls.js](../scripts/controls.js)

## Create [Viewer](../api/Viewer.html)

Create the viewer so we can interact with it.

```js
// Create the viewer
cgv = new CGV.Viewer('#my-viewer', {
  height: 500,
  width: 500,
});

// Load an exmaple JSON file
var request = new XMLHttpRequest();
request.open('GET', '../data/json/NZ_CP010546.json', true);
request.onload = function() {
  var response = request.response;
  const json = JSON.parse(response);
  cgv.io.loadJSON(json);
  cgv.draw()
};
request.send();
```

## Adding JavaScript for Controls

First let's make a helper method to simplify adding click handlers to the buttons.

```js
// Helper to add click handlers to buttons
onClick = function(id, func) {
  const btn = document.getElementById(id);
  btn.addEventListener('click', func);
}
```

### <div class='cgv-btn btn-reset btn-heading' title='Reset Map'></div> Reset Button
The [reset()](../api/Viewer.html#reset) method centers the map and set the zoom level to 1.

```js
// Reset Map Button
onClick('btn-reset', () => {
  cgv.reset();
});
```

### <div class='cgv-btn btn-zoom-in btn-heading' title='Zoom In'></div><div class='cgv-btn btn-zoom-out btn-heading' title='Zoom Out'></div> Zoom In/Out

The [zoomIn()](../api/Viewer.html#zoomIn) and
[zoomOut()](../api/Viewer.html#zoomOut) methods zoom the map in or out by a
factor. The default factor is 2.

```js
// Zoom In Button
onClick('btn-zoom-in', () => {
   cgv.zoomIn()
});

// Zoom Out Button
onClick('btn-zoom-out', () => {
   cgv.zoomOut()
});
```

### <div class='cgv-btn btn-move-left btn-heading' title='Move Left/Counterclockwise'></div><div class='cgv-btn btn-move-right btn-heading' title='Move Right/Clockwise'></div> Move Left/Right

The [moveLeft()](../api/Viewer.html#moveLeft) and
[moveRight()](../api/Viewer.html#moveRight) methods move the map
left/counterclockwise or right/clockwise by a factor of the visible map (the
default is 0.5). This allows moving the same visible amount independent of the
zoom level. For example, if 1000 bp are currently visible then the default move
would be 500 bp. Moving to a specific region can be performed with the
[moveTo()](../api/Viewer.html#moveTo) method.

```js
// Move Left/Counter-Clockwise
onClick('btn-move-left', () => {
  cgv.moveLeft();
});

// Move Right/Clockwise
onClick('btn-move-right', () => {
  cgv.moveRight();
});
```

### <div class='cgv-btn btn-toggle-format btn-heading' title='Toggle Linear/Circular Format'></div> Change Map Format

The map format (circular or linear) is changed via settings
[update()](../api/Settings.html#update).

```js
// Change Map Format Linear <-> Circular
onClick('btn-toggle-format', () => {
  const format = (cgv.format == 'circular') ? 'linear' : 'circular';
  cgv.settings.update({ format: format });
  cgv.draw();
});
```
### <div class='cgv-btn btn-invert-colors btn-heading' title='Invert Map Colors'></div> Invert Map Colors

All the colors on the map (e.g. features, background, captions) can be changed
with a single viewer command:
[invertColors()](../api/Viewer.html#invertColors).

```js
// Invert the Map Colors
onClick('btn-invert-colors', () => {
  cgv.invertColors();
});
```

### <div class='cgv-btn btn-random-feature btn-heading' title='Move to Random Feature'></div> Move to a Random Feature

This button show how easy it is to move to a feature using the feature
[moveTo()](../api/Feature.html#moveTo).

```js
// Move to Random Feature
onClick('btn-random-feature', () => {
  // Choose a random feature
  const number = Math.ceil(Math.random() * cgv.features().length);
  const feature = cgv.features(number);
  // Take 1.5 seconds to move to the feature (the default is 1 second)
  feature.moveTo(1500);
});
```
### <div class='cgv-btn btn-download btn-heading' title='Donwload Map PNG'></div> Download PNG Button

Download the currently visible map using the IO
[downloadImage()](../api/IO.html#downloadImage) method.
Images up to 8000 x 8000 px can be downloaded.

```js
// Download PNG
onClick('btn-download', () => {
  const height = 2000;
  // Here we adjust the width to be proportional to the height
  const width = cgv.width / cgv.height * height;
  cgv.io.downloadImage(width, height, 'cgview_map.png');
});
```

### <div class='cgv-btn btn-toggle-labels btn-heading' title='Toggle Labels'></div> Toggle Feature Labels

This button toggles the visibility of the labels using annotation [update()](../api/annotation.html#update).

```js
// Toggle Labels
onClick('btn-toggle-labels', () => {
  cgv.annotation.update({visible: !cgv.annotation.visible});
  cgv.draw();
});
```

## Draw the Map ##

```js
cgv.draw();
```

The resulting Viewer (id='my-viewer') with custom controls is below.

    </div> <!-- End of markdown in -->

    <script>
      tutorialMarkdown(marked, true);
      autoResizeMyViewer();
    </script>

    <script src="../scripts/prism.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>

  </body>
</html>
