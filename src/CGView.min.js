var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return"jscomp_symbol_"+c+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();if(c[Symbol.iterator])return c[Symbol.iterator]();if(!(c instanceof Array||"string"==typeof c||c instanceof String))throw new TypeError(c+" is not iterable");var b=0;return{next:function(){return b==c.length?{done:!0}:{done:!1,value:c[b++]}}}};$jscomp.arrayFromIterator=function(c){for(var b,a=[];!(b=c.next()).done;)a.push(b.value);return a};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.arrayFromArguments=function(c){for(var b=[],a=0;a<c.length;a++)b.push(c[a]);return b};$jscomp.inherits=function(c,b){function a(){}a.prototype=b.prototype;c.prototype=new a;c.prototype.constructor=c;for(var d in b)if($jscomp.global.Object.defineProperties){var g=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);void 0!==g&&$jscomp.global.Object.defineProperty(c,d,g)}else c[d]=b[d]};var CGView={version:"0.1"};void 0===window.CGV&&(window.CGV=CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this.containerId=a.replace("#","");this._container=d3.select(a);this._width=c.defaultFor(d.width,600);this._height=c.defaultFor(d.height,600);this._wrapper=this._container.append("div").attr("class","cgv-wrapper").style("position","relative");this.canvas=new c.Canvas(this,this._wrapper,{width:this.width,height:this.height});this.featureSlotSpacing=c.defaultFor(d.featureSlotSpacing,1);this.globalLabel=c.defaultFor(d.globalLabel,!0);this.backgroundColor=
d.backgroundColor;this._zoomFactor=1;this.debug=c.defaultFor(d.debug,!1);this._io=new c.IO(this);this._featureSlots=new c.CGArray;this._legends=new c.CGArray;this.sequence=new c.Sequence(this,d.sequence);this.backbone=new c.Backbone(this,d.backbone);this.menu=new c.Menu(this);this.help=new c.Help(this);this.labelSet=new c.LabelSet(this,d.labelSet);this.ruler=new c.Ruler(this,d.ruler);this.initialize_dragging();this.initialize_zooming();this.eventMonitor=new c.EventMonitor(this)};b.prototype.load_json=
function(a){this._io.load_json(a)};b.prototype.resize=function(a,d,g,b){g=this.canvas;this._width=a||this.width;this._height=d||this.height;g.canvasNode.width=this._width*c.pixel_ratio;g.canvasNode.height=this._height*c.pixel_ratio;g.canvasNode.style.width=this._width+"px";g.canvasNode.style.height=this._height+"px";g.width=this._width;g.height=this._height;this.refreshLegends();this.canvas.refreshScales();this.draw(b)};b.prototype.features=function(a){for(var d=new c.CGArray,g=0,b=this._featureSlots.length;g<
b;g++)d.merge(this._featureSlots[g]._features);return d.get(a)};b.prototype.arcPlots=function(a){for(var d=new c.CGArray,g,b=0,e=this._featureSlots.length;b<e;b++)(g=this._featureSlots[b]._arcPlot)&&d.push(g);return d.get(a)};b.prototype.swatchedLegendItems=function(a){for(var d=new c.CGArray,g=0,b=this._legends.length;g<b;g++)d.merge(this._legends[g]._legendItems.filter(function(a){return a.drawSwatch}));return d.get(a)};b.prototype.clear=function(a){a=void 0===a?this.backgroundColor.rgbString:a;
this.canvas.clear(a)};b.prototype.flash=function(a){this.canvas.flash(a)};b.prototype.maxZoomedRadius=function(){return 1*this.minDimension};b.prototype._calculateSlotThickness=function(a){a=c.pixel(Math.min(this.backbone.zoomedRadius,this.maxZoomedRadius())*a);return this.maxSlotThickness?Math.min(a,c.pixel(this.maxSlotThickness)):a};b.prototype.draw_full=function(){this.draw()};b.prototype.draw_fast=function(){this.draw(!0)};b.prototype.draw=function(a){var d=(new Date).getTime();this.clear();var g=
c.pixel(this.backbone.zoomedThickness),b=c.pixel(this.backbone.zoomedRadius),e=b+g/2,g=b-g/2,k=c.pixel(this.featureSlotSpacing);this.canvas.visibleRadii();this.ctx.textBaseline="top";this.backbone.draw();for(var h=0,l=0,m=this._featureSlots.length;l<m;l++){var n=this._featureSlots[l],p=this._calculateSlotThickness(n.proportionOfRadius);b=n.isDirect()?e+=p/2+k+h:g-=p/2+k+h;h=p/2;n.draw(this.canvas,a,b,p)}this.ruler.draw(g,e);l=0;for(m=this._legends.length;l<m;l++)this._legends[l].draw(this.ctx);this.globalLabel&&
this.labelSet.draw(g,e);this.debug&&(this.debug.data.time.draw=c.elapsed_time(d),this.debug.draw(this.ctx));this._testDrawRange&&(this.ctx.strokeStyle="grey",this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.stroke())};b.prototype.refreshLegends=function(){for(var a=0,d=this._legends.length;a<d;a++)this._legends[a].refresh()};b.prototype.moveTo=function(a,d){};Object.defineProperties(b.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this.resize(a)}},
height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this.resize(null,a)}},minDimension:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.height,this.width)}},backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==a?new c.Color("white"):"Color"==a.toString()?a:new c.Color(a)}},labelFont:{configurable:!0,enumerable:!0,get:function(){return this.labelSet.font},set:function(a){this.labelSet.font=
a}},labelLineLength:{configurable:!0,enumerable:!0,get:function(){return this.labelSet.labelLineLength},set:function(a){this.labelSet.labelLineLength=a}},globalLabel:{configurable:!0,enumerable:!0,get:function(){return this._globalLabel},set:function(a){this._globalLabel=c.booleanify(a)}},zoomFactor:{configurable:!0,enumerable:!0,get:function(){return this._zoomFactor},set:function(a){this._zoomFactor=a}},scale:{configurable:!0,enumerable:!0,get:function(){return this.canvas.scale}},ctx:{configurable:!0,
enumerable:!0,get:function(){return this.canvas.ctx}},maxSlotThickness:{configurable:!0,enumerable:!0,get:function(){return this._maxSlotThickness},set:function(a){this._maxSlotThickness=a}},colorPicker:{configurable:!0,enumerable:!0,get:function(){if(void 0==this._colorPicker){var a=this.containerId+"-color-picker";this._container.append("div").classed("cp-color-picker-dialog",!0).attr("id",this.containerId+"-color-picker");this._colorPicker=new c.ColorPicker(a)}return this._colorPicker}},debug:{configurable:!0,
enumerable:!0,get:function(){return this._debug},set:function(a){a?(!0===a&&(a={},a.sections=b.debug_sections),this._debug=new c.Debug(a)):this._debug=void 0}},_testDrawRange:{configurable:!0,enumerable:!0,get:function(){return this.__testDrawRange},set:function(a){(this.__testDrawRange=a)?(this.canvas.width*=.4,this.canvas.height*=.4):(this.canvas.width/=.4,this.canvas.height/=.4);this.draw_full()}}});Object.defineProperties(b,{debug_sections:{configurable:!0,enumerable:!0,get:function(){return["time",
"zoom","position","n"]}}});c.Viewer=b})(CGView);
(function(c){c.Viewer.prototype._updateZoomMax=function(){this._zoom&&this._zoom.scaleExtent([1,this.backbone.maxZoomFactor()])};c.Viewer.prototype.initialize_zooming=function(){var b=this,a=this.backbone.maxZoomFactor();b._zoom=d3.zoom().scaleExtent([1,a]).on("start",function(){}).on("zoom",function(){var a=(new Date).getTime(),g=d3.mouse(b.canvas.canvasNode),f=b.scale.x.invert(c.pixel(g[0])),e=b.scale.y.invert(c.pixel(g[1])),g=b.backbone.zoomedRadius,e=c.angleFromPosition(f,e);b._zoomFactor=d3.event.transform.k;
var g=g-b.backbone.zoomedRadius,f=c.pixel(Math.cos(-e)*g),g=c.pixel(Math.sin(-e)*g),e=b.scale.x.domain(),k=b.scale.y.domain();b.scale.x.domain([e[0]-f,e[1]-f]);b.scale.y.domain([k[0]-g,k[1]-g]);b.draw(!0);b.debug&&(b.debug.data.time&&(b.debug.data.time.zoom=c.elapsed_time(a)),b.debug.data.zoom&&(b.debug.data.zoom.scale=c.round(b._zoomFactor,1)))}).on("end",function(){b.draw()});d3.select(b.canvas.canvasNode).call(b._zoom).on("dblclick.zoom",null)}})(CGView);
(function(c){c.Viewer.prototype.initialize_dragging=function(){var b=this;b._drag=d3.drag().on("start",function(){d3.select(b.canvas.canvasNode).style("cursor","all-scroll")}).on("drag",function(){var a=(new Date).getTime();domain_x=b.scale.x.domain();domain_y=b.scale.y.domain();var d=c.pixel(d3.event.dx),g=c.pixel(d3.event.dy);b.scale.x.domain([domain_x[0]-d,domain_x[1]-d]);b.scale.y.domain([domain_y[0]+g,domain_y[1]+g]);b.draw(!0);b.debug&&(b.debug.data.time.drag=c.elapsed_time(a))}).on("end",function(){b.draw()});
d3.select(b.canvas.canvasNode).call(b._drag)}})(CGView);
(function(c){c.testSearch=function(b){var a=/ATG/igm,d=[],g="";console.log("Making Sequence...");for(var f=0;f<b;f++)g+="ATCG".charAt(Math.floor(4*Math.random()));window.seq=g;console.log("Finding Pattern...");for(b=(new Date).getTime();match=a.exec(g);)d.push(match.index);console.log("ATGs found: "+d.length);console.log("Time: "+c.elapsed_time(b))};c.defaultFor=function(b,a){return void 0===b?a:b};c.booleanify=function(b){return"false"==b||"False"==b||void 0==b||0==b?!1:!0};c.pixel_ratio=1;c.pixel=
function(b){return b*c.pixel_ratio};c.get_pixel_ratio=function(b){b=b.getContext("2d");return(window.devicePixelRatio||1)/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1)};c.scale_resolution=function(b,a){if(1!=a){var d=b.width,g=b.height;b.width=d*a;b.height=g*a;b.style.width=d+"px";b.style.height=g+"px"}};c.elapsed_time=function(b){return(new Date).getTime()-b+" ms"};c.angleFromPosition=function(b,a){var d=
.5*Math.PI;0!=b&&(d=Math.atan(Math.abs(a/b)));0<=a&&0<=b?d=0-d:0>a&&0<=b||(0>a&&0>b?d=Math.PI-d:0<=a&&0>b&&(d=Math.PI+d));return d};c.clockPositionForAngle=function(b){b=Math.round(6/Math.PI*(b+Math.PI/2));12<b?b-=12:1>b&&(b+=12);return b};c.rectOriginForAttachementPoint=function(b,a,d,g){var f,e;switch(a){case 1:f=b.x-3*d/4;e=b.y;break;case 2:f=b.x-d;e=b.y;break;case 3:f=b.x-d;e=b.y-g/2;break;case 4:f=b.x-d;e=b.y-g;break;case 5:f=b.x-3*d/4;e=b.y-g;break;case 6:f=b.x-d/2;e=b.y-g;break;case 7:f=b.x-
d/4;e=b.y-g;break;case 8:f=b.x;e=b.y-g;break;case 9:f=b.x;e=b.y-g/2;break;case 10:f=b.x;e=b.y;break;case 11:f=b.x-d/4;e=b.y;break;case 12:f=b.x-d/2,e=b.y}return{x:f,y:e}};c.round=function(b,a){return Number(b.toFixed(a||2))};c.dotProduct=function(b,a){for(var d=0,g=0,f=b.length;g<f;g++)d+=b[g]*a[g];return d};c.pointsAdd=function(b,a){var d=[0,0];d[0]=b[0]+a[0];d[1]=b[1]+a[1];return d};c.pointsSubtract=function(b,a){var d=[0,0];d[0]=b[0]-a[0];d[1]=b[1]-a[1];return d};c.circleAnglesFromIntersectingLine=
function(b,a,d,g,f){var e=c.pointsSubtract([g,f],[a,d]),k=[a,d],h=c.dotProduct(e,e),e=2*c.dotProduct(k,e);b=c.dotProduct(k,k)-b*b;var l=e*e-4*h*b;b={};0<=l&&(l=Math.sqrt(l),k=(-e-l)/(2*h),h=(-e+l)/(2*h),0<=k&&1>=k&&(b.t1=c.angleFromPosition(a+k*(g-a),d+k*(f-d))),0<=h&&1>=h&&(b.t2=c.angleFromPosition(a+h*(g-a),d+h*(f-d))));return b};c.circleAnglesFromIntersectingRect=function(b,a,d,g,f){var e=[];e.push(c.circleAnglesFromIntersectingLine(b,a,d,a+g,d));e.push(c.circleAnglesFromIntersectingLine(b,a+g,
d,a+g,d-f));e.push(c.circleAnglesFromIntersectingLine(b,a+g,d-f,a,d-f));e.push(c.circleAnglesFromIntersectingLine(b,a,d-f,a,d));e=e.filter(function(a){return 0<Object.keys(a).length});0<e.length&&(b=Object.keys(e[0]),1==b.length&&"t1"==b[0]&&e.push(e.shift()),2==b.length&&(e.push({t1:e[0].t1}),e[0].t1=void 0),e=e.map(function(a){var d=[];void 0!=a.t1&&d.push(a.t1);void 0!=a.t2&&d.push(a.t2);return d}),e=[].concat.apply([],e));return e};c.indexOfValue=function(b,a,d){var g=0,f=b.length-1,e,c;if(b[g]>=
a)return g;if(b[f]<=a)return f;for(;1<f-g;)if(e=(g+f)/2|0,c=b[e],c<a)g=e;else if(c>a)f=e;else return e;return d?f:g};c.oppositeSigns=function(b,a){return 0>b*a};c.merge=function(){for(var b={},a,d,g,f=0,e=arguments.length;f<e;f++)if(a=arguments[f],"object"===typeof a){d=Object.keys(a);for(var c=0,h=d.length;c<h;c++)g=d[c],b[g]=a[g]}return b}})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;this.color=c.defaultFor(d.color,"black");this.font=c.defaultFor(d.font,"sans-serif, plain, 14");this.seq=d.seq;this.seq||(this.length=d.length);this.length||(this.length=1E3)};b.complement=function(a){for(var d="",g,b,e=0,c=a.length;e<c;e++){g=a.charAt(e);switch(g){case "A":b="T";break;case "T":b="A";break;case "G":b="C";break;case "C":b="G"}d+=b}return d};b.prototype._updateScale=function(){this.canvas.scale.bp=d3.scaleLinear().domain([1,
this.length]).range([-.5*Math.PI,1.5*Math.PI]);this.viewer._updateZoomMax()};b.prototype.lengthOfRange=function(a,d){return d>=a?d-a:this.length+(d-a)};b.prototype.subtractBp=function(a,d){return d<=a?a-d:this.length+a-d};b.prototype.addBp=function(a,d){return this.length>=d+a?d+a:a-this.length+d};b.prototype.forRange=function(a){return this.seq?a.spansOrigin()?this.seq.substr(a.start)+this.seq.substr(0,a.stop):this.seq.substr(a.start-1,a.length):this._fakeSequenceForRange(a)};b.prototype._fakeSequenceForRange=
function(a){var d=[],g=a.start,b=0;for(a=a.length;b<a;b++){switch(g%4){case 0:d[b]="A";break;case 1:d[b]="T";break;case 2:d[b]="G";break;case 3:d[b]="C"}g++}return d};b.prototype._drawSequence=function(){var a=this.canvas.ctx,d=c.pixel(this.zoomedRadius),g=this.visibleRange;if(g){var b=this._sequenceForRange(g),e=g.start;a.save();a.fillStyle=this.fontColor.rgbaString;a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var k=this.bpSpacing/2+this.bpMargin,h=0,g=g.length;h<g;h++){var l=
this.canvas.pointFor(e,d+k);a.fillText(b[h],l.x,l.y);l=this.canvas.pointFor(e,d-k);a.fillText(b[h],l.x,l.y);e++}a.restore()}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},seq:{configurable:!0,enumerable:!0,get:function(){return this._seq},set:function(a){if(this._seq=a)this._seq=this._seq.toUpperCase(),this._length=a.length,this._updateScale()}},length:{configurable:!0,
enumerable:!0,get:function(){return this._length},set:function(a){a&&(this.seq?console.error("Can not change the sequence length of *seq* is set."):(this._length=Number(a),this._updateScale()))}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new c.Color(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.bpSpacing=this.font.size}}});
c.Sequence=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;this.tickCount=c.defaultFor(d.tickCount,10);this.tickWidth=c.defaultFor(d.tickWidth,1);this.tickLength=c.defaultFor(d.tickLength,5);this.rulerPadding=c.defaultFor(d.rulerPadding,10);this.font=c.defaultFor(d.font,"sans-serif, plain, 10")};b.prototype._createTickFormatter=function(a){var d;50>=a?d=d3.formatPrefix(",.0",1):5E4>=a?(a=d3.precisionPrefix(a,1E3),d=d3.formatPrefix("."+a,1E3)):5E7>=a&&(a=d3.precisionPrefix(a,1E6),d=d3.formatPrefix("."+
a,1E6));return d};b.prototype._updateTicks=function(a,d){var g=this.sequence.length,b=0,e=0,k=new c.CGArray,h=0,l=new c.CGArray,m=0,l=this.tickCount;if(5>this.viewer.zoomFactor)b=1,e=g;else{var l=Math.ceil(l/2),m=this.canvas.visibleRangeForRadius(a),n=this.canvas.visibleRangeForRadius(d);m&&n?(e=m.mergeWithRange(n),b=e.start,e=e.stop):m?(b=m.start,e=m.stop):n&&(b=n.start,e=n.stop)}if(e>b)k.merge(d3.ticks(b,e,l)),h=d3.tickStep(b,e,l);else if(e<b)if(m=(g-b)/this.sequence.lengthOfRange(b,e),h=Math.round(l*
m),m=2*Math.round(l*(1-m)),0<h)for(k.merge(d3.ticks(b,g,h)),h=Math.round(d3.tickStep(b,g,h)),e=1;e<=m;e++)h*e<b&&k.push(h*e);else k.merge(d3.ticks(1,e,l)),h=Math.round(d3.tickStep(1,e,l));l=new c.CGArray;if(m=h%5?h%2?0:h/2:h/5){this.sequence.lengthOfRange(k[k.length-1],k[0])<=3*h?(b=0,e=g):(b=k[0]-h,e=k[k.length-1]+h);if(!(b<e)){for(;b<=g;b+=m)b%h&&l.push(b);b=0}for(;b<=e;b+=m)b%h&&l.push(b)}this._majorTicks=k;this._majorTickStep=h;this._minorTicks=l;this._minorTickStep=m;this._tickFormater=this._createTickFormatter(h)};
b.prototype.draw=function(a,d){this._updateTicks(a,d);this.drawForRadius(a,"inner");this.drawForRadius(d,"outer",!1)};b.prototype.drawForRadius=function(a,d,g){d=void 0===d?"inner":d;g=void 0===g?!0:g;var b=this,e=this.canvas.ctx,c="inner"==d?-this.tickLength:this.tickLength;e.fillStyle="black";e.font=this.font.css;e.textAlign="left";this.canvas.radiantLine(1,a,c,2*this.tickWidth);this.majorTicks.each(function(e,l){b.canvas.radiantLine(l,a,c,b.tickWidth);if(g){var m=b.tickFormater(l);b.drawLabel(l,
m,a,d)}});this.minorTicks.each(function(d,g){b.canvas.radiantLine(g,a,c/2,b.tickWidth)})};b.prototype.drawLabel=function(a,d,g,b){var e=this.canvas.scale;b=this.canvas.ctx;d=d.replace(/([kM])?$/," $1bp");g=this.canvas.pointFor(a,g-this.rulerPadding);a=e.bp(a);a=c.clockPositionForAngle(a);e=this.font.width(b,d);g=c.rectOriginForAttachementPoint(g,a,e,this.font.height);b.fillText(d,g.x,g.y)};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},
canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a)}},tickCount:{configurable:!0,enumerable:!0,get:function(){return this._tickCount},set:function(a){this._tickCount=a}},tickWidth:{configurable:!0,enumerable:!0,get:function(){return this._tickWidth},set:function(a){this._tickWidth=
c.pixel(a)}},tickLength:{configurable:!0,enumerable:!0,get:function(){return this._tickLength},set:function(a){this._tickLength=c.pixel(a)}},rulerPadding:{configurable:!0,enumerable:!0,get:function(){return this._rulerPadding},set:function(a){this._rulerPadding=c.pixel(a)}},majorTicks:{configurable:!0,enumerable:!0,get:function(){return this._majorTicks}},majorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._majorTickStep}},minorTicks:{configurable:!0,enumerable:!0,get:function(){return this._minorTicks}},
minorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._minorTickStep}},tickFormater:{configurable:!0,enumerable:!0,get:function(){return this._tickFormater}}});c.Ruler=b})(CGView);
(function(c){var b=function(a,d,b,f){this.x=a;this.y=d;this.width=b;this.height=f};b.prototype.overlap=function(a){for(var d=c.pixel(4),b=!1,f=0,e=a.length;f<e;f++)if(b=a[f],this.x<=b.right&&b.x<=this.right+d&&this.y<=b.bottom&&b.y<=this.bottom){b=!0;break}else b=!1;return b};b.prototype.containsPt=function(a,d){return a>=this.x&&a<=this.x+this.width&&d>=this.y&&d<=this.y+this.height};Object.defineProperties(b.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=
a}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this._height=a}},x:{configurable:!0,enumerable:!0,get:function(){return this._x},set:function(a){this._x=a}},y:{configurable:!0,enumerable:!0,get:function(){return this._y},set:function(a){this._y=a}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}},top:{configurable:!0,enumerable:!0,get:function(){return this.y}},left:{configurable:!0,enumerable:!0,get:function(){return this.x}},
right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}}});c.Rect=b})(CGView);
(function(c){function b(a){var d=this;this.viewer=a;this.slide_time=500;this._visible=!0;this.menu=a._wrapper.append("div").style("visibility","hidden").attr("class","cgv-menu").on("click",function(){window.getSelection().removeAllRanges()});this.menu_svg=this.menu.append("svg").attr("width",this.width()).attr("height",this.height());this.handle=a._wrapper.append("div").attr("class","cgv-menu-handle").on("click",function(){d.opened()?d.close():d.open()}).on("mouseover",function(){d.handle_mouseover()}).on("mouseout",
function(){d.handle_mouseout()});this.handle_svg=this.handle.append("svg").attr("width",40).attr("height",12);this.stroke_width=4;this.handle_data_closed=[{x:0,y:0},{x:20,y:12-this.stroke_width},{x:40,y:0}];this.handle_data_opened=[{x:0,y:12},{x:20,y:this.stroke_width},{x:40,y:12}];this.draw()}b.prototype.visible=function(a){if(0==arguments.length)return this._visible;a?(this._visible=!0,this.handle.style("visibility","visible"),this.menu.style("visibility","visible")):(this._visible=!1,this.handle.style("visibility",
"hidden"),this.menu.style("visibility","hidden"))};b.prototype.opened=function(){return"visible"==this.menu.style("visibility")};b.prototype.width=function(){return 300};b.prototype.height=function(){return 41};b.prototype.open=function(a){a=c.defaultFor(a,this.slide_time);this.menu.style("visibility","visible");this.menu.transition().duration(a).style("top","0px").style("opacity",1);this.handle_path.transition("shape").duration(a).attr("d",m(this.handle_data_opened))};b.prototype.close=function(a){a=
c.defaultFor(a,this.slide_time);this.menu.transition().duration(a).style("top","-50px").style("opacity",0).on("end",function(){d3.select(this).style("visibility","hidden")});this.handle_path.transition("shape").duration(a).attr("d",m(this.handle_data_closed))};b.prototype.handle_mouseover=function(){this.handle_path.transition("color").duration(200).attr("stroke","black")};b.prototype.handle_mouseout=function(){this.handle_path.transition().duration(200).attr("stroke","grey")};b.prototype.draw=function(){var b=
this.viewer,c;this.handle_path=this.handle_svg.append("path").attr("d",m(this.handle_data_closed)).attr("stroke","grey").attr("stroke-width",this.stroke_width).attr("fill","none");var q=d(this.menu_svg,[{x:11,y:4},{x:4,y:15},{x:11,y:26}]),r=d(this.menu_svg,[{x:4,y:4},{x:11,y:15},{x:4,y:26}]);this.nav_group=this.menu_svg.append("g");this.scroll_left_button=l(this.nav_group,0,0,15,30,q);this.scroll_right_button=l(this.nav_group,17,0,15,30,r);this.nav_group.attr("transform","translate(7,4)");this.scroll_left_button.on("mousedown",
function(){if(!d3.select(this).classed("disabled"))return c=a(b,"x",5,4),!1});this.scroll_right_button.on("mousedown",function(){if(!d3.select(this).classed("disabled"))return c=a(b,"x",-5,4),!1});$(document).mouseup(function(){c&&(clearInterval(c),b.full_draw())});this.zoom_group=this.menu_svg.append("g");this.zoom_y_minus_button=l(this.zoom_group,6,18,16,16,f(this.menu_svg));this.zoom_y_plus_button=l(this.zoom_group,6,0,16,16,g(this.menu_svg));this.zoom_x_minus_button=l(this.zoom_group,25,9,16,
16,f(this.menu_svg));this.zoom_x_plus_button=l(this.zoom_group,43,9,16,16,g(this.menu_svg));e(this.zoom_group,0,.5,5,34,0);e(this.zoom_group,25.5,32,5,34,-90);this.zoom_group.attr("transform","translate(55,2)");this.zoom_x_minus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/2,a=[[b.scale.x.min()-a,b.scale.x.max()+a],b.scale.y.domain()];b.move_to(a)}});this.zoom_x_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/
4,a=[[b.scale.x.min()+a,b.scale.x.max()-a],b.scale.y.domain()];b.move_to(a)}});this.zoom_y_minus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/2,a=[b.scale.x.domain(),[b.scale.y.min()-a,b.scale.y.max()+a]];b.move_to(a)}});this.zoom_y_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/4,a=[b.scale.x.domain(),[b.scale.y.min()+a,b.scale.y.max()-a]];b.move_to(a)}});help_icon=this.menu_svg.append("text").attr("x",
15).attr("y",24).attr("font-family","sans-serif").attr("font-size","26px").attr("stroke-width",1).attr("fill","black").attr("class","cgv-button-text").style("text-anchor","middle").text("?");this.help_button=l(this.menu_svg,260,4,30,30,help_icon);this.help_button.on("click",function(){b.help.dialog.open()});download_group=h(this.menu_svg).attr("transform","translate(5,7)");this.download_button=l(this.menu_svg,220,4,30,30,download_group);settings_group=k(this.menu_svg).attr("transform","translate(5,5)");
this.settings_button=l(this.menu_svg,180,4,30,30,settings_group);this.settings_button.on("click",function(){b.settings.open()});cgv_icon=this.menu_svg.append("text").attr("x",149).attr("y",32).attr("font-family","sans-serif").attr("font-size","16px").attr("font-weight","bold").attr("stroke-width",1).attr("fill","grey").attr("class","cgv-button-text").style("text-anchor","middle").text("CGV")};var a=function(a,d,b,g){return setInterval(function(){a.translate_axis(d,b);a.fast_draw()},g)},d=function(a,
d){return a.append("path").attr("d",m(d)).attr("stroke","black").attr("stroke-width",3).attr("fill","none")},g=function(a){a=a.append("g");a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke","black");a.append("line").attr("x1",8).attr("y1",3).attr("x2",8).attr("y2",13).attr("stroke-width",3).attr("stroke","black");return a},f=function(a){return a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke",
"black")},e=function(a,d,b,g,f,c){a=a.append("g");var e=b+2,k=b+f-2,m=d+g/2;a.append("line").attrs({x1:d,y1:b,x2:d+g,y2:b,"stroke-width":1});a.append("line").attrs({x1:d,y1:b+f,x2:d+g,y2:b+f,"stroke-width":1});a.append("line").attrs({x1:m,y1:e,x2:m,y2:k,"stroke-width":1});a.append("line").attrs({x1:m,y1:e,x2:m-2,y2:e+2,"stroke-width":1});a.append("line").attrs({x1:m,y1:e,x2:m+2,y2:e+2,"stroke-width":1});a.append("line").attrs({x1:m,y1:k,x2:m-2,y2:k-2,"stroke-width":1});a.append("line").attrs({x1:m,
y1:k,x2:m+2,y2:k-2,"stroke-width":1});a.attr("stroke","rgb(150, 150, 150)").attr("transform","rotate("+c+","+d+","+b+")");return a},k=function(a){a=a.append("g");a.append("circle").attrs({cx:10,cy:10,r:7}).style("fill","rgb(75, 75, 75");a.append("line").attrs({x1:10,y1:1,x2:10,y2:19,"stroke-width":4});a.append("line").attrs({x1:1,y1:10,x2:19,y2:10,"stroke-width":4});a.append("line").attrs({x1:3.5,y1:3.5,x2:16.5,y2:16.5,"stroke-width":4});a.append("line").attrs({x1:16.5,y1:3.5,x2:3.5,y2:16.5,"stroke-width":4});
a.append("circle").attrs({cx:10,cy:10,r:3}).style("fill","white");return a},h=function(a){a=a.append("g");a.append("line").attrs({x1:10,y1:0,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:6,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:14,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:2,y1:16,x2:18,y2:16,"stroke-linecap":"round","stroke-width":3});return a},l=function(a,d,b,g,f,c){a=
a.append("g").attr("class","cgv-menu-button");a.append("rect").attr("x",0).attr("y",0).attr("width",g).attr("height",f).attr("rx",2).attr("ry",2).style({"stroke-width":1});var e=c.remove();a.append("g").attr("class","cgv-button-image").append(function(){return e.node()});a.attr("transform","translate("+d+".5,"+b+".5)");return a},m=d3.line().x(function(a){return a.x}).y(function(a){return a.y});c.Menu=b})(CGView);
(function(c){var b=function(a){var d=this;this.viewer=a;this.slideTime=500;this._menu_div=a._wrapper.append("div").style("visibility","hidden").attr("class","cgv-menu").on("click",function(){window.getSelection().removeAllRanges()});this._menu_svg=this._menu_div.append("svg").attr("width",this.width).attr("height",this.height);this._handle_div=a._wrapper.append("div").attr("class","cgv-menu-handle").on("click",function(){d.opened?d.close():d.open()}).on("mouseover",function(){d._handle_mouseover()}).on("mouseout",
function(){d._handle_mouseout()});this._handle_svg=this._handle_div.append("svg").attr("width",40).attr("height",12);this._handle_stroke_width=4;this._handle_data_closed=[{x:0,y:0},{x:20,y:12-this._handle_stroke_width},{x:40,y:0}];this._handle_data_opened=[{x:0,y:12},{x:20,y:this._handle_stroke_width},{x:40,y:12}];this._draw()};b.prototype.open=function(a){a=c.defaultFor(a,this.slideTime);this._menu_div.style("visibility","visible");this._menu_div.transition().duration(a).style("top","0px").style("opacity",
1);this._handle_path.transition("shape").duration(a).attr("d",l(this._handle_data_opened))};b.prototype.close=function(a){a=c.defaultFor(a,this.slideTime);this._menu_div.transition().duration(a).style("top","-50px").style("opacity",0).on("end",function(){d3.select(this).style("visibility","hidden")});this._handle_path.transition("shape").duration(a).attr("d",l(this._handle_data_closed))};b.prototype._handle_mouseover=function(){this._handle_path.transition("color").duration(200).attr("stroke","black")};
b.prototype._handle_mouseout=function(){this._handle_path.transition().duration(200).attr("stroke","grey")};b.prototype._draw=function(){var b=this.viewer,n=this;this._handle_path=this._handle_svg.append("path").attr("d",l(this._handle_data_closed)).attr("stroke","grey").attr("stroke-width",this._handle_stroke_width).attr("fill","none");var p=a(this._menu_svg,[{x:11,y:4},{x:4,y:15},{x:11,y:26}]),q=a(this._menu_svg,[{x:4,y:4},{x:11,y:15},{x:4,y:26}]);this.nav_group=this._menu_svg.append("g");this.scroll_left_button=
h(this.nav_group,0,0,15,30,p);this.scroll_right_button=h(this.nav_group,17,0,15,30,q);this.nav_group.attr("transform","translate(7,4)");$(document).mouseup(function(){});this.zoom_group=this._menu_svg.append("g");this.zoom_y_minus_button=h(this.zoom_group,6,18,16,16,g(this._menu_svg));this.zoom_y_plus_button=h(this.zoom_group,6,0,16,16,d(this._menu_svg));this.zoom_x_minus_button=h(this.zoom_group,25,9,16,16,g(this._menu_svg));this.zoom_x_plus_button=h(this.zoom_group,43,9,16,16,d(this._menu_svg));
f(this.zoom_group,0,.5,5,34,0);f(this.zoom_group,25.5,32,5,34,-90);this.zoom_group.attr("transform","translate(55,2)");this.zoom_x_minus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/2,a=[[b.scale.x.min()-a,b.scale.x.max()+a],b.scale.y.domain()];b.move_to(a)}});this.zoom_x_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/4,a=[[b.scale.x.min()+a,b.scale.x.max()-a],b.scale.y.domain()];b.move_to(a)}});this.zoom_y_minus_button.on("click",
function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/2,a=[b.scale.x.domain(),[b.scale.y.min()-a,b.scale.y.max()+a]];b.move_to(a)}});this.zoom_y_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/4,a=[b.scale.x.domain(),[b.scale.y.min()+a,b.scale.y.max()-a]];b.move_to(a)}});p=this._menu_svg.append("text").attr("x",15).attr("y",24).attr("font-family","sans-serif").attr("font-size","26px").attr("stroke-width",1).attr("fill","black").attr("class",
"cgv-button-text").style("text-anchor","middle").text("?");this.help_button=h(this._menu_svg,260,4,30,30,p);this.help_button.on("click",function(){b.help.dialog.open()});p=k(this._menu_svg).attr("transform","translate(5,7)");this.download_button=h(this._menu_svg,220,4,30,30,p);this.download_dialog=new c.Dialog(b,{header_text:"Save Image",content_text:'<div class="cgv-alert">Display the viewer image in a new window to download or print. Note that you must allow pop-ups!</div><div><label class="cgv-label">Size</label><div class="cgv-input-group"><input class="cgv-input" id="cgv-save-width" type="text" value="'+
b.width+'" /><div class="cgv-input-addon">px</div></div></div>',buttons:{Cancel:function(){this.close()},Generate:function(){var a=b._wrapper.select("#cgv-save-width").property("value"),d=b._wrapper.select("#cgv-save-width").property("value");b._io.exportImage(d,a);this.close()}},width:400,height:200});this.download_button.on("click",function(){n.download_dialog.open()});p=e(this._menu_svg).attr("transform","translate(5,5)");this.settings_button=h(this._menu_svg,180,4,30,30,p);this.settings_button.on("click",
function(){b.settings.open()});this._menu_svg.append("text").attr("x",149).attr("y",32).attr("font-family","sans-serif").attr("font-size","16px").attr("font-weight","bold").attr("stroke-width",1).attr("fill","grey").attr("class","cgv-button-text").style("text-anchor","middle").text("CGV")};Object.defineProperties(b.prototype,{slideTime:{configurable:!0,enumerable:!0,get:function(){return this._slideTime},set:function(a){this._slideTime=a}},available:{configurable:!0,enumerable:!0,get:function(){return this._available},
set:function(a){a?(this._available=!0,this._handle_div.style("visibility","visible"),this._menu_div.style("visibility","visible")):(this._available=!1,this._handle_div.style("visibility","hidden"),this._menu_div.style("visibility","hidden"))}},opened:{configurable:!0,enumerable:!0,get:function(){return"visible"==this._menu_div.style("visibility")}},width:{configurable:!0,enumerable:!0,get:function(){return 300}},height:{configurable:!0,enumerable:!0,get:function(){return 41}}});var a=function(a,d){return a.append("path").attr("d",
l(d)).attr("stroke","black").attr("stroke-width",3).attr("fill","none")},d=function(a){a=a.append("g");a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke","black");a.append("line").attr("x1",8).attr("y1",3).attr("x2",8).attr("y2",13).attr("stroke-width",3).attr("stroke","black");return a},g=function(a){return a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke","black")},f=function(a,d,b,g,
f,c){a=a.append("g");var e=b+2,k=b+f-2,h=d+g/2;a.append("line").attrs({x1:d,y1:b,x2:d+g,y2:b,"stroke-width":1});a.append("line").attrs({x1:d,y1:b+f,x2:d+g,y2:b+f,"stroke-width":1});a.append("line").attrs({x1:h,y1:e,x2:h,y2:k,"stroke-width":1});a.append("line").attrs({x1:h,y1:e,x2:h-2,y2:e+2,"stroke-width":1});a.append("line").attrs({x1:h,y1:e,x2:h+2,y2:e+2,"stroke-width":1});a.append("line").attrs({x1:h,y1:k,x2:h-2,y2:k-2,"stroke-width":1});a.append("line").attrs({x1:h,y1:k,x2:h+2,y2:k-2,"stroke-width":1});
a.attr("stroke","rgb(150, 150, 150)").attr("transform","rotate("+c+","+d+","+b+")");return a},e=function(a){a=a.append("g");a.append("circle").attrs({cx:10,cy:10,r:7}).style("fill","rgb(75, 75, 75");a.append("line").attrs({x1:10,y1:1,x2:10,y2:19,"stroke-width":4});a.append("line").attrs({x1:1,y1:10,x2:19,y2:10,"stroke-width":4});a.append("line").attrs({x1:3.5,y1:3.5,x2:16.5,y2:16.5,"stroke-width":4});a.append("line").attrs({x1:16.5,y1:3.5,x2:3.5,y2:16.5,"stroke-width":4});a.append("circle").attrs({cx:10,
cy:10,r:3}).style("fill","white");return a},k=function(a){a=a.append("g");a.append("line").attrs({x1:10,y1:0,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:6,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:14,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:2,y1:16,x2:18,y2:16,"stroke-linecap":"round","stroke-width":3});return a},h=function(a,d,b,g,f,e){a=a.append("g").attr("class","cgv-menu-button");
a.append("rect").attr("x",0).attr("y",0).attr("width",g).attr("height",f).attr("rx",2).attr("ry",2).style({"stroke-width":1});var c=e.remove();a.append("g").attr("class","cgv-button-image").append(function(){return c.node()});a.attr("transform","translate("+d+".5,"+b+".5)");return a},l=d3.line().x(function(a){return a.x}).y(function(a){return a.y});c.Menu=b})(CGView);
(function(c){var b=function(a,d,b){d=void 0===d?{}:d;b=void 0===b?{}:b;this.legend=a;this.meta=c.merge(d.meta,b);this.text=c.defaultFor(d.text,"");this.drawSwatch=c.defaultFor(d.drawSwatch,!1);this.font=d.font;this.fontColor=d.fontColor;this.textAlignment=d.textAlignment;this.drawSwatch=c.defaultFor(d.drawSwatch,!1);this._swatchColor=new c.Color(c.defaultFor(d.swatchColor,"black"));this.swatchOpacity=c.defaultFor(d.swatchOpacity,1)};b.prototype._swatchContainsPoint=function(a){for(var d=this.legend.originX+
this.legend.padding,b=this.legend.originY+this.legend.padding,f=0,e=this.legend._legendItems.length;f<e;f++){var c=this.legend._legendItems[f];if(c==this)break;b+=1.5*c.height}if(a.x>=d&&a.x<=d+this.height&&a.y>=b&&a.y<=b+this.height)return!0};Object.defineProperties(b.prototype,{legend:{configurable:!0,enumerable:!0,get:function(){return this._legend},set:function(a){var d=this.legend;this._viewer=a.viewer;this._legend=a;a._legendItems.push(this);d&&(d._legendItems=d._legendItems.remove(this),d.refresh(),
a.refresh())}},text:{configurable:!0,enumerable:!0,get:function(){return this._text},set:function(a){this._text=a}},drawSwatch:{configurable:!0,enumerable:!0,get:function(){return this._drawSwatch},set:function(a){this._drawSwatch=a}},textAlignment:{configurable:!0,enumerable:!0,get:function(){return this._textAlignment},set:function(a){this._textAlignment=void 0==a?this.legend.textAlignment:a}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},width:{configurable:!0,enumerable:!0,
get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.height}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font=void 0==a?this.legend.font:"Font"==a.toString()?a:new c.Font(a)}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor=void 0==a?this.legend._fontColor:"Color"==a.toString()?a:new c.Color(a)}},swatchColor:{configurable:!0,enumerable:!0,
get:function(){return this._swatchColor},set:function(a){"Color"==a.toString()?this._swatchColor=a:this._swatchColor.setColor(a)}},swatchOpacity:{configurable:!0,enumerable:!0,get:function(){return this._swatchColor.opacity},set:function(a){this._swatchColor.opacity=a}}});c.LegendItem=b})(CGView);
(function(c){var b=function(a,d,b){d=void 0===d?{}:d;b=void 0===b?{}:b;this.viewer=a;this.meta=c.merge(d.meta,b);this.canvas=a.canvas;this._legendItems=new c.CGArray;this._position=c.defaultFor(d.position,"upper-right");this.backgroundColor=d.backgroundColor;this.backgroundOpacity=c.defaultFor(d.backgroundOpacity,1);this.font=c.defaultFor(d.font,"SansSerif, plain, 8");this._fontColor=new c.Color(c.defaultFor(d.fontColor,"black"));this.textAlignment=c.defaultFor(d.textAlignment,"left");if(d.legendItems){var f=
this;d.legendItems.forEach(function(a){new c.LegendItem(f,a)})}this.refresh()};b.prototype.refresh=function(){for(var a=this.height=0,d=0,b=this._legendItems.length;d<b;d++){var f=this._legendItems[d].height;this.height+=f;d<b-1&&(this.height+=f/2);f>a&&(a=f)}this.padding=a/2;this.height+=2*this.padding;this.width=0;d=this._legendItems.map(function(a){return a.font.css});b=this._legendItems.map(function(a){return a.text});a=c.Font.calculateWidths(this.canvas.ctx,d,b);d=0;for(b=a.length;d<b;d++)f=
this._legendItems[d],f.drawSwatch&&(a[d]+=f.height+this.padding/2),f._width=a[d];this.width=d3.max(a)+2*this.padding;this._updateOrigin()};b.prototype.setColorPickerPosition=function(a){var d,b=this.viewer._container.node().getBoundingClientRect();d=this.originX/c.pixel(1)+b.left+window.pageXOffset;var b=this.originY/c.pixel(1)+b.top+window.pageYOffset,f=this.width/c.pixel(1);d=/-left$/.exec(this.position)?{x:d+f+5,y:b}:{x:d-a.width-5,y:b};a.setPosition(d)};b.prototype._updateOrigin=function(){var a=
c.pixel(0),d=this.canvas.width,b=this.canvas.height,f=this.width,e=this.height,k=this.position;"upper-left"==k?this.originY=this.originX=a:"upper-center"==k?(this.originX=d/2-f/2,this.originY=a):"upper-right"==k?(this.originX=d-f-a,this.originY=a):"middle-left"==k?(this.originX=a,this.originY=b/2-e/2):"middle-center"==k?(this.originX=d/2-f/2,this.originY=b/2-e/2):"middle-right"==k?(this.originX=d-f-a,this.originY=b/2-e/2):"lower-left"==k?(this.originX=a,this.originY=b-e-a):"lower-center"==k?(this.originX=
d/2-f/2,this.originY=b-e-a):"lower-right"==k&&(this.originX=d-f-a,this.originY=b-e-a)};b.prototype.draw=function(a){a.fillStyle=this.backgroundColor.rgbaString;a.fillRect(this.originX,this.originY,this.width,this.height);for(var d,b,f=this.originY+this.padding,e=0,k=this._legendItems.length;e<k;e++){var h=this._legendItems[e],l=h.height,m=h.drawSwatch,n=l,p=this.padding/2;a.font=h.font.css;a.textAlign=h.textAlignment;m?("left"==h.textAlignment?(b=this.originX+this.padding,d=b+n+p):"center"==h.textAlignment?
(b=this.originX+this.padding,d=this.originX+this.width/2):"right"==h.textAlignment&&(b=this.originX+this.width-this.padding-n,d=b-p),a.strokeStyle=h.swatchSelected?"black":h.swatchHighlighted?"grey":this.backgroundColor.rgbaString,m=c.pixel(2),a.strokeRect(b-m,f-m,n+2*m,n+2*m),a.fillStyle=h.swatchColor.rgbaString,a.fillRect(b,f,n,n)):"left"==h.textAlignment?d=this.originX+this.padding:"center"==h.textAlignment?d=this.originX+this.width/2:"right"==h.textAlignment&&(d=this.originX+this.width-this.padding);
a.fillStyle=h.fontColor.rgbaString;a.fillText(h.text,d,f);f+=1.5*l}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._legends.push(this)}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){this._position=a;this._updateOrigin()}},backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==
a?this.viewer.backgroundColor:"Color"==a.toString()?a:new c.Color(a)}},backgroundOpacity:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor.opacity},set:function(a){this._backgroundColor.opacity=a}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a)}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor.rgbaString},set:function(a){this._fontColor.color=a}},textAlignment:{configurable:!0,
enumerable:!0,get:function(){return this._textAlignment},set:function(a){this._textAlignment=a}}});c.Legend=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;this._canvas=a.canvas;this._labels=new c.CGArray;this.font=c.defaultFor(d.font,"SansSerif, plain, 12");this.labelLineLength=c.defaultFor(d.labelLineLength,20);this._labelLineMargin=c.pixel(10);this._labelLineWidth=c.pixel(1)};b.prototype.addLabel=function(a){this._labels.push(a);this.sort()};b.prototype.removeLabel=function(a){this._labels=this._labels.remove(a)};b.prototype.sort=function(){this._labels.sort(function(a,d){return a.bp>
d.bp?1:-1})};b.prototype.refreshLabelWidths=function(){for(var a=this._labels.map(function(a){return a.font.css}),d=this._labels.map(function(a){return a.name}),a=c.Font.calculateWidths(this._canvas.ctx,a,d),d=0,b=this._labels.length;d<b;d++)this._labels[d].width=a[d]};b.prototype._calculateLabelRects=function(){for(var a=this._canvas,d=a.scale,b,f,e,k=this._outerRadius+this._labelLineMargin,h=0,l=this._labels.length;h<l;h++)b=this._labels[h],f=b.feature,e=f.start+f.length/2,f=d.bp(e),a.pointFor(e,
k),e=a.pointFor(e,k+this.labelLineLength),b.lineAttachment=c.clockPositionForAngle(f+Math.PI),f=c.rectOriginForAttachementPoint(e,b.lineAttachment,b.width,b.height),b.rect=new c.Rect(f.x,f.y,b.width,b.height)};b.prototype.visibleLabels=function(a){var d=new c.CGArray;if(a=this._canvas.visibleRangeForRadius(a))for(var b=0,f=this._labels.length;b<f;b++)a.contains(this._labels[b].bp)&&d.push(this._labels[b]);else d=this._labels;return d};b.prototype.draw=function(a,d){this._innerRadius=a;this._outerRadius=
d;this._calculateLabelRects();this._labelsToDraw=this.visibleLabels(d);var b=new c.CGArray;this._visibleLabels=new c.CGArray;for(var f=0,e=this._labelsToDraw.length;f<e;f++)h=this._labelsToDraw[f],h.rect.overlap(b)||(this._visibleLabels.push(h),b.push(h.rect));var b=this._canvas,k=b.ctx,h,l;k.font=this.font.css;k.textAlign="left";f=0;for(e=this._visibleLabels.length;f<e;f++)h=this._visibleLabels[f],l=h.feature,b.radiantLine(h.bp,d+this._labelLineMargin,this.labelLineLength,this._labelLineWidth,l.color.rgbaString),
k.fillStyle=l.color.rgbaString,k.fillText(h.name,h.rect.x,h.rect.y);this.viewer.debug&&this.viewer.debug.data.n&&(this.viewer.debug.data.n.labels=this._visibleLabels.length)};Object.defineProperties(b.prototype,{labelLineLength:{configurable:!0,enumerable:!0,get:function(){return this._labelLineLength},set:function(a){this._labelLineLength=c.pixel(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.refreshLabelWidths()}},
viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},length:{configurable:!0,enumerable:!0,get:function(){return this._labels.length}}});c.LabelSet=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._feature=a;this.name=d.name;this.bp=this.feature.start+this.feature.length/2};Object.defineProperties(b.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){void 0==a||""==a?(this.width=0,""!=this._name&&void 0!=this._name&&this.labelSet.removeLabel(this),this._name=""):(""!=this._name&&void 0!=this._name||this.labelSet.addLabel(this),this._name=a,this.width=this.font.width(this.viewer.canvas.ctx,this._name))}},
rect:{configurable:!0,enumerable:!0,get:function(){return this._rect},set:function(a){this._rect=a}},width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.size}},origin:{configurable:!0,enumerable:!0,get:function(){return this._origin},set:function(a){this._origin=a}},lineAttachment:{configurable:!0,enumerable:!0,get:function(){return this._lineAttachment},set:function(a){this._lineAttachment=
a}},font:{configurable:!0,enumerable:!0,get:function(){return this._font||this.labelSet.font},set:function(a){this._font=void 0==a?this.labelSet.font:"Font"==a.toString()?a:new c.Font(a)}},viewer:{configurable:!0,enumerable:!0,get:function(){return this.feature.viewer}},labelSet:{configurable:!0,enumerable:!0,get:function(){return this.viewer.labelSet}},feature:{configurable:!0,enumerable:!0,get:function(){return this._feature}}});c.Label=b})(CGView);
(function(c){var b=function(a){this._viewer=a};b.prototype.load_json=function(a){var d=this._viewer,b=Math.min(a.height,a.width)/Math.min(d.height,d.width);a.sequence?d.sequence.seq=a.sequence.seq:d.sequence.length=c.defaultFor(a.sequenceLength,d.sequence.length);d.globalLabel=c.defaultFor(a.globalLabel,d.globalLabel);d.labelFont=c.defaultFor(a.labelFont,d.labelFont);d.ruler.font=c.defaultFor(a.rulerFont,d.ruler.font);d.backbone.radius=a.backboneRadius/b;d.backbone.color=c.defaultFor(a.backboneColor,
d.backbone.color);d.backbone.thickness=Math.ceil(a.backboneThickness/b);a.featureSlots&&a.featureSlots.forEach(function(a){new c.FeatureSlot(d,a)});a.legends&&a.legends.forEach(function(a){new c.Legend(d,a)});a=d.swatchedLegendItems();for(var b=a.length,f,e=d.features(),k,h=0,l=e.length;h<l;h++){k=e[h];for(var m=0;m<b;m++)if(f=a[m],k._color.rgbaString==f.swatchColor.rgbaString){k.legendItem=f;break}}e=d.arcPlots();h=0;for(l=e.length;h<l;h++)for(k=e[h],m=0;m<b;m++)f=a[m],k._color.rgbaString==f.swatchColor.rgbaString&&
(k.legendItem=f),k._colorPositive&&k._colorPositive.rgbaString==f.swatchColor.rgbaString&&(k.legendItemPositive=f),k._colorNegative&&k._colorNegative.rgbaString==f.swatchColor.rgbaString&&(k.legendItemNegative=f)};b.prototype.load_xml=function(a){a=b.xml_to_json(a);this.load_json(a)};b.xml_to_json=function(a){if(window.X2JS)return new X2JS({attributePrefix:""}),xmlToJson(a);console.log("X2JS needs to be installed to read CGView XML: https://github.com/abdmob/x2js")};b.json_to_xml=function(a){};b.prototype.exportImage=
function(a,d){var b=this._viewer,f=b.canvas;a=a||b.width;d=d||b.height;var e="CGV-Image-"+a+"x"+d;a/=c.pixel_ratio;d/=c.pixel_ratio;var k=f.ctx,h=b.debug;b.debug=!1;var l=d3.select("body").append("canvas").attr("width",a).attr("height",d).node();c.scale_resolution(l,c.pixel_ratio);f.ctx=l.getContext("2d");var m=d3.min([a,d])/b.minDimension;f.ctx.scale(m,m);b.draw_full();m=l.toDataURL();f.ctx=k;b.debug=h;d3.select(l).remove();f=window.open();b=["<html><head><title>",e,'</title></head><body><h2>Your CGView Image is Below</h2><p>To save, right click on either image below and choose "Save Image As...". The two images are the same. The first is scaled down for easier previewing, while the second shows the map at actual size. Saving either image will download the full size map.</p><h3>Preview</h3>',
'<img style="border: 1px solid grey" width="'+b.width+'" height="'+b.height+'" src="'+m+'"/ >',"<h3>Actual Size</h3>",'<img style="border: 1px solid grey" src="'+m+'"/ >',"</body><html>"].join("");f.document.write(b)};c.IO=b})(CGView);
(function(c){c.Help=function(b){this.viewer=b;this.dialog=new c.Dialog(b,{header_text:"CGView (CGV) Help",content_text:'The map can be scrolled around or scaled using the controls in the menu or by using the various mouse and keyboard shortcuts:<h3>Viewer Controls</h3><table class="cgv-table"><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>Zoom In/Out</td><td>Scroll wheel</td></tr><tr><td>Move Around</td><td>Click and Drag</td></tr></tbody></table><h3>Change Map</h3><table class="cgv-table"><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>Change Feature Colors</td><td>Click on color swatches in legend</td></tr></tbody></table><h3>Troubleshooting</h3><p>If the viewer is not showing any map or is slow, try updating to the latest version of your browser. We have found that <a href="https://www.google.com/chrome" target="_blank">Google Chrome</a> is the fastest.</p></div></div>',width:700,
height:350})}})(CGView);
(function(c){var b=function(a){this._rawFont=a};b.prototype.toString=function(){return"Font"};b.prototype.cssScaled=function(a){return a&&1!=a?this._styleAsCss()+" "+this.size*a+"px "+this.family:this.css};b.prototype.width=function(a,d){a.font=this.css;return a.measureText(d).width};b.prototype._styleAsCss=function(){return"plain"==this.style?"normal":"bold"==this.style?"bold":"italic"==this.style?"italic":"bold-italic"==this.style?"italic bold":""};b.prototype._generateFont=function(){this._font=
this._styleAsCss()+" "+this.size+"px "+this.family};Object.defineProperties(b.prototype,{_rawFont:{configurable:!0,enumerable:!0,set:function(a){if("string"===typeof a||a instanceof String)this.string=a;else{var d=new c.CGArray(Object.keys(a));d.contains("family")&&d.contains("style")&&d.contains("size")?(this.family=a.family,this.style=a.style,this.size=a.size):console.log("Font objects require the following keys: family, style, and size")}}},string:{configurable:!0,enumerable:!0,get:function(){return this.family+
","+this.style+","+this.size},set:function(a){a=a.replace(/ +/g,"");a=a.split(",");3==a.length?(this.family=a[0],this.style=a[1],this.size=a[2]):console.log("Font must have 3 parts");this._generateFont()}},css:{configurable:!0,enumerable:!0,get:function(){return this._font}},family:{configurable:!0,enumerable:!0,get:function(){return this._family||"sans-serif"},set:function(a){this._family=a;this._generateFont()}},size:{configurable:!0,enumerable:!0,get:function(){return this._size||c.pixel(12)},
set:function(a){this._size=c.pixel(Number(a));this._generateFont()}},style:{configurable:!0,enumerable:!0,get:function(){return this._style||"plain"},set:function(a){this._style=a;this._generateFont()}},height:{configurable:!0,enumerable:!0,get:function(){return this.size}}});b.calculateWidths=function(a,d,b){a.save();for(var f=[],c=[],k=0,h=d.length;k<h;k++)c.push({index:k,font:d[k],text:b[k]});c.sort(function(a,d){return a.font>d.font?1:-1});d="";k=0;for(h=c.length;k<h;k++)b=c[k].font,text=c[k].text,
b!=d&&(d=a.font=b),f[c[k].index]=a.measureText(text).width;a.restore();return f};c.Font=b})(CGView);
(function(c){var b=function(a,d,b,f){d=void 0===d?{}:d;this.viewer=a;this._strand=c.defaultFor(d.strand,"direct");this._features=new c.CGArray;this._arcPlot;this.proportionOfRadius=c.defaultFor(d.proportionOfRadius,.1);this._featureStarts=new c.CGArray;if(d.features){var e=this;d.features.forEach(function(a){new c.Feature(e,a)});this.refresh()}d.arcPlot&&new c.ArcPlot(this,d.arcPlot)};b.prototype.isDirect=function(){return"direct"==this.strand};b.prototype.isReverse=function(){return"reverse"==this.strand};
b.prototype.pixelsPerBp=function(){return 2*this.radius*Math.PI/this.sequence.length};b.prototype.refresh=function(){this._features.sort(function(a,d){return a.start-d.start});this._featureStarts=new c.CGArray;for(var a=0,d=this._features.length;a<d;a++)this._featureStarts.push(this._features[a].start);this._largestFeatureLength=this.findLargestFeatureLength()};b.prototype.findLargestFeatureLength=function(){for(var a=0,d=0,b=this._features.length;d<b;d++){var c=this._features[d].length;c>a&&(a=c)}return a};
b.prototype.draw=function(a,d,b,c){var e=a.visibleRangeForRadius(b,c);this._visibleRange=e;this._radius=b;this._thickness=c;if(e){var k=e.start,h=e.stop;if(this.hasFeatures){var l=this._features.length,m=this.largestFeatureLength;m<=this.sequence.length-Math.abs(k-h)&&this.sequence.subtractBp(k,h)>m&&(k=e.getStartPlus(-m),l=this._featureStarts.countFromRange(k,h));if(d&&2E3<l)a.drawArc(1,this.sequence.length,b,"rgba(0,0,200,0.03)",c);else{var n=this;this._featureStarts.eachFromRange(k,h,1,function(d){n._features[d].draw(a,
b,c,e)})}this.viewer.debug&&this.viewer.debug.data.n&&(d=this.viewer._featureSlots.indexOf(this),this.viewer.debug.data.n["slot_"+d]=l)}else this.hasArcPlot&&this._arcPlot.draw(a,b,c,d,e)}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._featureSlots.push(this)}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},proportionOfRadius:{configurable:!0,enumerable:!0,get:function(){return this._proportionOfRadius},
set:function(a){this._proportionOfRadius=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._radius}},thickness:{configurable:!0,enumerable:!0,get:function(){return this._thickness}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand}},hasFeatures:{configurable:!0,enumerable:!0,get:function(){return 0<this._features.length}},hasArcPlot:{configurable:!0,enumerable:!0,get:function(){return this._arcPlot}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}},
largestFeatureLength:{configurable:!0,enumerable:!0,get:function(){return this._largestFeatureLength}}});c.FeatureSlot=b})(CGView);
(function(c){var b=function(a,d,b,f){d=void 0===d?{}:d;this.featureSlot=a;this._color=new c.Color(d.color);this.opacity=parseFloat(d.opacity);this.range=new c.CGRange(this.viewer.sequence,Number(d.start),Number(d.stop));this.label=new c.Label(this,{name:d.label});this._radiusAdjustment=Number(d.radiusAdjustment)||0;this._proportionOfThickness=Number(d.proportionOfThickness)||1;this._decoration=c.defaultFor(d.decoration,"arc")};b.prototype.draw=function(a,d,b,c){if(this.range.overlapsRange(c)){var e=
this.start,k=this.stop,h=c.contains(e),l=c.contains(k);h||(e=c.start-100);l||(k=c.stop+100);this.viewer.zoomFactor>a.drawArcsCutoff&&h&&l&&this.range.overHalfCircle()?(a.drawArc(c.start-100,k,this.adjustedRadius(d,b),this.color.rgbaString,this.adjustedWidth(b),this.decoration),a.drawArc(e,c.stop+100,this.adjustedRadius(d,b),this.color.rgbaString,this.adjustedWidth(b),this.decoration)):a.drawArc(e,k,this.adjustedRadius(d,b),this.color.rgbaString,this.adjustedWidth(b),this.decoration)}};b.prototype.adjustedRadius=
function(a,d){return 0==this._radiusAdjustment&&1==this._proportionOfThickness?a:0==this._radiusAdjustment?a-d/2+this._proportionOfThickness*d/2:a};b.prototype.adjustedWidth=function(a){return this._proportionOfThickness*a};Object.defineProperties(b.prototype,{featureSlot:{configurable:!0,enumerable:!0,get:function(){return this._featureSlot},set:function(a){this._featureSlot=a;a._features.push(this);this._viewer=a.viewer}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},
range:{configurable:!0,enumerable:!0,get:function(){return this._range},set:function(a){this._range=a}},start:{configurable:!0,enumerable:!0,get:function(){return this.range.start},set:function(a){this.range.start=a}},stop:{configurable:!0,enumerable:!0,get:function(){return this.range.stop},set:function(a){this.range.stop=a}},length:{configurable:!0,enumerable:!0,get:function(){return this.range.length}},label:{configurable:!0,enumerable:!0,get:function(){return this._label},set:function(a){this._label=
a}},color:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?this.legendItem.swatchColor:this._color},set:function(a){"Color"==a.toString()?this._color=a:this._color.setColor(a)}},opacity:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?this.legendItem.swatchOpacity:this._color.opacity},set:function(a){this._color.opacity=a}},decoration:{configurable:!0,enumerable:!0,get:function(){return this._decoration},set:function(a){this._decoration=a}},legendItem:{configurable:!0,
enumerable:!0,get:function(){return this._legendItem},set:function(a){this._legendItem=a}}});c.Feature=b})(CGView);
(function(c){var b=function(){this._handlers={}};b.prototype.on=function(b,g){var c=this._handlers;a(b);var h=b.replace(/\..*/,"");c[h]||(c[h]=[]);c[h].push(new d(b,g))};b.prototype.off=function(d,b){var c=this._handlers;a(d);var h=d.replace(/\..*/,""),l=g(d);1==arguments.length?l?h?c[h]=c[h].filter(function(a){return a.namespace!=l}):Object.keys(c).forEach(function(a){c[a]=c[a].filter(function(a){return a.namespace!=l})}):c[h]=void 0:c[h]=c[h].filter(function(a){return a.callback!=b})};b.prototype.trigger=
function(d,b){var c=this._handlers;a(d);var h=d.replace(/\..*/,""),l=g(d);Array.isArray(c[h])&&c[h].forEach(function(a){l?a.namespace==l&&a.callback.call(null,b):a.callback.call(null,b)})};var a=function(a){if("string"!=typeof a)throw Error("Type must be a string");},d=function(a,d){this.callback=d;this.event_type=a.replace(/\..*/,"");this.namespace=g(a)},g=function(a){return(result=a.match(/\.(.*)/))?result[1]:void 0};c.Events=b})(CGView);
(function(c){var b=function(a){var d=this;this._viewer=a;this.events=new c.Events;this._initializeMousemove();this._initializeClick();this.events.on("click",function(a){console.log(a)});this.events.on("mousemove",function(a){d.debug&&d.debug.data.position&&(d.debug.data.position.xy=a.mapX+", "+a.mapY,d.debug.data.position.bp=a.bp)});this._legendSwatchClick();this._legendSwatchMouseOver()};b.prototype._initializeMousemove=function(){var a=this;d3.select(this.canvas.canvasNode).on("mousemove.cgv",function(){a.events.trigger("mousemove",
a._createEvent(d3.event))})};b.prototype._initializeClick=function(){var a=this;d3.select(this.canvas.canvasNode).on("click.cgv",function(){event={d3:d3.event,canvasX:d3.event.x,canvasY:d3.event.y};a.events.trigger("click",a._createEvent(d3.event))})};b.prototype._createEvent=function(a){var d=this.canvas.scale,b=c.pixel(a.offsetX);a=c.pixel(a.offsetY);var f=d.x.invert(b),d=d.y.invert(a),e=Math.sqrt(f*f+d*d);return{bp:this.canvas.bpForPoint({x:f,y:d}),radius:e,canvasX:b,canvasY:a,mapX:f,mapY:d,d3:d3.event}};
b.prototype._legendSwatchClick=function(){var a=this.viewer;this.events.on("click.swatch",function(d){for(var b=a.swatchedLegendItems(),c=0,e=b.length;c<e;c++)if(b[c]._swatchContainsPoint({x:d.canvasX,y:d.canvasY})){var k=b[c];d=0;for(e=b.length;d<e;d++)b[d].swatchSelected=!1;k.swatchSelected=!0;b=a.colorPicker;b.visible||k.legend.setColorPickerPosition(b);b.onChange=function(a){k.swatchColor=a.rgbaString;cgv.draw()};b.onClose=function(){k.swatchSelected=!1;cgv.draw()};b.setColor(k._swatchColor.rgba);
b.open();break}})};b.prototype._legendSwatchMouseOver=function(){var a=this,d=this.viewer;this.events.on("mousemove.swatch",function(b){for(var c=d.swatchedLegendItems(),e=!1,k=0,h=c.length;k<h;k++)if(c[k]._swatchContainsPoint({x:b.canvasX,y:b.canvasY})){b=c[k];e=0;for(h=c.length;e<h;e++)c[e].swatchHighlighted=!1;e=!0;b.swatchHighlighted=!0;a.canvas.cursor="pointer";b.legend.draw(a.canvas.ctx);break}if(!e)for(k=0,h=c.length;k<h;k++)if(b=c[k],b.swatchHighlighted){b.swatchHighlighted=!1;a.canvas.cursor=
"auto";b.legend.draw(a.canvas.ctx);break}})};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}}});c.EventMonitor=b})(CGView);
(function(c){var b=function(a,b){var g=this;b=b||{};this._wrapper=a._wrapper.node();this.fadeTime=c.defaultFor(b.fadeTime,500);this.header_text=c.defaultFor(b.header_text,"");this.content_text=c.defaultFor(b.content_text,"");this.height=c.defaultFor(b.height,300);this.width=c.defaultFor(b.width,300);this.buttons=b.buttons;this.box=d3.select(this._wrapper).append("div").style("display","none").attr("class","cgv-dialog");this.header=this.box.append("div").attr("class","cgv-dialog-header").html(this.header_text);
this.dismiss=this.box.append("div").attr("class","cgv-dialog-dismiss").html("X").on("click",function(){g.close()});this.contents=this.box.append("div").attr("class","cgv-dialog-contents cgv-scroll");this.buttons&&(this.footer=this.box.append("div").attr("class","cgv-dialog-footer"),this._generate_buttons());this.contents.html(this.content_text);this._adjust_size();return this};b.prototype.open=function(a){a=c.defaultFor(a,this.fadeTime);this._adjust_size();this.box.style("display","block");this.box.transition().duration(a).style("opacity",
1);return this};b.prototype.close=function(a){a=c.defaultFor(a,this.fadeTime);this.box.transition().duration(a).style("opacity",0).on("end",function(){d3.select(this).style("display","none")});return this};b.prototype._generate_buttons=function(){var a=this;Object.keys(this.buttons).forEach(function(b){a.footer.append("button").html(b).attr("class","cgv-button").on("click",function(){a.buttons[b].call(a)})})};b.prototype._adjust_size=function(){var a=this._wrapper.offsetWidth,b=this._wrapper.offsetHeight,
c=this.width,f=this.height;this.height>b-50&&(f=b-50);this.width>a-50&&(c=a-50);a=f-40-(this.buttons?35:0);this.box.style("width",c+"px").style("height",f+"px");this.contents.style("height",a+"px")};Object.defineProperties(b.prototype,{visible:{configurable:!0,enumerable:!0,get:function(){return"none"!=this.box.style("display")}},fadeTime:{configurable:!0,enumerable:!0,get:function(){return this._fadeTime},set:function(a){this._fadeTime=a}}});c.Dialog=b})(CGView);
(function(c){var b=function(a){a=void 0===a?{}:a;this._data={};this._sections=c.defaultFor(a.sections,[]);a=$jscomp.makeIterator(this.sections);for(var b=a.next();!b.done;b=a.next())this.data[b.value]={}};b.prototype.draw=function(a,b,g){b=void 0===b?10:b;g=void 0===g?20:g;b=c.pixel(b);g=c.pixel(g);var f=this._data,e=this._sections;a.font=c.pixel(10)+"pt Sans-Serif";a.fillStyle="black";var k=c.pixel(18);a.textAlign="left";!0===this.debug&&Object.keys(f);var h=0;e.forEach(function(c){Object.keys(f[c]).forEach(function(e){a.fillText(c+
"|"+e+": "+f[c][e],b,g+k*h);h+=1})})};Object.defineProperties(b.prototype,{sections:{configurable:!0,enumerable:!0,get:function(){return this._sections}},data:{configurable:!0,enumerable:!0,get:function(){return this._data}}});c.Debug=b})(CGView);
(function(c){function b(a,b,d){a=document.createElementNS("http://www.w3.org/2000/svg",a);for(var c in b)a.setAttribute(c,b[c]);"[object Array]"!=Object.prototype.toString.call(d)&&(d=[d]);b=0;for(c=d[0]&&d.length||0;b<c;b++)a.appendChild(d[b]);return a}function a(a){var b=a.offsetWidth,d=a.offsetHeight;a=d3.mouse(a);a={x:a[0],y:a[1]};a.x>b?a.x=b:0>a.x&&(a.x=0);a.y>d?a.y=d:0>a.y&&(a.y=0);return a}var d=function(a,b){b=void 0===b?{}:b;this.containerId=a;this.container=d3.select("#"+a).node();this._width=
c.defaultFor(b.width,100);this._height=c.defaultFor(b.height,100);this._color=new c.Color(c.defaultFor(b.colorString,"rgba(255,0,0,1)"));this.hsv=this._color.hsv;this.opacity=this._color.opacity;this.onChange=b.onChange;this.onClose=b.onClose;this.container.innerHTML=this._colorpickerHTMLSnippet();d3.select(this.container).classed("cp-dialog",!0);this.dialogElement=this.container.getElementsByClassName("cp-dialog")[0];this.slideElement=this.container.getElementsByClassName("cp-color-slider")[0];this.pickerElement=
this.container.getElementsByClassName("cp-color-picker")[0];this.alphaElement=this.container.getElementsByClassName("cp-alpha-slider")[0];this.slideIndicator=this.container.getElementsByClassName("cp-color-slider-indicator")[0];this.pickerIndicator=this.container.getElementsByClassName("cp-color-picker-indicator")[0];this.alphaIndicator=this.container.getElementsByClassName("cp-alpha-slider-indicator")[0];this.currentColorIndicator=this.container.getElementsByClassName("cp-color-current")[0];this.originalColorIndicator=
this.container.getElementsByClassName("cp-color-original")[0];this.doneButton=this.container.getElementsByClassName("cp-done-button")[0];this._configureView();this.slideIndicator.style.pointerEvents="none";this.pickerIndicator.style.pointerEvents="none";this.alphaIndicator.style.pointerEvents="none";d3.select(this.slideElement).on("mousedown.click",this.slideListener());d3.select(this.pickerElement).on("mousedown.click",this.pickerListener());d3.select(this.alphaElement).on("mousedown.click",this.alphaListener());
d3.select(this.originalColorIndicator).on("mousedown.click",this.originalColorListener());d3.select(this.doneButton).on("mousedown.click",this.doneListener());this.enableDragging(this,this.slideElement,this.slideListener());this.enableDragging(this,this.pickerElement,this.pickerListener());this.enableDragging(this,this.alphaElement,this.alphaListener());this.enableDragging(this,this.container,this.dialogListener());d3.select(this.container).style("visibility","hidden")};d.prototype.updateColor=function(){this._color.hsv=
this.hsv;this._color.opacity=this.opacity;this.updateIndicators();var a=c.Color.rgb2String(c.Color.hsv2rgb({h:this.hsv.h,s:1,v:1}));this.pickerElement.style.backgroundColor=a;d3.select(this.alphaElement).selectAll("stop").attr("stop-color",this.color.rgbString);this.currentColorIndicator.style.backgroundColor=this.color.rgbaString;this.onChange&&this.onChange(this.color)};d.prototype.setColor=function(a){this._color.setColor(a);this.hsv=this._color.hsv;this.opacity=this._color.opacity;this.originalColorIndicator.style.backgroundColor=
this._color.rgbaString;this.updateColor()};d.prototype.updateIndicators=function(){var a=this.hsv,b=this.pickerElement.offsetHeight,d=a.s*this.pickerElement.offsetWidth,b=b-a.v*b,c=this.alphaElement.offsetWidth*this.opacity,h=this.pickerIndicator,l=this.slideIndicator,m=this.alphaIndicator;l.style.top=a.h*this.slideElement.offsetHeight/360-l.offsetHeight/2+"px";h.style.top=b-h.offsetHeight/2+"px";h.style.left=d-h.offsetWidth/2+"px";m.style.left=c-m.offsetWidth/2+"px"};d.prototype.setPosition=function(a){this.container.style.left=
a.x+"px";this.container.style.top=a.y+"px"};d.prototype._colorpickerHTMLSnippet=function(){return'<div class="cp-color-picker-wrapper"><div class="cp-color-picker"></div><div class="cp-color-picker-indicator"><div class="cp-picker-indicator-rect-1"></div><div class="cp-picker-indicator-rect-2"></div></div></div><div class="cp-color-slider-wrapper"><div class="cp-color-slider"></div><div class="cp-color-slider-indicator"><div class="cp-color-indicator-rect-1"></div><div class="cp-color-indicator-rect-2"></div></div></div><div class="cp-alpha-slider-wrapper"><div class="cp-alpha-slider"></div><div class="cp-alpha-slider-indicator"><div class="cp-alpha-indicator-rect-1"></div><div class="cp-alpha-indicator-rect-2"></div></div></div><div class="cp-dialog-footer"><div class="cp-footer-color-section"><div class="cp-color-original"></div><div class="cp-color-current"></div></div><div class="cp-footer-button-section"><button class="cp-done-button">Done</button></div></div>'};
d.prototype._configureView=function(){var a,d,c;c=this.containerId;a=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"20px",height:"100px"},[b("defs",{},b("linearGradient",{id:c+"-gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),b("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),b("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),b("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),
b("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),b("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),b("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),b("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),b("rect",{x:"0",y:"0",width:"20px",height:"100px",fill:"url(#"+c+"-gradient-hsv)"})]);d=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100px",height:"100px"},
[b("defs",{},[b("linearGradient",{id:c+"-gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),b("linearGradient",{id:c+"-gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),b("rect",{x:"0",y:"0",width:"100px",height:"100px",
fill:"url(#"+c+"-gradient-white)"}),b("rect",{x:"0",y:"0",width:"100px",height:"100px",fill:"url(#"+c+"-gradient-black)"})]);c=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"127px",height:"10px",style:"position: absolute;"},[b("defs",{},[b("linearGradient",{id:c+"-alpha-gradient"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"0"}),b("stop",{offset:"100%","stop-color":"#FFFFFF","stop-opacity":"1"})]),b("pattern",{id:c+"-alpha-squares",x:"0",y:"0",width:"10px",height:"10px",
patternUnits:"userSpaceOnUse"},[b("rect",{x:"0",y:"0",width:"10px",height:"10px",fill:"white"}),b("rect",{x:"0",y:"0",width:"5px",height:"5px",fill:"lightgray"}),b("rect",{x:"5px",y:"5px",width:"5px",height:"5px",fill:"lightgray"})])]),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+c+"-alpha-squares)"}),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+c+"-alpha-gradient)"})]);this.slideElement.appendChild(a);this.pickerElement.appendChild(d);this.alphaElement.appendChild(c)};
d.prototype.enableDragging=function(b,d,c){d3.select(d).on("mousedown",function(){d3.event.preventDefault();d3.event.stopPropagation();var b=a(d);d3.select(document).on("mousemove.colordrag",function(){document.selection?document.selection.empty():window.getSelection().removeAllRanges();c(b)});d3.select(document).on("mouseup",function(){d3.select(document).on("mousemove.colordrag",null)})})};d.prototype.slideListener=function(){var b=this,d=b.slideElement;return function(){var c=a(d);b.hsv.h=c.y/
d.offsetHeight*360;359<=b.hsv.h&&(b.hsv.h=359);b.updateColor()}};d.prototype.pickerListener=function(){var b=this,d=b.pickerElement;return function(){var c=d.offsetWidth,k=d.offsetHeight,h=a(d);b.hsv.s=h.x/c;b.hsv.v=(k-h.y)/k;b.updateColor()}};d.prototype.alphaListener=function(){var b=this,d=b.alphaElement;return function(){var c=a(d);b.opacity=c.x/d.offsetWidth;b.updateColor()}};d.prototype.dialogListener=function(){var a=this.container;return function(b){a.style.left=d3.event.pageX-b.x+"px";a.style.top=
d3.event.pageY-b.y+"px"}};d.prototype.originalColorListener=function(){var a=this;return function(){a.setColor(a.originalColorIndicator.style.backgroundColor)}};d.prototype.doneListener=function(){var a=this;return function(){a.onChange=void 0;a.close()}};d.prototype.open=function(){var a=d3.select(this.container);a.style("visibility","visible");a.transition().duration(200).style("opacity",1);return this};d.prototype.close=function(){d3.select(this.container).transition().duration(200).style("opacity",
0).on("end",function(){d3.select(this).style("visibility","hidden")});this.onClose&&this.onClose();this.onClose=void 0;return this};Object.defineProperties(d.prototype,{color:{configurable:!0,enumerable:!0,get:function(){return this._color}},width:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetWidth}},height:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetHeight}},visible:{configurable:!0,enumerable:!0,get:function(){return"visible"==d3.select(this.container).style("visibility")},
set:function(a){a?this.open():this.close()}}});c.ColorPicker=d})(CGView);
(function(c){var b=function(a){this.setColor(a)};b.prototype.toString=function(){return"Color"};b.prototype.setColor=function(a){if("string"===typeof a||a instanceof String)this._string=a;else{var b=new c.CGArray(Object.keys(a));b.contains("h")&&b.contains("s")&&b.contains("v")?this.hsv=a:b.contains("r")&&b.contains("g")&&b.contains("b")&&b.contains("a")?this.rgba=a:b.contains("r")&&b.contains("g")&&b.contains("b")&&(this.rgb=a)}};b.prototype._updateRgbaOpacity=function(){var a=this;this._rgbaString=
this._rgbaString.replace(/^(rgba\(.*,)([\d\.]+?)(\))/,function(b,c,f,e){return c+a.opacity+e})};b.prototype._updateOpacityFromRgba=function(){var a=/^rgba.*,([\d\.]+?)\)$/.exec(this.rgbaString);a&&(this._opacity=b._validateOpacity(a[1]))};Object.defineProperties(b.prototype,{_string:{configurable:!0,enumerable:!0,set:function(a){a=b.string2rgba(a,this.opacity);this._rgbaString=b.rgba2String(a);this._updateOpacityFromRgba()}},opacity:{configurable:!0,enumerable:!0,get:function(){return void 0==this._opacity?
1:this._opacity},set:function(a){this._opacity=b._validateOpacity(a);this._updateRgbaOpacity()}},rgbaString:{configurable:!0,enumerable:!0,get:function(){return this._rgbaString}},rgbString:{configurable:!0,enumerable:!0,get:function(){return b.rgb2String(this.rgb)}},rgb:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+)/.exec(this.rgbaString);return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3])}:void 0},set:function(a){this._string=b.rgb2String(a);this._updateOpacityFromRgba()}},
rgba:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)/.exec(this.rgbaString);return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0},set:function(a){this._string=b.rgba2String(a);this._updateOpacityFromRgba()}},hsv:{configurable:!0,enumerable:!0,get:function(){return b.rgb2hsv(this.rgb)},set:function(a){a=b.hsv2rgb(a);a.a=this.opacity;this.rgba=a}},hex:{configurable:!0,enumerable:!0,get:function(){}},hla:{configurable:!0,enumerable:!0,
get:function(){}}});b.string2rgba=function(a,d){d=void 0===d?1:d;if(/^#/.test(a))return b.hexString2rgba(a,d);if(/^rgb\(/.test(a))return b.rgbString2rgba(a,d);if(/^rgba\(/.test(a))return b.rgbaString2rgba(a,d);if(/^hsl\(/.test(a))return b.hslStringToRgba(a,d);var c=b.name2HexString(a);return b.hexString2rgba(c,d)};b._validateOpacity=function(a){a=Number(a);isNaN(a)?a=1:1<a?a=1:0>a&&(a=0);return a};b._validateRgba=function(a){return{r:b._validateRgbNumber(a.r),g:b._validateRgbNumber(a.g),b:b._validateRgbNumber(a.b),
a:b._validateOpacity(a.a)}};b._validateRgbNumber=function(a){a=Number(a);NaN==a?a=0:255<a?a=255:0>a&&(a=0);return a};b.rgbString2rgba=function(a,b){b=void 0===b?1:b;a=a.replace(/ +/g,"");var c=/^rgb\((\d+),(\d+),(\d+)\)/.exec(a);return c?{r:Number(c[1]),g:Number(c[2]),b:Number(c[3]),a:b}:void 0};b.rgbaString2rgba=function(a){a=a.replace(/ +/g,"");return(a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)\)/.exec(a))?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0};b.hslStringToRgba=function(a){console.log("NOT IMPLEMENTED")};
b.rgb2hsv=function(a){var b=a.r,c=a.g,f=a.b;if(1<b||1<c||1<f)b/=255,c/=255,f/=255;var e;a=Math.max(b,c,f);e=a-Math.min(b,c,f);b=(0==e?0:a==b?(c-f)/e+(c<f?6:0):a==c?(f-b)/e+2:(b-c)/e+4)%6*60;return{h:b,s:0==e?0:e/a,v:a}};b.hsv2rgb=function(a){var b,c,f,e,k=a.h%360/60;e=a.v*a.s;f=e*(1-Math.abs(k%2-1));a=b=c=a.v-e;k=~~k;a+=[e,f,0,0,f,e][k];b+=[f,e,e,f,0,0][k];c+=[0,0,f,e,e,f][k];return{r:Math.floor(255*a),g:Math.floor(255*b),b:Math.floor(255*c)}};b.hexString2rgba=function(a,b){b=void 0===b?1:b;a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,
function(a,b,d,c){return b+b+d+d+c+c});var c=0,f=0,e=0,k=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);k&&(c=parseInt(k[1],16),f=parseInt(k[2],16),e=parseInt(k[3],16));return{r:c,g:f,b:e,a:b}};b.rgba2String=function(a){a=b._validateRgba(a);return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"};b.rgb2String=function(a){return"rgb("+a.r+","+a.g+","+a.b+")"};b.name2HexString=function(a){a=a.toLowerCase();if(a=b.names()[a])return a;console.log("Name not found! Defaulting to Black");return"#000000"};b.names=
function(){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}};c.Color=b})(CGView);
(function(c){var b=function(a,b,g){g=void 0===g?{}:g;this._viewer=a;this.width=c.defaultFor(g.width,600);this.height=c.defaultFor(g.height,600);this.scale={};this._drawArcsCutoff=1E4;this.canvasNode=b.append("canvas").classed("cgv-viewer",!0).style("border","1px solid #DDD").attr("width",this._width).attr("height",this._height).node();this.canvasNode.getContext||b.html("<h3>CGView requires Canvas, which is not supported by this browser.</h3>");c.pixel_ratio=c.get_pixel_ratio(this.canvasNode);c.scale_resolution(this.canvasNode,
c.pixel_ratio);this.ctx=this.canvasNode.getContext("2d");this.refreshScales()};b.prototype.refreshScales=function(){var a,b,c,f;this.scale.x?(b=this.scale.x.domain(),f=b[1]-b[0],a=b[0]/f,b=b[1]/f):(a=-.5,b=.5);if(this.scale.y){var e=this.scale.y.domain();f=e[0]-e[1];c=e[0]/f;f=e[1]/f}else c=.5,f=-.5;this.scale.x=d3.scaleLinear().domain([this.width*a,this.width*b]).range([0,this.width]);this.scale.y=d3.scaleLinear().domain([this.height*c,this.height*f]).range([0,this.height])};b.prototype.clear=function(a){this.ctx.fillStyle=
void 0===a?"white":a;this.ctx.fillRect(0,0,c.pixel(this.width),c.pixel(this.height))};b.prototype.flash=function(a){var b=this.ctx;b.textAlign="center";b.textBaseline="center";b.fillText(a,this.width/2,this.height/2)};b.prototype.drawArc=function(a,b,c,f,e,k){f=void 0===f?"#000000":f;e=void 0===e?1:e;k=void 0===k?"arc":k;var h=this.ctx;"arc"==k&&(h.beginPath(),h.strokeStyle=f,h.lineWidth=e,this.arcPath(c,a,b),h.stroke());if("arc"!=k){var l=e/2/this.pixelsPerBp(c),m=this.sequence.lengthOfRange(a,b);
m<l&&(m=a+m/2,a=m-l/2,b=m+l/2);m="clockwise-arrow"==k?a:b;a="clockwise-arrow"==k?b:a;k="clockwise-arrow"==k?1:-1;e/=2;l=a-k*l;a=this.pointFor(a,c);b=this.pointFor(l,c-e);h.beginPath();h.fillStyle=f;this.arcPath(c+e,m,l,-1==k);h.lineTo(a.x,a.y);h.lineTo(b.x,b.y);this.arcPath(c-e,l,m,1==k,!0);h.closePath();h.fill()}};b.prototype.arcPath=function(a,b,c,f,e){f=void 0===f?!1:f;e=void 0===e?!1:e;var k=this.ctx,h=this.scale;this.viewer.zoomFactor<this.drawArcsCutoff?k.arc(h.x(0),h.y(0),a,h.bp(b),h.bp(c),
f):(b=this.pointFor(b,a),a=this.pointFor(c,a),e||k.moveTo(b.x,b.y),k.lineTo(a.x,a.y))};b.prototype.radiantLine=function(a,b,c,f,e){f=void 0===f?1:f;e=void 0===e?"black":e;var k=this.pointFor(a,b);a=this.pointFor(a,b+c);b=this.ctx;b.beginPath();b.moveTo(k.x,k.y);b.lineTo(a.x,a.y);b.strokeStyle=e;b.lineWidth=f;b.stroke()};b.prototype.pointFor=function(a,b){var c=this.scale.bp(a),f=this.scale.x(0)+b*Math.cos(c),c=this.scale.y(0)+b*Math.sin(c);return{x:f,y:c}};b.prototype.bpForPoint=function(a){return Math.round(this.scale.bp.invert(c.angleFromPosition(a.x,
a.y)))};b.prototype.visibleRangesForRadius=function(a,b){b=void 0===b?0:b;var g=this;return c.circleAnglesFromIntersectingRect(a,this.scale.x.invert(0-b),this.scale.y.invert(0-b),this.width+2*b,this.height+2*b).map(function(a){return Math.round(g.scale.bp.invert(a))})};b.prototype.visibleRangeForRadius=function(a,b){b=void 0===b?0:b;var g=this.visibleRangesForRadius(a,b);return 2==g.length?new c.CGRange(this.sequence,g[0],g[1]):2<g.length?new c.CGRange(this.sequence,g[0],g[g.length-1]):a-b>this.maximumVisibleRadius()?
void 0:a+b<this.minimumVisibleRadius()?void 0:new c.CGRange(this.sequence,1,this.sequence.length)};b.prototype.centerVisible=function(){var a=this.scale.x(0),b=this.scale.y(0);return 0<=a&&a<=this.width&&0<=b&&b<=this.height};b.prototype.maximumVisibleRadius=function(){var a=Math.max(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width))),b=Math.max(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+b*b)};b.prototype.minimumVisibleRadius=
function(){if(this.centerVisible())return 0;if(c.oppositeSigns(this.scale.x.invert(0),this.scale.x.invert(this.width)))return Math.min(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));if(c.oppositeSigns(this.scale.y.invert(0),this.scale.y.invert(this.height)))return Math.min(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width)));var a=Math.min(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width))),b=Math.min(Math.abs(this.scale.y.invert(0)),
Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+b*b)};b.prototype.visibleRadii=function(a){return{min:this.minimumVisibleRadius(),max:this.maximumVisibleRadius()}};b.prototype.pixelsPerBp=function(a){return 2*a*Math.PI/this.sequence.length};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},width:{configurable:!0,enumerable:!0,get:function(){return c.pixel(this._width)},
set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return c.pixel(this._height)},set:function(a){this._height=a}},cursor:{configurable:!0,enumerable:!0,get:function(){return d3.select(this.canvasNode).style("cursor")},set:function(a){d3.select(this.canvasNode).style("cursor",a)}},drawArcsCutoff:{configurable:!0,enumerable:!0,get:function(){return this._drawArcsCutoff}}});c.Canvas=b})(CGView);
(function(c){var b=function(a,b,c){this._sequence=a;this.start=b;this.stop=c};b.prototype.overHalfCircle=function(){return this.length>this.sequenceLength/2};b.prototype.normalize=function(a){var b;return a>this.sequenceLength?(b=Math.floor(a/this.sequenceLength),a-this.sequenceLength*b):1>a?(b=Math.ceil(Math.abs(a/this.sequenceLength)),this.sequenceLength*b+a):a};b.prototype.getStartPlus=function(a){return this.normalize(this.start+a)};b.prototype.getStopPlus=function(a){return this.normalize(this.stop+
a)};b.prototype.isFullCircle=function(){return this.length==this.sequenceLength};b.prototype.spansOrigin=function(){return this.stop<this.start};b.prototype.contains=function(a){return this.stop>=this.start?a>=this.start&&a<=this.stop:a>=this.start||a<=this.stop};b.prototype.copy=function(){return new c.CGRange(this.sequence,this.start,this.stop)};b.prototype.overlapsRange=function(a){return this.contains(a.start)||this.contains(a.stop)||a.contains(this.start)};b.prototype.mergeWithRange=function(a){var b=
new c.CGRange(this.sequence,this.start,a.stop),g=new c.CGRange(this.sequence,a.start,this.stop);a=[this,a,b,g];for(var b=0,f,e=0,k=a.length;e<k;e++)g=a[e].length,g>b&&(b=g,f=a[e]);return f};Object.defineProperties(b.prototype,{sequence:{configurable:!0,enumerable:!0,get:function(){return this._sequence}},sequenceLength:{configurable:!0,enumerable:!0,get:function(){return this.sequence.length}},start:{configurable:!0,enumerable:!0,get:function(){return this._start},set:function(a){this._start=a}},
stop:{configurable:!0,enumerable:!0,get:function(){return this._stop},set:function(a){this._stop=a}},length:{configurable:!0,enumerable:!0,get:function(){return this.stop>=this.start?this.stop-this.start:this.sequenceLength+(this.stop-this.start)}},middle:{configurable:!0,enumerable:!0,get:function(){var a=this.start+this.length/2;return a>this.sequenceLength?a-this.sequenceLength:a}}});c.CGRange=b})(CGView);
(function(c){function b(a,b,c){return c.indexOf(a)===b}var a=function(){if(1==arguments.length&&Array.isArray(arguments[0]))for(var a=0,b=arguments[0].length;a<b;a++)this.push(arguments[0][a]);else 0<arguments.length&&this.push.apply(this,arguments)};a.prototype=Object.create(Array.prototype);a.prototype.toString=function(){return"CGArray"};a.prototype.merge=function(a){for(var b=0,c=a.length;b<c;b++)this.push(a[b]);return this};a.prototype.attr=function(a){if(1==arguments.length&&"object"==typeof a)for(var b=
Object.keys(a),c=b.length,e=0,k=this.length;e<k;e++)for(var h=0;h<c;h++)this[e][b[h]]=a[b[h]];else if(2==arguments.length)for(b=0,c=this.length;b<c;b++)this[b][arguments[0]]=arguments[1];else if(void 0!=a)throw Error("attr(): must be 2 arguments or a single object");return this};a.prototype.draw=function(a,b,c,e,k){for(var h=0,l=this.length;h<l;h++)this[h].draw(a,b,c,e,k);return this};a.prototype.each=function(a){for(var b=0,c=this.length;b<c;b++)a.call(this[b],b,this[b]);return this};a.prototype.eachFromRange=
function(a,b,f,e){var k=c.indexOfValue(this,a,!0);f=c.indexOfValue(this,b,!1);if(b>=a)a=k;else{a=k;for(b=this.length;a<b;a++)e.call(this[a],a,this[a]);a=0}for(;a<=f;a++)e.call(this[a],a,this[a]);return this};a.prototype.countFromRange=function(a,b,f){f=c.indexOfValue(this,a,!0);var e=c.indexOfValue(this,b,!1);a>this[this.length-1]&&f++;b<this[0]&&e--;return b>=a?e-f+1:this.length-f+e+1};a.prototype.contains=function(a){return 0<=this.indexOf(a)};a.prototype.remove=function(b){var c;return c=new a(this.filter(function(a){return a!=
b}))};a.prototype.empty=function(){return 0==this.length};a.prototype.present=function(){return 0<this.length};a.prototype.order_by=function(a,b){0<this.length&&("function"===typeof this[0][a]?this.sort(function(b,c){return b[a]()>c[a]()?1:b[a]()<c[a]()?-1:0}):this.sort(function(b,c){return b[a]>c[a]?1:b[a]<c[a]?-1:0}));b&&this.reverse();return this};a.prototype.lineWidth=function(a){for(var b=0,c=this.length;b<c;b++)this[b].lineWidth=a;return this};a.prototype.get=function(b){if(void 0==b)return this;
if(Number.isInteger(b))return this[b-1];if("string"==typeof b)return b.match(/^path-id-/)?this.filter(function(a){return a.path_id()==b})[0]:b.match(/^label-id-/)?this.filter(function(a){return a.label_id()==b})[0]:this.filter(function(a){return a.id==b})[0];if(Array.isArray(b)){var c=this.filter(function(a){return b.some(function(b){return a.id==b})}),f=new a;f.push.apply(f,c);return f}return new a};a.prototype.equals=function(a){if("CGArray"!=a.toString()&&!Array.isArray(a))return!1;var b=this.unique(),
c=a.unique(),e=!0;if(b.length!=c.length)return!1;b.forEach(function(a){c.contains(a)||(e=!1)});return e};a.prototype.unique=function(){return new a(this.filter(b))};a.prototype.find=function(a,b){if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var c=Object(this),e=c.length>>>0,k,h=0;h<e;h++)if(k=c[h],a.call(b,k,h,c))return k};c.CGArray=a})(CGView);
(function(c){var b=function(a,b){b=void 0===b?{}:b;this._viewer=a;var g=.4*d3.min([this.viewer.width,this.viewer.height]);this.radius=c.defaultFor(b.radius,g);this.color=c.defaultFor(b.color,"black");this.font=c.defaultFor(b.font,"sans-serif, plain, 14");this.fontColor=c.defaultFor(b.fontColor,"black");this.thickness=c.defaultFor(b.thickness,5);this._bpThicknessAddition=0;this.bpMargin=4};b.prototype.maxZoomFactor=function(){return this.sequence.length*this.bpSpacing/(2*Math.PI*this.radius)};b.prototype.pixelsPerBp=
function(){return c.pixel(2*this.zoomedRadius*Math.PI/this.sequence.length)};b.prototype._drawSequence=function(){var a=this.canvas.ctx,b=c.pixel(this.zoomedRadius),g=this.visibleRange;if(g){var f=this.sequence.forRange(g),e=c.Sequence.complement(f),k=g.start;a.save();a.fillStyle=this.fontColor.rgbaString;a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var h=this.bpSpacing/2+this.bpMargin,l=0,g=g.length;l<g;l++){var m=this.canvas.pointFor(k,b+h);a.fillText(f[l],m.x,m.y);m=this.canvas.pointFor(k,
b-h);a.fillText(e[l],m.x,m.y);k++}a.restore()}};b.prototype.draw=function(){this._visibleRange=this.canvas.visibleRangeForRadius(c.pixel(this.zoomedRadius),100);if(this.visibleRange)if(this.viewer.canvas.drawArc(this.visibleRange.start,this.visibleRange.stop,c.pixel(this.zoomedRadius),this.color.rgbaString,c.pixel(this.zoomedThickness)),1<this.pixelsPerBp()){var a=Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius),b=2*this.pixelsPerBp();this._bpThicknessAddition=
a+b>=this.maxThickness?this.maxThickness-a:b;this.pixelsPerBp()>=this.bpSpacing-this.bpMargin&&this._drawSequence()}else this._bpThicknessAddtion=0};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color=
"Color"==a.toString()?a:new c.Color(a)}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor="Color"==a.toString()?a:new c.Color(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.bpSpacing=this.font.size}},radius:{configurable:!0,enumerable:!0,set:function(a){a&&(this._radius=a,this.viewer._updateZoomMax())},get:function(){return this._radius}},
zoomedRadius:{configurable:!0,enumerable:!0,get:function(){return this.radius*this.viewer._zoomFactor}},thickness:{configurable:!0,enumerable:!0,set:function(a){a&&(this._thickness=a)},get:function(){return this._thickness}},zoomedThickness:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius)+this.bpThicknessAddition/c.pixel(1)}},maxThickness:{configurable:!0,enumerable:!0,get:function(){return 2*this.bpSpacing+
4*this.bpMargin}},bpSpacing:{configurable:!0,enumerable:!0,get:function(){return this._bpSpacing},set:function(a){this._bpSpacing=a;this.viewer._updateZoomMax()}},bpMargin:{configurable:!0,enumerable:!0,get:function(){return this._bpMargin},set:function(a){this._bpMargin=a}},bpThicknessAddition:{configurable:!0,enumerable:!0,get:function(){return this._bpThicknessAddition}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}}});c.Backbone=b})(CGView);
(function(c){var b=function(a,b,g,f){b=void 0===b?{}:b;this.featureSlot=a;this._bp=new c.CGArray;this._proportionOfThickness=new c.CGArray;this._color=new c.Color(c.defaultFor(b.color,"black"));this._colorPositive=b.colorPositive?new c.Color(b.colorPositive):void 0;this._colorNegative=b.colorNegative?new c.Color(b.colorNegative):void 0;b.bp&&(this._bp=new c.CGArray(b.bp));b.proportionOfThickness&&(this._proportionOfThickness=new c.CGArray(b.proportionOfThickness))};b.prototype.draw=function(a,b,c,
f,e){this.colorNegative.rgbaString==this.colorPositive.rgbaString?this._drawPath(a,b,c,f,e,this.colorPositive):(this._drawPath(a,b,c,f,e,this.colorPositive,"positive"),this._drawPath(a,b,c,f,e,this.colorNegative,"negative"))};b.prototype._drawPath=function(a,b,c,f,e,k,h){var l=this;f=a.ctx;var m=this._bp,n=this._proportionOfThickness,p=e.start;e=e.stop;f.beginPath();f.lineWidth=1E-4;var q=b,r=p,t,v,u,w;m.eachFromRange(p,e,1,function(e){w=v;v=n[e];u=m[e];t=b+n[e]*c;h&&0>w*v&&(q=t=b,a.arcPath(t,r,u,
!1,!0),r=u);l._keepPoint(v,h)?.5<=Math.abs(t-q)&&(a.arcPath(t,r,u,!1,!0),q=t,r=u):q=b});a.arcPath(q,r,e,!1,!0);var x=a.pointFor(e,b);f.lineTo(x.x,x.y);a.arcPath(b,e,p,!0,!0);f.fillStyle=k.rgbaString;f.fill()};b.prototype._keepPoint=function(a,b){return void 0==b||"positive"==b&&0<a||"negative"==b&&0>a?!0:!1};Object.defineProperties(b.prototype,{featureSlot:{configurable:!0,enumerable:!0,get:function(){return this._featureSlot},set:function(a){this._featureSlot=a;a._arcPlot=this;this._viewer=a.viewer}},
viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},color:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?this.legendItem.swatchColor:this._color}},colorPositive:{configurable:!0,enumerable:!0,get:function(){return this.legendItemPositive?this.legendItemPositive.swatchColor:this._colorPositive?this._colorPositive:this.color}},colorNegative:{configurable:!0,enumerable:!0,get:function(){return this.legendItemNegative?this.legendItemNegative.swatchColor:this._colorNegative?
this._colorNegative:this.color}},legendItem:{configurable:!0,enumerable:!0,get:function(){return this._legendItem},set:function(a){this._legendItem=a}},legendItemPositive:{configurable:!0,enumerable:!0,get:function(){return this._legendItemPositive},set:function(a){this._legendItemPositive=a}},legendItemNegative:{configurable:!0,enumerable:!0,get:function(){return this._legendItemNegative},set:function(a){this._legendItemNegative=a}}});c.ArcPlot=b})(CGView);
