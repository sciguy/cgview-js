var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(d){return"jscomp_symbol_"+d+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();if(d[Symbol.iterator])return d[Symbol.iterator]();if(!(d instanceof Array||"string"==typeof d||d instanceof String))throw new TypeError(d+" is not iterable");var b=0;return{next:function(){return b==d.length?{done:!0}:{done:!1,value:d[b++]}}}};$jscomp.arrayFromIterator=function(d){for(var b,a=[];!(b=d.next()).done;)a.push(b.value);return a};$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};
$jscomp.arrayFromArguments=function(d){for(var b=[],a=0;a<d.length;a++)b.push(d[a]);return b};$jscomp.inherits=function(d,b){function a(){}a.prototype=b.prototype;d.prototype=new a;d.prototype.constructor=d;for(var c in b)if($jscomp.global.Object.defineProperties){var f=$jscomp.global.Object.getOwnPropertyDescriptor(b,c);void 0!==f&&$jscomp.global.Object.defineProperty(d,c,f)}else d[c]=b[c]};var CGView={version:"0.1"};void 0===window.CGV&&(window.CGV=CGView);
(function(d){var b=function(a,c){c=void 0===c?{}:c;this.containerId=a.replace("#","");this._container=d3.select("#"+this.containerId);this._width=d.defaultFor(c.width,600);this._height=d.defaultFor(c.height,600);this._wrapper=this._container.append("div").attr("class","cgv-wrapper").style("position","relative").style("width",this.width+"px").style("height",this.height+"px");this.canvas=new d.Canvas(this,this._wrapper,{width:this.width,height:this.height});this._zoomFactor=1;this._features=new d.CGArray;
this._plots=new d.CGArray;this._captions=new d.CGArray;this._featureTypes=new d.CGArray;this.io=new d.IO(this);this._sequence=new d.Sequence(this,c.sequence);this.backbone=new d.Backbone(this,c.backbone);this.initializeDragging();this.initializeZooming();this.events=new d.Events;this.eventMonitor=new d.EventMonitor(this);this.messenger=new d.Messenger(this,c.messenger);this.settings=new d.Settings(this,c.settings);this.legend=new d.Legend(this,c.legend);this.slotDivider=new d.Divider(this,c.dividers&&
c.dividers.slot);this.layout=new d.Layout(this,c.layout);this.annotation=new d.Annotation(this,c.annotation);this.ruler=new d.Ruler(this,c.ruler);this.highlighter=new d.Highlighter(this,c.highlighter);this.debug=d.defaultFor(c.debug,!1)};b.prototype.resize=function(a,c,f,b){this._width=a||this.width;this._height=c||this.height;this._wrapper.style("width",this.width+"px").style("height",this.height+"px");this.canvas.resize(this.width,this.height);this.refreshCaptions();this.layout._adjustProportions();
this.draw(b)};b.prototype.slots=function(a){return this.layout.slots(a)};b.prototype.features=function(a){return this._features.get(a)};b.prototype.tracks=function(a){return this.layout.tracks(a)};b.prototype.plots=function(a){return this._plots.get(a)};b.prototype.captions=function(a){return this._captions.get(a)};b.prototype.featureTypes=function(a){return this._featureTypes.get(a)};b.prototype.clear=function(a){this.canvas.clear(void 0===a?"map":a)};b.prototype.flash=function(a){this.messenger.flash(a)};
b.prototype.maxZoomedRadius=function(){return 1*this.minDimension};b.prototype.fillBackground=function(){this.clear("background")};b.prototype.drawFull=function(){this.layout.drawFull()};b.prototype.drawFast=function(){this.layout.drawFast()};b.prototype.drawExport=function(){this.layout.drawExport()};b.prototype.draw=function(a){this.layout.draw(a)};b.prototype.findFeatureTypeByName=function(a){return this._featureTypes.find(function(c){return c.name.toLowerCase()==a.toLowerCase()})};b.prototype.findFeatureTypeOrCreate=
function(a,c){c=void 0===c?"arc":c;var f=this.findFeatureTypeByName(a);f||(f=new d.FeatureType(this,{name:a,decoration:c}));return f};b.prototype.refreshCaptions=function(){for(var a=0,c=this._captions.length;a<c;a++)this._captions[a].refresh();this.legend.refresh()};b.prototype.moveTo=function(a,c){c=void 0===c?1E3:c;var f=this,b=this.scale.x.domain(),e=this.scale.y.domain(),h=Math.abs(b[1]-b[0])/2,k=Math.abs(e[1]-e[0])/2,l=d.pixel(this.backbone.zoomedRadius),m=this.scale.bp(a),n=l*Math.cos(m),l=
-l*Math.sin(m),p=[b[0],b[1],e[0],e[1]],q=[n-h,n+h,l+k,l-k];d3.select(this.canvas.node).transition().duration(c).tween("move",function(){var a=d3.interpolateArray(p,q);return function(c){f.scale.x.domain([a(c)[0],a(c)[1]]);f.scale.y.domain([a(c)[2],a(c)[3]]);f.drawFast()}}).on("end",function(){f.drawFull()})};b.prototype.zoomTo=function(a,c,f){f=void 0===f?1E3:f;var b=this,e=b._zoom.scaleExtent();c=d.constrain(c,e[0],e[1]);var e=this.scale.x.domain(),h=this.scale.y.domain(),k=this.scale.x.range()[1]/
2,l=this.scale.y.range()[1]/2,m=d.pixel(this.backbone.radius*c),n=this.scale.bp(a);a?(a=m*Math.cos(n),m=-m*Math.sin(n)):m=a=0;var p=[e[0],e[1],h[0],h[1]],q=[a-k,a+k,m+l,m-l];d3.select(this.canvas.node).transition().duration(f).tween("move",function(){var a=d3.interpolateArray(p,q),f=d3.interpolate(b._zoomFactor,c);return function(c){b.scale.x.domain([a(c)[0],a(c)[1]]);b.scale.y.domain([a(c)[2],a(c)[3]]);b._zoomFactor=f(c);d3.zoomTransform(b.canvas.node("ui")).k=f(c);b.drawFast()}}).on("end",function(){b.drawFull()})};
b.prototype.reset=function(a){this.zoomTo(0,1,void 0===a?1E3:a)};b.prototype.getCurrentBp=function(){var a=this.scale.x.domain(),c=this.scale.y.domain();return this.canvas.bpForPoint({x:(a[1]-a[0])/2+a[0],y:(c[1]-c[0])/2+c[0]})};b.prototype.moveCaption=function(a,c){this._captions.move(a,c);this.refreshCaptions()};b.prototype.on=function(a,c){this.events.on(a,c)};b.prototype.off=function(a,c){this.events.off(a,c)};b.prototype.trigger=function(a,c){this.events.trigger(a,c)};Object.defineProperties(b.prototype,
{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this.resize(a)}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this.resize(null,a)}},minDimension:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.height,this.width)}},zoomFactor:{configurable:!0,enumerable:!0,get:function(){return this._zoomFactor},set:function(a){this._zoomFactor=a}},scale:{configurable:!0,enumerable:!0,get:function(){return this.canvas.scale}},
colorPicker:{configurable:!0,enumerable:!0,get:function(){if(void 0==this._colorPicker){var a=this.containerId+"-color-picker";this._container.append("div").classed("cp-color-picker-dialog",!0).attr("id",this.containerId+"-color-picker");this._colorPicker=new d.ColorPicker(a)}return this._colorPicker}},debug:{configurable:!0,enumerable:!0,get:function(){return this._debug},set:function(a){a?(!0===a&&(a={},a.sections=b.debug_sections),this._debug=new d.Debug(a)):this._debug=void 0}},sequence:{configurable:!0,
enumerable:!0,get:function(){return this._sequence}}});Object.defineProperties(b,{debug_sections:{configurable:!0,enumerable:!0,get:function(){return["time","zoom","position","n"]}}});d.Viewer=b})(CGView);
(function(d){cgvID=0;var b=function(a,c,f){c=void 0===c?{}:c;f=void 0===f?{}:f;this._viewer=a;this.meta=d.merge(c.meta,f);this.visible=d.defaultFor(c.visible,!0);this._cgvID="cgv-id-"+cgvID++};b.prototype.toString=function(){return"CGObject"};Object.defineProperties(b.prototype,{cgvID:{configurable:!0,enumerable:!0,get:function(){return this._cgvID}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},
sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},visible:{configurable:!0,enumerable:!0,get:function(){return this._visible},set:function(a){this._visible=a}},meta:{configurable:!0,enumerable:!0,get:function(){return this._meta},set:function(a){this._meta=a}}});d.CGObject=b})(CGView);
(function(d){var b=function(a,c,f){c=void 0===c?{}:c;f=void 0===f?{}:f;d.CGObject.call(this,a,c,f);this._labels=new d.CGArray;this.font=d.defaultFor(c.font,"SansSerif, plain, 12");this.labelLineLength=d.defaultFor(c.labelLineLength,20);this._labelLineMargin=d.pixel(10);this._labelLineWidth=d.pixel(1);this.refresh();this._visibleLabels=new d.CGArray;this.color=c.color;this.lineCap="round"};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Annotation"};b.prototype.labels=function(a){return this._labels.get(a)};
b.prototype.addLabel=function(a){this._labels.push(a)};b.prototype.removeLabel=function(a){this._labels=this._labels.remove(a);this.refresh()};b.prototype.refresh=function(){this._labelsNCList=new d.NCList(this._labels,{circularLength:this.sequence.length})};b.prototype.refreshLabelWidths=function(){for(var a=this._labels.map(function(a){return a.font.css}),c=this._labels.map(function(a){return a.name}),a=d.Font.calculateWidths(this.canvas.context("map"),a,c),c=0,f=this._labels.length;c<f;c++)this._labels[c].width=
a[c]};b.prototype._calculatePositions=function(a){a=a||this._labels;for(var c=this._visibleRange,f,b,e,d,k=this.sequence,l=0,m=a.length;l<m;l++)f=a[l],b=f.feature,e=c.contains(b.start),d=c.contains(b.stop),e&&d?f.bp=b.start+b.length/2:e?f.bp=b.range.getStartPlus(k.lengthOfRange(b.start,c.stop)/2):d?f.bp=b.range.getStopPlus(-k.lengthOfRange(c.start,b.stop)/2):(e=k.lengthOfRange(c.stop,b.stop),b=k.lengthOfRange(b.start,c.start),f.bp=e/(e+b)*c.length+c.start)};b.prototype._calculateLabelRects=function(a){a=
a||this._labels;for(var c=this.canvas,f=c.scale,b,e,h,k=this._outerRadius+this._labelLineMargin,l=0,m=a.length;l<m;l++)b=a[l],h=b.bp,e=f.bp(h),c.pointFor(h,k),h=c.pointFor(h,k+this.labelLineLength),b.lineAttachment=d.clockPositionForAngle(e+Math.PI),e=d.rectOriginForAttachementPoint(h,b.lineAttachment,b.width,b.height),b.rect=new d.Rect(e.x,e.y,b.width,b.height)};b.prototype.visibleLabels=function(a){a=new d.CGArray;var c=this._visibleRange;c&&(a=1==c.start&&c.stop==this.sequence.length?this._labels:
this._labelsNCList.find(c.start,c.stop));return a};b.prototype.draw=function(a,c){this._labels.length!=this._labelsNCList.length&&this.refresh();this._visibleRange=this.canvas.visibleRangeForRadius(c);this._innerRadius=a;this._outerRadius=c;var f=this.visibleLabels(c);this._calculatePositions(f);this._calculateLabelRects(f);var b=new d.CGArray;this._visibleLabels=new d.CGArray;for(var e=0,h=f.length;e<h;e++)k=f[e],k.rect.overlap(b)||(this._visibleLabels.push(k),b.push(k.rect));var f=this.canvas,b=
f.context("map"),k,l;b.font=this.font.css;b.textAlign="left";b.textBaseline="top";e=0;for(h=this._visibleLabels.length;e<h;e++)k=this._visibleLabels[e],l=k.feature,l=this.color||l.color,f.radiantLine("map",k.bp,c+this._labelLineMargin,this.labelLineLength,this._labelLineWidth,l.rgbaString,this.lineCap),b.fillStyle=l.rgbaString,b.fillText(k.name,k.rect.x,k.rect.y);this.viewer.debug&&this.viewer.debug.data.n&&(this.viewer.debug.data.n.labels=this._visibleLabels.length)};Object.defineProperties(b.prototype,
{color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color=void 0===a||"Color"==a.toString()?a:new d.Color(a)}},labelLineLength:{configurable:!0,enumerable:!0,get:function(){return this._labelLineLength},set:function(a){this._labelLineLength=d.pixel(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new d.Font(a);this.refreshLabelWidths()}},length:{configurable:!0,enumerable:!0,get:function(){return this._labels.length}}});
d.Annotation=b})(CGView);
(function(d){var b=function(a,c,f){c=void 0===c?{}:c;f=void 0===f?{}:f;d.CGObject.call(this,a,c,f);a=.4*d3.min([this.viewer.width,this.viewer.height]);this.radius=d.defaultFor(c.radius,a);this.color=d.defaultFor(c.color,"grey");this.font=d.defaultFor(c.font,"sans-serif, plain, 14");this.fontColor=d.defaultFor(c.fontColor,"black");this.thickness=d.defaultFor(c.thickness,5);this._bpThicknessAddition=0;this.bpMargin=4};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Backbone"};b.prototype.maxZoomFactor=
function(){return this.sequence.length*this.bpSpacing/(2*Math.PI*this.radius)};b.prototype.pixelsPerBp=function(){return d.pixel(2*this.zoomedRadius*Math.PI/this.sequence.length)};b.prototype._drawSequence=function(){var a=this.canvas.context("map"),c=d.pixel(this.zoomedRadius),f=this.visibleRange,b,e;if(f){this.sequence.seq?(b=this.sequence.forRange(f),e=d.Sequence.complement(b)):(b=this._emptySequence(f.length),e=this._emptySequence(f.length));var h=f.start;a.save();a.fillStyle=this.fontColor.rgbaString;
a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var k=this.bpSpacing/2+this.bpMargin,l=0,f=f.length;l<f;l++){var m=this.canvas.pointFor(h,c+k);a.fillText(b[l],m.x,m.y);m=this.canvas.pointFor(h,c-k);a.fillText(e[l],m.x,m.y);h++}a.restore()}};b.prototype._emptySequence=function(a){return Array(a+1).join("\u2022")};b.prototype.draw=function(){this._visibleRange=this.canvas.visibleRangeForRadius(d.pixel(this.zoomedRadius),100);if(this.visibleRange)if(this.viewer.canvas.drawArc("map",
this.visibleRange.start,this.visibleRange.stop,d.pixel(this.zoomedRadius),this.color.rgbaString,d.pixel(this.zoomedThickness)),1<this.pixelsPerBp()){var a=Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius),c=2*this.pixelsPerBp();this._bpThicknessAddition=a+c>=this.maxThickness?this.maxThickness-a:c;this.pixelsPerBp()>=this.bpSpacing-this.bpMargin&&this._drawSequence()}else this._bpThicknessAddtion=0};Object.defineProperties(b.prototype,{color:{configurable:!0,enumerable:!0,
get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new d.Color(a)}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor="Color"==a.toString()?a:new d.Color(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new d.Font(a);this.bpSpacing=this.font.size}},radius:{configurable:!0,enumerable:!0,set:function(a){a&&(this._radius=a,this.viewer._updateZoomMax())},
get:function(){return this._radius}},zoomedRadius:{configurable:!0,enumerable:!0,get:function(){return this.radius*this.viewer._zoomFactor}},thickness:{configurable:!0,enumerable:!0,set:function(a){a&&(this._thickness=a,this.viewer.layout&&this.viewer.layout._adjustProportions())},get:function(){return this._thickness}},zoomedThickness:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius)+this.bpThicknessAddition/
d.pixel(1)}},maxThickness:{configurable:!0,enumerable:!0,get:function(){return 2*this.bpSpacing+4*this.bpMargin}},bpSpacing:{configurable:!0,enumerable:!0,get:function(){return this._bpSpacing},set:function(a){this._bpSpacing=a;this.viewer._updateZoomMax()}},bpMargin:{configurable:!0,enumerable:!0,get:function(){return this._bpMargin},set:function(a){this._bpMargin=a}},bpThicknessAddition:{configurable:!0,enumerable:!0,get:function(){return this._bpThicknessAddition}},visibleRange:{configurable:!0,
enumerable:!0,get:function(){return this._visibleRange}}});d.Backbone=b})(CGView);
(function(d){var b=function(a,c,f){f=void 0===f?{}:f;this._viewer=a;this.width=d.defaultFor(f.width,600);this.height=d.defaultFor(f.height,600);this.determinePixelRatio(c);this._layerNames=["background","map","captions","ui"];this._layers=this.createLayers(c,this._layerNames,this._width,this._height);this._scale={};this.refreshScales()};b.prototype.determinePixelRatio=function(a){var c=a.append("canvas").style("position","absolute").style("top",0).style("left",0).attr("width",this._width).attr("height",
this._height).node();c.getContext?d.pixelRatio=d.getPixelRatio(c):a.html("<h3>CGView requires Canvas, which is not supported by this browser.</h3>");d3.select(c).remove()};b.prototype.createLayers=function(a,c,f,b){for(var e={},h=0,k=c.length;h<k;h++){var l=c[h],m=10*(h+1),m=a.append("canvas").classed("cgv-layer",!0).classed("cgv-layer-"+l,!0).style("z-index",m).attr("width",f).attr("height",b).node();d.scaleResolution(m,d.pixelRatio);var n=m.getContext("2d");e[l]={ctx:n,node:m}}return e};b.prototype.resize=
function(a,c){this.width=a;this.height=c;for(var f=$jscomp.makeIterator(this.layerNames),b=f.next();!b.done;b=f.next())b=this.layers(b.value).node,b.width=this.width,b.height=this.height,b.style.width=a+"px",b.style.height=c+"px";this.refreshScales()};b.prototype.refreshScales=function(){var a,c,f,b;this.scale.x?(c=this.scale.x.domain(),b=c[1]-c[0],a=c[0]/b,c=c[1]/b):(a=-.5,c=.5);if(this.scale.y){var e=this.scale.y.domain();b=e[0]-e[1];f=e[0]/b;b=e[1]/b}else f=.5,b=-.5;this.scale.x=d3.scaleLinear().domain([this.width*
a,this.width*c]).range([0,this.width]);this.scale.y=d3.scaleLinear().domain([this.height*f,this.height*b]).range([0,this.height])};b.prototype.clear=function(a){a=void 0===a?"map":a;if("all"==a){a=0;for(var c=this.layerNames.length;a<c;a++)this.clear(this.layerNames[a])}else"background"==a?(a=this.context("background"),a.clearRect(0,0,d.pixel(this.width),d.pixel(this.height)),a.fillStyle=this.viewer.settings.backgroundColor.rgbaString,a.fillRect(0,0,d.pixel(this.width),d.pixel(this.height))):this.context(a).clearRect(0,
0,d.pixel(this.width),d.pixel(this.height))};b.prototype.drawArc=function(a,c,f,b,e,h,k){e=void 0===e?"#000000":e;h=void 0===h?1:h;k=void 0===k?"arc":k;var l=this.context(a),m=this.viewer.settings;if("arc"==k){if(m.showShading){var n=.1*h,p=h-2*n;l.beginPath();l.strokeStyle=e;l.lineWidth=p;this.arcPath(a,b,c,f);l.stroke();p=p/2+n/2;l.lineWidth=n;l.beginPath();l.strokeStyle=(new d.Color(e)).lighten(.15).rgbaString;this.arcPath(a,b+p,c,f);l.stroke();l.beginPath();l.strokeStyle=(new d.Color(e)).darken(.15).rgbaString;
this.arcPath(a,b-p,c,f)}else l.beginPath(),l.strokeStyle=e,l.lineWidth=h,this.arcPath(a,b,c,f);l.stroke()}if("arc"!=k){p=h*m.arrowHeadLength/this.pixelsPerBp(b);n=this.sequence.lengthOfRange(c,f);n<p&&(n=c+n/2,c=n-p/2,f=n+p/2);n="clockwise-arrow"==k?c:f;f="clockwise-arrow"==k?f:c;k="clockwise-arrow"==k?1:-1;c=h/2;p=f-k*p;f=this.pointFor(f,b);var q=this.pointFor(p,b-c);m.showShading?(h*=.4,m=this.pointFor(p,b-h),l.beginPath(),l.fillStyle=e,this.arcPath(a,b+h,n,p,-1==k),l.lineTo(f.x,f.y),l.lineTo(m.x,
m.y),this.arcPath(a,b-h,p,n,1==k,"noMoveTo"),l.closePath(),l.fill(),q=this.pointFor(p,b+h),l.beginPath(),l.fillStyle=(new d.Color(e)).lighten(.15).rgbaString,this.arcPath(a,b+c,n,p,-1==k),l.lineTo(f.x,f.y),l.lineTo(q.x,q.y),this.arcPath(a,b+h,p,n,1==k,"noMoveTo"),l.closePath(),l.fill(),l.beginPath(),l.fillStyle=(new d.Color(e)).darken(.15).rgbaString,this.arcPath(a,b-c,n,p,-1==k),l.lineTo(f.x,f.y),l.lineTo(m.x,m.y),this.arcPath(a,b-h,p,n,1==k,"noMoveTo")):(l.beginPath(),l.fillStyle=e,this.arcPath(a,
b+c,n,p,-1==k),l.lineTo(f.x,f.y),l.lineTo(q.x,q.y),this.arcPath(a,b-c,p,n,1==k,"noMoveTo"));l.closePath();l.fill()}};b.prototype.arcPath=function(a,c,f,b,e,d){e=void 0===e?!1:e;d=void 0===d?"moveTo":d;a=this.context(a);var k=this.scale;(e?this.sequence.lengthOfRange(b,f):this.sequence.lengthOfRange(f,b))<this.sequence.length/1E3?(b=this.pointFor(b,c),"lineTo"==d?(c=this.pointFor(f,c),a.lineTo(c.x,c.y),a.lineTo(b.x,b.y)):"moveTo"==d?(c=this.pointFor(f,c),a.moveTo(c.x,c.y),a.lineTo(b.x,b.y)):"noMoveTo"==
d&&a.lineTo(b.x,b.y)):a.arc(k.x(0),k.y(0),c,k.bp(f),k.bp(b),e)};b.prototype.radiantLine=function(a,c,f,b,e,d,k){e=void 0===e?1:e;d=void 0===d?"black":d;k=void 0===k?"butt":k;var l=this.pointFor(c,f);c=this.pointFor(c,f+b);a=this.context(a);a.beginPath();a.moveTo(l.x,l.y);a.lineTo(c.x,c.y);a.strokeStyle=d;a.lineCap=k;a.lineWidth=e;a.stroke()};b.prototype.pointFor=function(a,c){var f=this.scale.bp(a),b=this.scale.x(0)+c*Math.cos(f),f=this.scale.y(0)+c*Math.sin(f);return{x:b,y:f}};b.prototype.bpForPoint=
function(a){return Math.round(this.scale.bp.invert(d.angleFromPosition(a.x,a.y)))};b.prototype.visibleRangesForRadius=function(a,c){c=void 0===c?0:c;var f=this;return d.circleAnglesFromIntersectingRect(a,this.scale.x.invert(0-c),this.scale.y.invert(0-c),this.width+2*c,this.height+2*c).map(function(a){return Math.round(f.scale.bp.invert(a))})};b.prototype.visibleRangeForRadius=function(a,c){c=void 0===c?0:c;var f=this.visibleRangesForRadius(a,c);return 2==f.length?new d.CGRange(this.sequence,f[0],
f[1]):2<f.length?new d.CGRange(this.sequence,f[0],f[f.length-1]):a-c>this.maximumVisibleRadius()?void 0:a+c<this.minimumVisibleRadius()?void 0:new d.CGRange(this.sequence,1,this.sequence.length)};b.prototype.centerVisible=function(){var a=this.scale.x(0),c=this.scale.y(0);return 0<=a&&a<=this.width&&0<=c&&c<=this.height};b.prototype.maximumVisibleRadius=function(){var a=Math.max(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width))),c=Math.max(Math.abs(this.scale.y.invert(0)),
Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+c*c)};b.prototype.minimumVisibleRadius=function(){if(this.centerVisible())return 0;if(d.oppositeSigns(this.scale.x.invert(0),this.scale.x.invert(this.width)))return Math.min(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));if(d.oppositeSigns(this.scale.y.invert(0),this.scale.y.invert(this.height)))return Math.min(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width)));var a=Math.min(Math.abs(this.scale.x.invert(0)),
Math.abs(this.scale.x.invert(this.width))),c=Math.min(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+c*c)};b.prototype.visibleRadii=function(a){return{min:this.minimumVisibleRadius(),max:this.maximumVisibleRadius()}};b.prototype.pixelsPerBp=function(a){return 2*a*Math.PI/this.sequence.length};b.prototype.layers=function(a){if(d.validate(a,this._layerNames))return this._layers[a];console.error("Returning map layer by default");return this._layers.map};
b.prototype.context=function(a){if(d.validate(a,this._layerNames))return this.layers(a).ctx;console.error("Returning map layer by default");return this.layers("map").ctx};b.prototype.node=function(a){if(d.validate(a,this._layerNames))return this.layers(a).node;console.error("Returning map layer by default");return this.layers("map").node};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},scale:{configurable:!0,enumerable:!0,get:function(){return this._scale}},
layerNames:{configurable:!0,enumerable:!0,get:function(){return this._layerNames}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},width:{configurable:!0,enumerable:!0,get:function(){return d.pixel(this._width)},set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return d.pixel(this._height)},set:function(a){this._height=a}},cursor:{configurable:!0,enumerable:!0,get:function(){return d3.select(this.node("ui")).style("cursor")},
set:function(a){d3.select(this.node("ui")).style("cursor",a)}},_testDrawRange:{configurable:!0,enumerable:!0,get:function(){return this.__testDrawRange},set:function(a){(this.__testDrawRange=a)?(this.width*=.4,this.height*=.4):(this.width/=.4,this.height/=.4);this.viewer.drawFull()}}});d.Canvas=b})(CGView);
(function(d){var b=function(a,c,f){c=void 0===c?{}:c;f=void 0===f?{}:f;d.CGObject.call(this,a,c,f);this.viewer=a;this._items=new d.CGArray;this._position=d.defaultFor(c.position,"upper-left");this.name=c.name;this.backgroundColor=c.backgroundColor;this.font=d.defaultFor(c.font,"SansSerif, plain, 8");this.fontColor=d.defaultFor(c.fontColor,"black");this.textAlignment=d.defaultFor(c.textAlignment,"left");if(c.items){var b=this;c.items.forEach(function(a){new (d[b.toString()+"Item"])(b,a)})}this.refresh()};
$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Caption"};b.prototype.items=function(a){return this._items.get(a)};b.prototype.visibleItems=function(a){var c=this._items.filter(function(a){return a.visible});return(new d.CGArray(c)).get(a)};b.prototype.refresh=function(){this.clear();var a=this.height=0;if(this._items){for(var c=this.visibleItems(),f=0,b=c.length;f<b;f++){var e=c[f].height;this.height+=e;f<b-1&&(this.height+=e/2);e>a&&(a=e)}this.padding=a/2;this.height+=2*this.padding;
this.width=0;f=c.map(function(a){return a.font.css});b=c.map(function(a){return a.text});a=d.Font.calculateWidths(this.ctx,f,b);f=0;for(b=a.length;f<b;f++)e=c[f],e.drawSwatch&&(a[f]+=e.height+this.padding/2),e._width=a[f];this.width=d3.max(a)+2*this.padding;this._updateOrigin();this.draw()}};b.prototype._updateOrigin=function(){var a=d.pixel(0),c=this.canvas.width,f=this.canvas.height,b=this.width,e=this.height,h=this.position;"upper-left"==h?this.originY=this.originX=a:"upper-center"==h?(this.originX=
c/2-b/2,this.originY=a):"upper-right"==h?(this.originX=c-b-a,this.originY=a):"middle-left"==h?(this.originX=a,this.originY=f/2-e/2):"middle-center"==h?(this.originX=c/2-b/2,this.originY=f/2-e/2):"middle-right"==h?(this.originX=c-b-a,this.originY=f/2-e/2):"lower-left"==h?(this.originX=a,this.originY=f-e-a):"lower-center"==h?(this.originX=c/2-b/2,this.originY=f-e-a):"lower-right"==h&&(this.originX=c-b-a,this.originY=f-e-a)};b.prototype.moveItem=function(a,c){this._items.move(a,c);this.refresh()};b.prototype.clear=
function(){this.ctx.clearRect(this.originX,this.originY,this.width,this.height)};b.prototype.fillBackground=function(){this.ctx.fillStyle=this.backgroundColor.rgbaString;this.ctx.fillRect(this.originX,this.originY,this.width,this.height)};b.prototype.highlight=function(a){this.visible&&(a=this.canvas.context("ui"),a.lineWidth=1,a.strokeStyle="black",a.strokeRect(this.originX,this.originY,this.width,this.height))};b.prototype.draw=function(){if(this.visible){var a=this.ctx;this.fillBackground();a.textBaseline=
"top";for(var c=0,b=this._items.length;c<b;c++){var g=this._items[c];g.visible&&(a.font=g.font.css,a.textAlign=g.textAlignment,a.fillStyle=g.fontColor.rgbaString,a.fillText(g.text,g.textX(),g.textY()))}}};b.prototype.remove=function(){var a=this.viewer;a._captions=a._captions.remove(this);a.clear("captions");a.refreshCaptions()};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._captions.push(this)}},visible:{configurable:!0,
enumerable:!0,get:function(){return this._visible},set:function(a){this._visible=a;this.refresh()}},ctx:{configurable:!0,enumerable:!0,get:function(){return this.canvas.context("captions")}},id:{configurable:!0,enumerable:!0,get:function(){return this.position}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){this._position=a;this.refresh()}},name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},backgroundColor:{configurable:!0,
enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==a?this.viewer.settings.backgroundColor:"Color"==a.toString()?a:new d.Color(a);this.refresh()}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new d.Font(a);this.refresh()}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor.rgbaString},set:function(a){this._fontColor="Color"==a.toString()?a:new d.Color(a);
this.refresh()}},textAlignment:{configurable:!0,enumerable:!0,get:function(){return this._textAlignment},set:function(a){d.validate(a,["left","center","right"])&&(this._textAlignment=a);this.refresh()}}});d.Caption=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.CGObject.call(this,a.viewer,c,b);this.parent=a;this.meta=d.merge(c.meta,b);this._text=d.defaultFor(c.text,"");this.font=c.font;this.fontColor=c.fontColor;this.textAlignment=c.textAlignment;this._initializationComplete=!0;this.refresh()};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"CaptionItem"};b.prototype.refresh=function(){this._initializationComplete&&this.parent.refresh()};b.prototype.textX=function(){var a=
this.parent;if("left"==this.textAlignment)return a.originX+a.padding;if("center"==this.textAlignment)return a.originX+a.width/2;if("right"==this.textAlignment)return a.originX+a.width-a.padding};b.prototype.textY=function(){var a=this.parent,c=a.originY+a.padding;a._items.indexOf(this);for(var b=0,g=a._items.length;b<g;b++){var e=a._items[b];if(e==this)break;e.visible&&(c+=1.5*e.height)}return c};b.prototype.highlight=function(a){this.visible&&this.parent.visible&&(a=this.canvas.context("ui"),a.lineWidth=
1,a.strokeStyle="black",a.strokeRect(this.textX(),this.textY(),this.width,this.height))};b.prototype.remove=function(){var a=this.parent;a._items=a._items.remove(this);this.viewer.clear("captions");this.viewer.refreshCaptions();this.viewer.trigger(a.toString().toLowerCase()+"-update")};Object.defineProperties(b.prototype,{id:{configurable:!0,enumerable:!0,get:function(){return this.text}},caption:{configurable:!0,enumerable:!0,get:function(){return this._parent}},parent:{configurable:!0,enumerable:!0,
get:function(){return this._parent},get:function(){return this._parent},set:function(a){var c=this.parent;this._parent=a;a._items.push(this);c&&(c._items=c._items.remove(this),c.refresh(),a.refresh())}},visible:{configurable:!0,enumerable:!0,get:function(){return this._visible},set:function(a){this._visible=a;this.refresh()}},text:{configurable:!0,enumerable:!0,get:function(){return this._text},set:function(a){this._text=a;this.refresh()}},name:{configurable:!0,enumerable:!0,get:function(){return this.text},
set:function(a){this.text=a}},textAlignment:{configurable:!0,enumerable:!0,get:function(){return this._textAlignment||this.parent.textAlignment},set:function(a){this._textAlignment=a;this.refresh()}},width:{configurable:!0,enumerable:!0,get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.height}},swatchWidth:{configurable:!0,enumerable:!0,get:function(){return this.height}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},
set:function(a){this._font=void 0==a?this.parent.font:"Font"==a.toString()?a:new d.Font(a);this.refresh()}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor=void 0==a?this.parent._fontColor:"Color"==a.toString()?a:new d.Color(a);this.refresh()}}});d.CaptionItem=b})(CGView);
(function(d){function b(a,b,g){return g.indexOf(a)===b}var a=function(){if(1==arguments.length&&Array.isArray(arguments[0]))for(var a=0,b=arguments[0].length;a<b;a++)this.push(arguments[0][a]);else 0<arguments.length&&this.push.apply(this,arguments)};a.prototype=Object.create(Array.prototype);a.prototype.toString=function(){return"CGArray"};a.prototype.merge=function(a){for(var b=0,g=a.length;b<g;b++)this.push(a[b]);return this};a.prototype.attr=function(a){if(1==arguments.length&&"object"==typeof a)for(var b=
Object.keys(a),g=b.length,e=0,d=this.length;e<d;e++)for(var k=0;k<g;k++)this[e][b[k]]=a[b[k]];else if(2==arguments.length)for(b=0,g=this.length;b<g;b++)this[b][arguments[0]]=arguments[1];else if(void 0!=a)throw Error("attr(): must be 2 arguments or a single object");return this};a.prototype.draw=function(a,b,g,e,d){for(var k=0,l=this.length;k<l;k++)this[k].draw(a,b,g,e,d);return this};a.prototype.each=function(a){for(var b=0,g=this.length;b<g;b++)a.call(this[b],b,this[b]);return this};a.prototype.eachFromRange=
function(a,b,g,e){var h=d.indexOfValue(this,a,!0),k=d.indexOfValue(this,b,!1);0<h&&1<g&&(h+=g-h%g);if(b>=a){if(this[h]>b||this[k]<a)return;for(a=h;a<=k;a+=g)e.call(this[a],a,this[a])}else{if(this[h]>=a)for(a=h,h=this.length;a<h;a+=g)e.call(this[a],a,this[a]);if(this[k]<=b)for(a=0;a<=k;a+=g)e.call(this[a],a,this[a])}return this};a.prototype.countFromRange=function(a,b,g){g=d.indexOfValue(this,a,!0);var e=d.indexOfValue(this,b,!1);a>this[this.length-1]&&g++;b<this[0]&&e--;return b>=a?e-g+1:this.length-
g+e+1};a.prototype.contains=function(a){return 0<=this.indexOf(a)};a.prototype.remove=function(c){var b;return b=new a(this.filter(function(a){return a!=c}))};a.prototype.empty=function(){return 0==this.length};a.prototype.present=function(){return 0<this.length};a.prototype.move=function(a,b){if(b>=this.length)for(var g=b-this.length;g--+1;)this.push(void 0);this.splice(b,0,this.splice(a,1)[0]);return this};a.prototype.order_by=function(a,b){0<this.length&&("function"===typeof this[0][a]?this.sort(function(b,
f){return b[a]()>f[a]()?1:b[a]()<f[a]()?-1:0}):this.sort(function(b,f){return b[a]>f[a]?1:b[a]<f[a]?-1:0}));b&&this.reverse();return this};a.prototype.lineWidth=function(a){for(var b=0,g=this.length;b<g;b++)this[b].lineWidth=a;return this};a.prototype.get=function(c){if(void 0==c)return this;if(Number.isInteger(c))return this[c-1];if("string"==typeof c)return c.match(/^cgv-id-/)?this.filter(function(a){return a.cgvID==c})[0]:this.filter(function(a){return a.id.toLowerCase()==c.toLowerCase()})[0];
if(Array.isArray(c)){var b=this.filter(function(a){return c.some(function(c){return a.id==c})}),g=new a;g.push.apply(g,b);return g}return new a};a.prototype.equals=function(a){if("CGArray"!=a.toString()&&!Array.isArray(a))return!1;var b=this.unique(),g=a.unique(),d=!0;if(b.length!=g.length)return!1;b.forEach(function(a){g.contains(a)||(d=!1)});return d};a.prototype.unique=function(){return new a(this.filter(b))};a.prototype.find=function(a,b){if("function"!==typeof a)throw new TypeError("predicate must be a function");
for(var d=Object(this),e=d.length>>>0,h,k=0;k<e;k++)if(h=d[k],a.call(b,h,k,d))return h};d.CGArray=a})(CGView);
(function(d){var b=function(a,c,b){this._sequence=a;this.start=c;this.stop=b};b.prototype.overHalfCircle=function(){return this.length>this.sequenceLength/2};b.prototype.normalize=function(a){var c;return a>this.sequenceLength?(c=Math.floor(a/this.sequenceLength),a-this.sequenceLength*c):1>a?(c=Math.ceil(Math.abs(a/this.sequenceLength)),this.sequenceLength*c+a):a};b.prototype.getStartPlus=function(a){return this.normalize(this.start+a)};b.prototype.getStopPlus=function(a){return this.normalize(this.stop+
a)};b.prototype.isFullCircle=function(){return this.length==this.sequenceLength};b.prototype.spansOrigin=function(){return this.stop<this.start};b.prototype.contains=function(a){return this.stop>=this.start?a>=this.start&&a<=this.stop:a>=this.start||a<=this.stop};b.prototype.copy=function(){return new d.CGRange(this.sequence,this.start,this.stop)};b.prototype.overlapsRange=function(a){return this.contains(a.start)||this.contains(a.stop)||a.contains(this.start)};b.prototype.mergeWithRange=function(a){var c=
new d.CGRange(this.sequence,this.start,a.stop),b=new d.CGRange(this.sequence,a.start,this.stop);a=[this,a,c,b];for(var c=0,g,e=0,h=a.length;e<h;e++)b=a[e].length,b>c&&(c=b,g=a[e]);return g};Object.defineProperties(b.prototype,{sequence:{configurable:!0,enumerable:!0,get:function(){return this._sequence}},sequenceLength:{configurable:!0,enumerable:!0,get:function(){return this.sequence.length}},start:{configurable:!0,enumerable:!0,get:function(){return this._start},set:function(a){this._start=Number(a)}},
stop:{configurable:!0,enumerable:!0,get:function(){return this._stop},set:function(a){this._stop=Number(a)}},length:{configurable:!0,enumerable:!0,get:function(){return this.stop>=this.start?this.stop-this.start+1:this.sequenceLength+(this.stop-this.start)+1}},middle:{configurable:!0,enumerable:!0,get:function(){var a=this.start+this.length/2;return a>this.sequenceLength?a-this.sequenceLength:a}}});d.CGRange=b})(CGView);
(function(d){var b=function(a){this.setColor(a)};b.prototype.toString=function(){return"Color"};b.prototype.setColor=function(a){if("string"===typeof a||a instanceof String)this._string=a;else{var c=new d.CGArray(Object.keys(a));c.contains("h")&&c.contains("s")&&c.contains("v")?this.hsv=a:c.contains("r")&&c.contains("g")&&c.contains("b")&&c.contains("a")?this.rgba=a:c.contains("r")&&c.contains("g")&&c.contains("b")&&(this.rgb=a)}};b.prototype.copy=function(){return new d.Color(this.rgbaString)};b.prototype.highlight=
function(a){a=void 0===a?.25:a;var c=this.hsv;c.v+=.5>c.v?a:-a;this.hsv=c};b.prototype.lighten=function(a){var c=this.hsl;c.l+=d.constrain(a,0,1);c.l=Math.min(c.l,1);this.hsl=c;return this};b.prototype.darken=function(a){var c=this.hsl;c.l-=d.constrain(a,0,1);c.l=Math.max(c.l,0);this.hsl=c;return this};b.prototype._updateRgbaOpacity=function(){var a=this;this._rgbaString=this._rgbaString.replace(/^(rgba\(.*,)([\d\.]+?)(\))/,function(c,b,d,e){return b+a.opacity+e})};b.prototype._updateOpacityFromRgba=
function(){var a=/^rgba.*,([\d\.]+?)\)$/.exec(this.rgbaString);a&&(this._opacity=b._validateOpacity(a[1]))};Object.defineProperties(b.prototype,{_string:{configurable:!0,enumerable:!0,set:function(a){a=b.string2rgba(a,this.opacity);this._rgbaString=b.rgba2String(a);this._updateOpacityFromRgba()}},opacity:{configurable:!0,enumerable:!0,get:function(){return void 0==this._opacity?1:this._opacity},set:function(a){this._opacity=b._validateOpacity(a);this._updateRgbaOpacity()}},rgbaString:{configurable:!0,
enumerable:!0,get:function(){return this._rgbaString}},rgbString:{configurable:!0,enumerable:!0,get:function(){return b.rgb2String(this.rgb)}},rgb:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+)/.exec(this.rgbaString);return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3])}:void 0},set:function(a){this._string=b.rgb2String(a);this._updateOpacityFromRgba()}},rgba:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)/.exec(this.rgbaString);
return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0},set:function(a){this._string=b.rgba2String(a);this._updateOpacityFromRgba()}},hsv:{configurable:!0,enumerable:!0,get:function(){return b.rgb2hsv(this.rgb)},set:function(a){a=b.hsv2rgb(a);a.a=this.opacity;this.rgba=a}},hex:{configurable:!0,enumerable:!0,get:function(){}},hsl:{configurable:!0,enumerable:!0,get:function(){return b.rgb2hsl(this.rgb)},set:function(a){a=b.hsl2rgb(a);a.a=this.opacity;this.rgba=a}}});b.string2rgba=
function(a,c){c=void 0===c?1:c;if(/^#/.test(a))return b.hexString2rgba(a,c);if(/^rgb\(/.test(a))return b.rgbString2rgba(a,c);if(/^rgba\(/.test(a))return b.rgbaString2rgba(a,c);if(/^hsl\(/.test(a))return b.hslStringToRgba(a,c);var f=b.name2HexString(a);return b.hexString2rgba(f,c)};b._validateOpacity=function(a){a=Number(a);isNaN(a)?a=1:1<a?a=1:0>a&&(a=0);return a};b._validateRgba=function(a){return{r:b._validateRgbNumber(a.r),g:b._validateRgbNumber(a.g),b:b._validateRgbNumber(a.b),a:b._validateOpacity(a.a)}};
b._validateRgbNumber=function(a){a=Number(a);NaN==a?a=0:255<a?a=255:0>a&&(a=0);return a};b.rgbString2rgba=function(a,c){c=void 0===c?1:c;a=a.replace(/ +/g,"");var b=/^rgb\((\d+),(\d+),(\d+)\)/.exec(a);return b?{r:Number(b[1]),g:Number(b[2]),b:Number(b[3]),a:c}:void 0};b.rgbaString2rgba=function(a){a=a.replace(/ +/g,"");return(a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)\)/.exec(a))?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0};b.hslStringToRgba=function(a){console.log("NOT IMPLEMENTED")};
b.rgb2hsv=function(a){var c=a.r,b=a.g,d=a.b;if(1<c||1<b||1<d)c/=255,b/=255,d/=255;var e;a=Math.max(c,b,d);e=a-Math.min(c,b,d);c=(0==e?0:a==c?(b-d)/e+(b<d?6:0):a==b?(d-c)/e+2:(c-b)/e+4)%6*60;return{h:c,s:0==e?0:e/a,v:a}};b.hsv2rgb=function(a){var c,b,d,e,h=a.h%360/60;e=a.v*a.s;d=e*(1-Math.abs(h%2-1));a=c=b=a.v-e;h=~~h;a+=[e,d,0,0,d,e][h];c+=[d,e,e,d,0,0][h];b+=[0,0,d,e,e,d][h];return{r:Math.floor(255*a),g:Math.floor(255*c),b:Math.floor(255*b)}};b.hexString2rgba=function(a,c){c=void 0===c?1:c;a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,
function(a,c,b,f){return c+c+b+b+f+f});var b=0,d=0,e=0,h=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);h&&(b=parseInt(h[1],16),d=parseInt(h[2],16),e=parseInt(h[3],16));return{r:b,g:d,b:e,a:c}};b.rgb2hsl=function(a){var c=a.r/255,b=a.g/255;a=a.b/255;var d=Math.max(c,b,a),e=Math.min(c,b,a),h,k=(d+e)/2;if(d==e)h=e=0;else{var l=d-e,e=.5<k?l/(2-d-e):l/(d+e);switch(d){case c:h=(b-a)/l+(b<a?6:0);break;case b:h=(a-c)/l+2;break;case a:h=(c-b)/l+4}h/=6}return{h:h,s:e,l:k}};b.hsl2rgb=function(a){var c=
a.h,b=a.s,d=a.l;if(0==b)b=d=c=d;else{a=function(a,c,b){0>b&&(b+=1);1<b&&--b;return b<1/6?a+6*(c-a)*b:.5>b?c:b<2/3?a+(c-a)*(2/3-b)*6:a};var e=.5>d?d*(1+b):d+b-d*b,h=2*d-e,b=a(h,e,c+1/3),d=a(h,e,c),c=a(h,e,c-1/3)}b=Math.floor(255*b);d=Math.floor(255*d);c=Math.floor(255*c);return{r:b,g:d,b:c}};b.rgba2String=function(a){a=b._validateRgba(a);return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"};b.rgb2String=function(a){return"rgb("+a.r+","+a.g+","+a.b+")"};b.name2HexString=function(a){a=a.toLowerCase();if(a=
b.names()[a])return a;console.log("Name not found! Defaulting to Black");return"#000000"};b.names=function(){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",
darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",
firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",
lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",
mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",
red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}};
d.Color=b})(CGView);
(function(d){function b(a,c,b){a=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in c)a.setAttribute(d,c[d]);"[object Array]"!=Object.prototype.toString.call(b)&&(b=[b]);c=0;for(d=b[0]&&b.length||0;c<d;c++)a.appendChild(b[c]);return a}function a(a){var c=a.offsetWidth,b=a.offsetHeight;a=d3.mouse(a);a={x:a[0],y:a[1]};a.x>c?a.x=c:0>a.x&&(a.x=0);a.y>b?a.y=b:0>a.y&&(a.y=0);return a}var c=function(a,c){c=void 0===c?{}:c;this.containerId=a;this.container=d3.select("#"+a).node();this._width=
d.defaultFor(c.width,100);this._height=d.defaultFor(c.height,100);this._color=new d.Color(d.defaultFor(c.colorString,"rgba(255,0,0,1)"));this.hsv=this._color.hsv;this.opacity=this._color.opacity;this.onChange=c.onChange;this.onClose=c.onClose;this.container.innerHTML=this._colorpickerHTMLSnippet();d3.select(this.container).classed("cp-dialog",!0);this.dialogElement=this.container.getElementsByClassName("cp-dialog")[0];this.slideElement=this.container.getElementsByClassName("cp-color-slider")[0];this.pickerElement=
this.container.getElementsByClassName("cp-color-picker")[0];this.alphaElement=this.container.getElementsByClassName("cp-alpha-slider")[0];this.slideIndicator=this.container.getElementsByClassName("cp-color-slider-indicator")[0];this.pickerIndicator=this.container.getElementsByClassName("cp-color-picker-indicator")[0];this.alphaIndicator=this.container.getElementsByClassName("cp-alpha-slider-indicator")[0];this.currentColorIndicator=this.container.getElementsByClassName("cp-color-current")[0];this.originalColorIndicator=
this.container.getElementsByClassName("cp-color-original")[0];this.doneButton=this.container.getElementsByClassName("cp-done-button")[0];this._configureView();this.slideIndicator.style.pointerEvents="none";this.pickerIndicator.style.pointerEvents="none";this.alphaIndicator.style.pointerEvents="none";d3.select(this.slideElement).on("mousedown.click",this.slideListener());d3.select(this.pickerElement).on("mousedown.click",this.pickerListener());d3.select(this.alphaElement).on("mousedown.click",this.alphaListener());
d3.select(this.originalColorIndicator).on("mousedown.click",this.originalColorListener());d3.select(this.doneButton).on("mousedown.click",this.doneListener());this.enableDragging(this,this.slideElement,this.slideListener());this.enableDragging(this,this.pickerElement,this.pickerListener());this.enableDragging(this,this.alphaElement,this.alphaListener());this.enableDragging(this,this.container,this.dialogListener());d3.select(this.container).style("visibility","hidden")};c.prototype.updateColor=function(){this._color.hsv=
this.hsv;this._color.opacity=this.opacity;this.updateIndicators();var a=d.Color.rgb2String(d.Color.hsv2rgb({h:this.hsv.h,s:1,v:1}));this.pickerElement.style.backgroundColor=a;d3.select(this.alphaElement).selectAll("stop").attr("stop-color",this.color.rgbString);this.currentColorIndicator.style.backgroundColor=this.color.rgbaString;this.onChange&&this.onChange(this.color)};c.prototype.setColor=function(a){this._color.setColor(a);this.hsv=this._color.hsv;this.opacity=Number(this._color.opacity.toFixed(2));
this.originalColorIndicator.style.backgroundColor=this._color.rgbaString;this.updateColor()};c.prototype.updateIndicators=function(){var a=this.hsv,c=this.pickerElement.offsetHeight,b=a.s*this.pickerElement.offsetWidth,c=c-a.v*c,d=this.alphaElement.offsetWidth*this.opacity,k=this.pickerIndicator,l=this.slideIndicator,m=this.alphaIndicator;l.style.top=a.h*this.slideElement.offsetHeight/360-l.offsetHeight/2+"px";k.style.top=c-k.offsetHeight/2+"px";k.style.left=b-k.offsetWidth/2+"px";m.style.left=d-
m.offsetWidth/2+"px"};c.prototype.setPosition=function(a){this.container.style.left=a.x+"px";this.container.style.top=a.y+"px"};c.prototype._colorpickerHTMLSnippet=function(){return'<div class="cp-color-picker-wrapper"><div class="cp-color-picker"></div><div class="cp-color-picker-indicator"><div class="cp-picker-indicator-rect-1"></div><div class="cp-picker-indicator-rect-2"></div></div></div><div class="cp-color-slider-wrapper"><div class="cp-color-slider"></div><div class="cp-color-slider-indicator"><div class="cp-color-indicator-rect-1"></div><div class="cp-color-indicator-rect-2"></div></div></div><div class="cp-alpha-slider-wrapper"><div class="cp-alpha-slider"></div><div class="cp-alpha-slider-indicator"><div class="cp-alpha-indicator-rect-1"></div><div class="cp-alpha-indicator-rect-2"></div></div></div><div class="cp-dialog-footer"><div class="cp-footer-color-section"><div class="cp-color-original"></div><div class="cp-color-current"></div></div><div class="cp-footer-button-section"><button class="cp-done-button">Done</button></div></div>'};
c.prototype._configureView=function(){var a,c,d;d=this.containerId;a=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"20px",height:"100px"},[b("defs",{},b("linearGradient",{id:d+"-gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),b("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),b("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),b("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),
b("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),b("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),b("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),b("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),b("rect",{x:"0",y:"0",width:"20px",height:"100px",fill:"url(#"+d+"-gradient-hsv)"})]);c=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100px",height:"100px"},
[b("defs",{},[b("linearGradient",{id:d+"-gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),b("linearGradient",{id:d+"-gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),b("rect",{x:"0",y:"0",width:"100px",height:"100px",
fill:"url(#"+d+"-gradient-white)"}),b("rect",{x:"0",y:"0",width:"100px",height:"100px",fill:"url(#"+d+"-gradient-black)"})]);d=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"127px",height:"10px",style:"position: absolute;"},[b("defs",{},[b("linearGradient",{id:d+"-alpha-gradient"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"0"}),b("stop",{offset:"100%","stop-color":"#FFFFFF","stop-opacity":"1"})]),b("pattern",{id:d+"-alpha-squares",x:"0",y:"0",width:"10px",height:"10px",
patternUnits:"userSpaceOnUse"},[b("rect",{x:"0",y:"0",width:"10px",height:"10px",fill:"white"}),b("rect",{x:"0",y:"0",width:"5px",height:"5px",fill:"lightgray"}),b("rect",{x:"5px",y:"5px",width:"5px",height:"5px",fill:"lightgray"})])]),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+d+"-alpha-squares)"}),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+d+"-alpha-gradient)"})]);this.slideElement.appendChild(a);this.pickerElement.appendChild(c);this.alphaElement.appendChild(d)};
c.prototype.enableDragging=function(c,b,d){d3.select(b).on("mousedown",function(){d3.event.preventDefault();d3.event.stopPropagation();var c=a(b);d3.select(document).on("mousemove.colordrag",function(){document.selection?document.selection.empty():window.getSelection().removeAllRanges();d(c)});d3.select(document).on("mouseup",function(){d3.select(document).on("mousemove.colordrag",null)})})};c.prototype.slideListener=function(){var c=this,b=c.slideElement;return function(){var d=a(b);c.hsv.h=d.y/
b.offsetHeight*360;359<=c.hsv.h&&(c.hsv.h=359);c.updateColor()}};c.prototype.pickerListener=function(){var c=this,b=c.pickerElement;return function(){var d=b.offsetWidth,h=b.offsetHeight,k=a(b);c.hsv.s=k.x/d;c.hsv.v=(h-k.y)/h;c.updateColor()}};c.prototype.alphaListener=function(){var c=this,b=c.alphaElement;return function(){var d=a(b).x/b.offsetWidth;c.opacity=Number(d.toFixed(2));c.updateColor()}};c.prototype.dialogListener=function(){var a=this.container;return function(c){a.style.left=d3.event.pageX-
c.x+"px";a.style.top=d3.event.pageY-c.y+"px"}};c.prototype.originalColorListener=function(){var a=this;return function(){a.setColor(a.originalColorIndicator.style.backgroundColor)}};c.prototype.doneListener=function(){var a=this;return function(){a.onChange=void 0;a.close()}};c.prototype.open=function(){var a=d3.select(this.container);a.style("visibility","visible");a.transition().duration(200).style("opacity",1);return this};c.prototype.close=function(){d3.select(this.container).transition().duration(200).style("opacity",
0).on("end",function(){d3.select(this).style("visibility","hidden")});this.onClose&&this.onClose();this.onClose=void 0;return this};Object.defineProperties(c.prototype,{color:{configurable:!0,enumerable:!0,get:function(){return this._color}},width:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetWidth}},height:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetHeight}},visible:{configurable:!0,enumerable:!0,get:function(){return"visible"==d3.select(this.container).style("visibility")},
set:function(a){a?this.open():this.close()}}});d.ColorPicker=c})(CGView);
(function(d){var b=function(a){a=void 0===a?{}:a;this._data={};this._sections=d.defaultFor(a.sections,[]);a=$jscomp.makeIterator(this.sections);for(var c=a.next();!c.done;c=a.next())this.data[c.value]={}};b.prototype.draw=function(a,c,b){c=void 0===c?10:c;b=void 0===b?20:b;c=d.pixel(c);b=d.pixel(b);var g=this._data,e=this._sections;a.font=d.pixel(10)+"pt Sans-Serif";a.fillStyle="black";var h=d.pixel(18);a.textAlign="left";!0===this.debug&&Object.keys(g);var k=0;e.forEach(function(d){Object.keys(g[d]).forEach(function(e){a.fillText(d+
"|"+e+": "+g[d][e],c,b+h*k);k+=1})})};Object.defineProperties(b.prototype,{sections:{configurable:!0,enumerable:!0,get:function(){return this._sections}},data:{configurable:!0,enumerable:!0,get:function(){return this._data}}});d.Debug=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.CGObject.call(this,a,c,b);this.color=d.defaultFor(c.color,"grey");this._thickness=d.defaultFor(c.thickness,1);this._spacing=d.defaultFor(c.spacing,1);this.radii=new d.CGArray};$jscomp.inherits(b,d.CGObject);b.prototype.clearRadii=function(){this.radii=new d.CGArray};b.prototype.addRadius=function(a){this._radii.push(a)};b.prototype.draw=function(){if(this.visible)for(var a=0,c=this._radii.length;a<c;a++){var b=this._radii[a];
this._visibleRange=this.canvas.visibleRangeForRadius(b,100);this.visibleRange&&this.viewer.canvas.drawArc("map",this.visibleRange.start,this.visibleRange.stop,b,this.color.rgbaString,d.pixel(this.thickness))}};Object.defineProperties(b.prototype,{color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new d.Color(a)}},thickness:{configurable:!0,enumerable:!0,set:function(a){a&&(this._thickness=Math.round(a),this.viewer.layout._adjustProportions())},
get:function(){return this._thickness}},spacing:{configurable:!0,enumerable:!0,set:function(a){a&&(this._spacing=Math.round(a),this.viewer.layout._adjustProportions())},get:function(){return this._spacing}},radii:{configurable:!0,enumerable:!0,set:function(a){a&&"CGArray"==a.toString()&&(this._radii=a)},get:function(){return this._radii}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}}});d.Divider=b})(CGView);
(function(d){var b=function(a){var c=this;this._viewer=a;this.events=a.events;this._initializeMousemove();this._initializeClick();this.events.on("click",function(a){console.log(a)});this.events.on("mousemove",function(a){c.viewer.debug&&c.viewer.debug.data.position&&(c.viewer.debug.data.position.xy=Math.round(a.mapX)+", "+Math.round(a.mapY),c.viewer.debug.data.position.bp=a.bp,c.viewer.debug.data.position.feature=a.feature&&a.feature.label.name,c.viewer.debug.data.position.score=a.score,c.canvas.clear("ui"),
c.viewer.debug.draw(c.canvas.context("ui")))});this._legendSwatchClick();this._legendSwatchMouseOver();this._highlighterMouseOver()};b.prototype._initializeMousemove=function(){var a=this,c=this.viewer;d3.select(this.canvas.node("ui")).on("mousemove.cgv",function(){c.clear("ui");a.events.trigger("mousemove",a._createEvent(d3.event))})};b.prototype._initializeClick=function(){var a=this;d3.select(this.canvas.node("ui")).on("click.cgv",function(){a.events.trigger("click",a._createEvent(d3.event))})};
b.prototype._createEvent=function(a){var c=this.canvas.scale,b=d.pixel(a.offsetX);a=d.pixel(a.offsetY);var g=c.x.invert(b),c=c.y.invert(a),e=Math.sqrt(g*g+c*c),h=this.viewer.layout.slotForRadius(e),k=this.canvas.bpForPoint({x:g,y:c}),l=h&&h.findFeaturesForBp(k)[0],m=h&&h._plot,n=m&&m.scoreForPosition(k).toFixed(2);return{bp:k,radius:e,slot:h,feature:l,plot:m,score:n,canvasX:b,canvasY:a,mapX:g,mapY:c,d3:d3.event}};b.prototype._legendSwatchClick=function(){var a=this.viewer;this.events.on("click.swatch",
function(c){for(var b=a.legend,d=b.visibleItems(),e=0,h=d.length;e<h;e++)if(d[e]._swatchContainsPoint({x:c.canvasX,y:c.canvasY})){var k=d[e];k.swatchSelected=!0;c=a.colorPicker;c.visible||b.setColorPickerPosition(c);c.onChange=function(a){k.swatchColor=a.rgbaString;cgv.drawFast()};c.onClose=function(){k.swatchSelected=!1;cgv.drawFull();b.draw()};c.setColor(k._swatchColor.rgba);c.open();break}})};b.prototype._legendSwatchMouseOver=function(){var a=this,c=this.viewer;this.events.on("mousemove.swatch",
function(b){var d=c.legend,e=d.visibleItems(),h=d.highlightedSwatchedItem;d.highlightedSwatchedItem=void 0;for(var k=0,l=e.length;k<l;k++)if(e[k]._swatchContainsPoint({x:b.canvasX,y:b.canvasY})){e[k].swatchHighlighted=!0;a.canvas.cursor="pointer";d.draw();break}h&&!d.highlightedSwatchedItem&&(a.canvas.cursor="auto",d.draw())})};b.prototype._highlighterMouseOver=function(){var a=this.viewer;this.events.on("mousemove.highlighter",function(c){if(c.feature)c.feature.highlight(c.slot);else if(c.plot){var b=
c.plot.scoreForPosition(c.bp);if(b){var g=d.indexOfValue(c.plot.positions,c.bp,!1),e=c.plot.positions[g],g=c.plot.positions[g+1]||a.sequence.length,h=c.slot.radius-c.slot.thickness/2+c.slot.thickness*c.plot.baseline,k=h+(b-c.plot.baseline)*c.slot.thickness,l=Math.abs(h-k),h=Math.min(h,k)+l/2;c=b>=c.plot.baseline?c.plot.colorPositive.copy():c.plot.colorNegative.copy();c.highlight();a.canvas.drawArc("ui",e,g,h,c,l)}}})};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},
canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}}});d.EventMonitor=b})(CGView);
(function(d){var b=function(){this._handlers={}};b.prototype.on=function(b,f){var d=this._handlers;a(b);var k=b.replace(/\..*/,"");d[k]||(d[k]=[]);d[k].push(new c(b,f))};b.prototype.off=function(c,b){var d=this._handlers;a(c);var k=c.replace(/\..*/,""),l=f(c);1==arguments.length?l?k?d[k]=d[k].filter(function(a){return a.namespace!=l}):Object.keys(d).forEach(function(a){d[a]=d[a].filter(function(a){return a.namespace!=l})}):d[k]=void 0:d[k]=d[k].filter(function(a){return a.callback!=b})};b.prototype.trigger=
function(c,b){var d=this._handlers;a(c);var k=c.replace(/\..*/,""),l=f(c);Array.isArray(d[k])&&d[k].forEach(function(a){l?a.namespace==l&&a.callback.call(null,b):a.callback.call(null,b)})};var a=function(a){if("string"!=typeof a)throw Error("Type must be a string");},c=function(a,c){this.callback=c;this.event_type=a.replace(/\..*/,"");this.namespace=f(a)},f=function(a){return(result=a.match(/\.(.*)/))?result[1]:void 0};d.Events=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.CGObject.call(this,a,c,b);this.viewer=a;this.type=d.defaultFor(c.type,"");this.source=d.defaultFor(c.source,"");this.range=new d.CGRange(this.viewer.sequence,Number(c.start),Number(c.stop));this._strand=d.defaultFor(c.strand,1);this.label=new d.Label(this,{name:c.label});this._radiusAdjustment=Number(c.radiusAdjustment)||0;this._proportionOfThickness=Number(c.proportionOfThickness)||1;this.extractedFromSequence=d.defaultFor(c.extractedFromSequence,
!1);this.legendItem=c.legend};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Feature"};b.prototype.isDirect=function(){return 1==this.strand};b.prototype.isReverse=function(){return-1==this.strand};b.prototype.draw=function(a,c,b,d,e){e=void 0===e?{}:e;if(this.visible&&this.range.overlapsRange(d)){var h=this.canvas,k=this.start,l=this.stop,m=d.contains(k),n=d.contains(l);e=e.color||this.color;m||(k=d.start-100);n||(l=d.stop+100);1E3<this.viewer.zoomFactor&&m&&n&&this.range.overHalfCircle()?
(h.drawArc(a,d.start-100,l,this.adjustedRadius(c,b),e.rgbaString,this.adjustedWidth(b),this.decoration),h.drawArc(a,k,d.stop+100,this.adjustedRadius(c,b),e.rgbaString,this.adjustedWidth(b),this.decoration)):h.drawArc(a,k,l,this.adjustedRadius(c,b),e.rgbaString,this.adjustedWidth(b),this.decoration)}};b.prototype.highlight=function(a){if(this.visible){this.canvas.clear("ui");var c=this.color.copy();c.highlight();if(a&&a.features().contains(this))this.draw("ui",a.radius,a.thickness,a.visibleRange,{color:c});
else{var b=this;this.viewer.slots().each(function(a,d){d.features().contains(b)&&b.draw("ui",d.radius,d.thickness,d.visibleRange,{color:c})})}}};b.prototype.adjustedRadius=function(a,c){return 0==this._radiusAdjustment&&1==this._proportionOfThickness?a:0==this._radiusAdjustment?a-c/2+this._proportionOfThickness*c/2:a};b.prototype.adjustedWidth=function(a){return this._proportionOfThickness*a};b.prototype.tracks=function(){var a=this,c=new d.CGArray;this.viewer.tracks().each(function(b,d){d.features().contains(a)&&
c.push(d)});return c};b.prototype.slots=function(){var a=this,c=new d.CGArray;this.tracks().each(function(b,d){d.slots().each(function(b,d){d.features().contains(a)&&c.push(d)})});return c};b.prototype.remove=function(){var a=this;this.viewer._features=this.viewer._features.remove(this);this.viewer.annotation.removeLabel(this.label);this.tracks().each(function(c,b){b.removeFeature(a)})};b.prototype.refresh=function(){var a=this;this.viewer.tracks().each(function(c,b){(b.features().contains(a)||"source"==
b.contents.from&&b.contents.extract==a.source)&&b.refresh()})};Object.defineProperties(b.prototype,{type:{configurable:!0,enumerable:!0,get:function(){return this._type},set:function(a){this._type=a;this.featureType=this.viewer.findFeatureTypeOrCreate(a,"arc")}},featureType:{configurable:!0,enumerable:!0,get:function(){return this._featureType},set:function(a){this._featureType=a}},name:{configurable:!0,enumerable:!0,get:function(){return this.label&&this.label.name},set:function(a){this.label?this.label.name=
a:this.label=new d.Label(this,{name:a})}},extractedFromSequence:{configurable:!0,enumerable:!0,get:function(){return this._extractedFromSequence},set:function(a){this._extractedFromSequence=a}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._features.push(this)}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand},set:function(a){this._strand=a}},range:{configurable:!0,enumerable:!0,get:function(){return this._range},
set:function(a){this._range=a}},start:{configurable:!0,enumerable:!0,get:function(){return this.range.start},set:function(a){this.range.start=a}},stop:{configurable:!0,enumerable:!0,get:function(){return this.range.stop},set:function(a){this.range.stop=a}},length:{configurable:!0,enumerable:!0,get:function(){return this.range.length}},label:{configurable:!0,enumerable:!0,get:function(){return this._label},set:function(a){this._label=a}},color:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?
this.legendItem.swatchColor:this._color}},decoration:{configurable:!0,enumerable:!0,get:function(){return this.featureType?"arrow"==this.featureType.decoration?1==this.strand?"clockwise-arrow":"counterclockwise-arrow":this.featureType.decoration:"arc"}},legendItem:{configurable:!0,enumerable:!0,get:function(){return this._legendItem},set:function(a){this.legendItem&&void 0==a||(this._legendItem=a&&"LegendItem"==a.toString()?a:this.viewer.legend.findLegendItemOrCreate(a))}},legend:{configurable:!0,
enumerable:!0,get:function(){return this.legendItem},set:function(a){this.legendItem=a}}});d.Feature=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.CGObject.call(this,a,c,b);this.viewer=a;this.name=d.defaultFor(c.name,"");this.decoration=d.defaultFor(c.decoration,"arc");this.viewer.trigger("feature-type-update")};$jscomp.inherits(b,d.CGObject);b.prototype.features=function(a){var c=this;return(new d.CGArray(this.viewer._features.filter(function(a){return a.featureType==c}))).get(a)};b.prototype.remove=function(){var a=this.viewer;a._featureTypes=a._featureTypes.remove(this);
a.trigger("feature-type-update")};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._featureTypes.push(this)}},name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=a}},id:{configurable:!0,enumerable:!0,get:function(){return this.name},set:function(a){this.name=a}},decoration:{configurable:!0,enumerable:!0,get:function(){return this._decoration},set:function(a){d.validate(a,
["arc","arrow","score"])&&(this._decoration=a)}}});d.FeatureType=b})(CGView);
(function(d){var b=function(a){this._rawFont=a};b.prototype.toString=function(){return"Font"};b.prototype.width=function(a,c){a.font=this.css;return a.measureText(c).width};b.prototype.copy=function(){return new d.Font(this.string)};b.prototype._styleAsCss=function(){return"plain"==this.style?"normal":"bold"==this.style?"bold":"italic"==this.style?"italic":"bold-italic"==this.style?"italic bold":""};b.prototype._generateFont=function(){this._font=this._styleAsCss()+" "+d.pixel(this.size)+"px "+this.family};
Object.defineProperties(b.prototype,{_rawFont:{configurable:!0,enumerable:!0,set:function(a){if("string"===typeof a||a instanceof String)this.string=a;else{var c=new d.CGArray(Object.keys(a));c.contains("family")&&c.contains("style")&&c.contains("size")?(this.family=a.family,this.style=a.style,this.size=a.size):console.log("Font objects require the following keys: family, style, and size")}}},string:{configurable:!0,enumerable:!0,get:function(){return this.family+","+this.style+","+this.size},set:function(a){a=
a.replace(/ +/g,"");a=a.split(",");3==a.length?(this.family=a[0],this.style=a[1],this.size=a[2]):console.log("Font must have 3 parts");this._generateFont()}},css:{configurable:!0,enumerable:!0,get:function(){return this._font}},family:{configurable:!0,enumerable:!0,get:function(){return this._family||"sans-serif"},set:function(a){this._family=a;this._generateFont()}},size:{configurable:!0,enumerable:!0,get:function(){return this._size||12},set:function(a){this._size=Number(a);this._generateFont()}},
style:{configurable:!0,enumerable:!0,get:function(){return this._style||"plain"},set:function(a){this._style=a;this._generateFont()}},bold:{configurable:!0,enumerable:!0,get:function(){return"bold"==this.style||"bold-italic"==this.style},set:function(a){a?"plain"==this.style?this.style="bold":"italic"==this.style&&(this.style="bold-italic"):"bold"==this.style?this.style="plain":"bold-italic"==this.style&&(this.style="italic")}},italic:{configurable:!0,enumerable:!0,get:function(){return"italic"==
this.style||"bold-italic"==this.style},set:function(a){a?"plain"==this.style?this.style="italic":"bold"==this.style&&(this.style="bold-italic"):"italic"==this.style?this.style="plain":"bold-italic"==this.style&&(this.style="bold")}},height:{configurable:!0,enumerable:!0,get:function(){return d.pixel(this.size)}}});b.calculateWidths=function(a,c,b){a.save();for(var d=[],e=[],h=0,k=c.length;h<k;h++)e.push({index:h,font:c[h],text:b[h]});e.sort(function(a,c){return a.font>c.font?1:-1});c="";h=0;for(k=
e.length;h<k;h++)b=e[h].font,text=e[h].text,b!=c&&(c=a.font=b),d[e[h].index]=a.measureText(text).width;a.restore();return d};d.Font=b})(CGView);(function(d){var b=function(a,c){c=void 0===c?{}:c;this._viewer=a;this.textDisplay=d.defaultFor(c.textDisplay,!0)};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}}});d.Highlighter=b})(CGView);
(function(d){var b=function(a){this._viewer=a};b.prototype.loadJSON=function(a){var c=this._viewer;c._sequence=new d.Sequence(c,a.sequence);var b=a.settings;c.settings=new d.Settings(c,b.general);c.ruler=new d.Ruler(c,b.ruler);c.backbone=new d.Backbone(c,b.backbone);a.captions&&a.captions.forEach(function(a){new d.Caption(c,a)});c.legend=new d.Legend(c,a.legend);a.featureTypes&&a.featureTypes.forEach(function(a){new d.FeatureType(c,a)});a.features&&a.features.forEach(function(a){new d.Feature(c,a)});
a.plots&&a.plots.forEach(function(a){console.log("PLOT");new d.Plot(c,a)});c.layout=new d.Layout(c,a.layout)};b.prototype.exportImage=function(a,c){var b=this._viewer,g=b.canvas;a=a||b.width;c=c||b.height;var e="CGV-Image-"+a+"x"+c;a/=d.pixelRatio;c/=d.pixelRatio;var h=g._layers,k=b.debug;b.debug=!1;for(var l=g.layerNames.concat(["export"]),m=g.createLayers(d3.select("body"),l,a,c),n=d3.min([a,c])/b.minDimension,p=$jscomp.makeIterator(g.layerNames),q=p.next();!q.done;q=p.next())q=q.value,m[q].ctx.scale(n,
n);g._layers=m;b.drawExport();b.fillBackground();b.legend.draw();n=0;for(q=b._captions.length;n<q;n++)b._captions[n].draw();n=m["export"].ctx;n.drawImage(m.background.node,0,0);n.drawImage(m.map.node,0,0);n.drawImage(m.captions.node,0,0);n=m["export"].node.toDataURL();g._layers=h;b.debug=k;b=$jscomp.makeIterator(l);for(q=b.next();!q.done;q=b.next())q=q.value,d3.select(m[q].node).remove();b=Math.min(400,a);g=Math.min(400,c);m=window.open();e=["<html><head><title>",e,'</title><style>body { font-family: sans-serif; }</style></head><body><h2>Your CGView Image is Below</h2><p>To save, right click on either image below and choose "Save Image As...". The two images are the same. The first is scaled down for easier previewing, while the second shows the map at actual size. Saving either image will download the full size map.</p><h3>Preview</h3>',
'<img style="border: 1px solid grey" width="'+b+'" height="'+g+'" src="'+n+'"/ >',"<h3>Actual Size</h3>",'<img style="border: 1px solid grey" width="'+a+'" height="'+c+'" src="'+n+'"/ >',"</body><html>"].join("");m.document.write(e)};d.IO=b})(CGView);
(function(d){var b=function(a,c){c=void 0===c?{}:c;this._feature=a;this.name=c.name;this.bp=this.feature.start+this.feature.length/2};Object.defineProperties(b.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){void 0==a||""==a?(this.width=0,""!=this._name&&void 0!=this._name&&this.annotation.removeLabel(this),this._name=""):(""!=this._name&&void 0!=this._name||this.annotation.addLabel(this),this._name=a,this.width=this.font.width(this.viewer.canvas.context("map"),
this._name))}},rect:{configurable:!0,enumerable:!0,get:function(){return this._rect},set:function(a){this._rect=a}},width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.height}},origin:{configurable:!0,enumerable:!0,get:function(){return this._origin},set:function(a){this._origin=a}},lineAttachment:{configurable:!0,enumerable:!0,get:function(){return this._lineAttachment},set:function(a){this._lineAttachment=
a}},font:{configurable:!0,enumerable:!0,get:function(){return this._font||this.annotation.font},set:function(a){this._font=void 0==a?this.annotation.font:"Font"==a.toString()?a:new d.Font(a)}},viewer:{configurable:!0,enumerable:!0,get:function(){return this.feature.viewer}},annotation:{configurable:!0,enumerable:!0,get:function(){return this.viewer.annotation}},feature:{configurable:!0,enumerable:!0,get:function(){return this._feature}},start:{configurable:!0,enumerable:!0,get:function(){return this.feature.start}},
stop:{configurable:!0,enumerable:!0,get:function(){return this.feature.stop}}});d.Label=b})(CGView);
(function(d){var b=function(a,c,b,g){c=void 0===c?{}:c;this._viewer=a;this._tracks=new d.CGArray;this._fastMaxFeatures=1E3;if(c.tracks){var e=this;c.tracks.forEach(function(a){new d.Track(e,a)})}this._adjustProportions()};b.prototype._adjustProportions=function(){var a=this.viewer,c=.35*a.minDimension,b=.15*a.minDimension,d=this.visibleSlots().length*(a.slotDivider.thickness+a.slotDivider.spacing),b=c-b-a.backbone.thickness-d,d=this.visibleSlots().filter(function(a){return"plot"==a.type}).length,
e=this.visibleSlots().filter(function(a){return"feature"==a.type}).length,h=b/(6*d+e),k=6*h,h=Math.min(h,30),k=Math.min(k,100),l=0;this.visibleSlots().filter(function(a){return a.outside}).forEach(function(a){"feature"==a.type?l+=h:"plot"==a.type&&(l+=k)});c-=l;a.backbone.radius=c;var m=h/c,n=k/c;this.visibleSlots().each(function(a,c){"feature"==c.type?c.proportionOfRadius=m:"plot"==c.type&&(c.proportionOfRadius=n)});this.updateLayout(!0)};b.prototype.tracks=function(a){return this._tracks.get(a)};
b.prototype.slots=function(a){for(var c=new d.CGArray,b=0,g=this._tracks.length;b<g;b++)c.merge(this._tracks[b]._slots);return c.get(a)};b.prototype.visibleSlots=function(a){return(new d.CGArray(this.slots().filter(function(a){return a.visible&&a.track.visible}))).get(a)};b.prototype.slotForRadius=function(a){for(var c=this.visibleSlots(),b,d=0,e=c.length;d<e;d++)if(c[d].containsRadius(a)){b=c[d];break}return b};b.prototype.drawMapWithoutSlots=function(){var a=this.viewer,c=a.backbone,b=this.canvas,
g=(new Date).getTime();a.clear("map");a.clear("ui");a.messenger.visible&&a.messenger.close();c.draw();this.updateLayout();a.slotDivider.draw();c=d.pixel(a.slotDivider.thickness/2+a.ruler.spacing);a.ruler.draw(this.insideRadius-c,this.outsideRadius+c);a.annotation.visible&&a.annotation.draw(this.insideRadius,this.outsideRadius);this.drawProgress();a.debug&&(a.debug.data.time.fastDraw=d.elapsed_time(g),a.debug.draw(b.context("ui")));b._testDrawRange&&(a=b.context("captions"),a.strokeStyle="grey",a.rect(0,
0,b.width,b.height),a.stroke());this._slotIndex=0;this._slotTimeoutID&&(clearTimeout(this._slotTimeoutID),this._slotTimeoutID=void 0)};b.prototype.drawFast=function(){this.drawMapWithoutSlots();this.drawAllSlots(!0)};b.prototype.drawFull=function(){this.drawMapWithoutSlots();this.drawAllSlots(!0);this._drawFullStartTime=(new Date).getTime();this.drawSlotWithTimeOut(this)};b.prototype.drawExport=function(){this.drawMapWithoutSlots();this.drawAllSlots(!1)};b.prototype.draw=function(a){a?this.drawFast():
this.drawFull()};b.prototype.drawAllSlots=function(a){for(var c,b,d=0,e=this._tracks.length;d<e;d++)if(c=this._tracks[d],c.visible)for(var h=0,k=c._slots.length;h<k;h++)b=c._slots[h],b.visible&&b.draw(this.canvas,a)};b.prototype.drawSlotWithTimeOut=function(a){var c=a.visibleSlots(),b=c[a._slotIndex];b&&(b.clear(),b.draw(a.canvas),a._slotIndex++,a._slotIndex<c.length?a._slotTimeoutID=setTimeout(a.drawSlotWithTimeOut,0,a):a.viewer.debug&&(a.viewer.clear("ui"),a.viewer.debug.data.time.fullDraw=d.elapsed_time(a._drawFullStartTime),
a.viewer.debug.draw(a.canvas.context("ui"))))};b.prototype.updateLayout=function(a){var c=this.viewer;if(a||this._savedZoomFactor!=c._zoomFactor){this._savedZoomFactor=c._zoomFactor;a=c.backbone;var b=d.pixel(a.zoomedThickness),g=d.pixel(a.zoomedRadius);a=g+b/2;var b=g-b/2,e=d.pixel(c.slotDivider.spacing),g=0,h,k;c.slotDivider.clearRadii();for(var l=this._slotLength=0,m=this._tracks.length;l<m;l++)if(h=this._tracks[l],h.visible)for(var n=0,p=h._slots.length;n<p;n++)if(k=h._slots[n],k.visible){this._slotLength++;
var q=this._calculateSlotThickness(k.proportionOfRadius);k._thickness=q;g="outside"==h.position||"both"==h.position&&k.isDirect()?a+=q/2+e+g:b-=q/2+e+g;k._radius=g;g=q/2;q=c.slotDivider.thickness;g="outside"==h.position||"both"==h.position&&k.isDirect()?a+=e+g+q:b-=e+g+q;c.slotDivider.addRadius(g);g=q/2}this._fastFeaturesPerSlot=this._fastMaxFeatures/this.slotLength;this._insideRadius=b;this._outsideRadius=a}};b.prototype._calculateSlotThickness=function(a){var c=this.viewer;a=d.pixel(Math.min(c.backbone.zoomedRadius,
c.maxZoomedRadius())*a);return this.maxSlotThickness?Math.min(a,d.pixel(this.maxSlotThickness)):a};b.prototype.drawProgress=function(){this.canvas.clear("background");for(var a,c,b,d=0,e=this._tracks.length;d<e;d++){a=this._tracks[d];b=a.loadProgress;for(var h=0,k=a._slots.length;h<k;h++)c=a._slots[h],c.drawProgress(b)}};b.prototype.moveTrack=function(a,c){this._tracks.move(a,c);this._adjustProportions()};b.prototype.removeTrack=function(a){this._tracks=this._tracks.remove(a);this._adjustProportions()};
Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},insideRadius:{configurable:!0,enumerable:!0,get:function(){return this._insideRadius}},outsideRadius:{configurable:!0,enumerable:!0,get:function(){return this._outsideRadius}},slotLength:{configurable:!0,enumerable:!0,get:function(){return this._slotLength||0}},fastMaxFeatures:{configurable:!0,enumerable:!0,
get:function(){return this._fastMaxFeatures}},fastFeaturesPerSlot:{configurable:!0,enumerable:!0,get:function(){return this._fastFeaturesPerSlot}},maxSlotThickness:{configurable:!0,enumerable:!0,get:function(){return this._maxSlotThickness},set:function(a){this._maxSlotThickness=a}}});d.Layout=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.Caption.call(this,a,c,b);this.name="Legend"};$jscomp.inherits(b,d.Caption);b.prototype.toString=function(){return"Legend"};b.prototype.setColorPickerPosition=function(a){var c,b=this.viewer._container.node().getBoundingClientRect();c=this.originX/d.pixel(1)+b.left+window.pageXOffset;var b=this.originY/d.pixel(1)+b.top+window.pageYOffset,g=this.width/d.pixel(1);c=/-left$/.exec(this.position)?{x:c+g+5,y:b}:{x:c-a.width-5,y:b};
a.setPosition(c)};b.prototype.findLegendItemByName=function(a){if(a)return this._items.find(function(c){return a.toLowerCase()==c.text.toLowerCase()})};b.prototype.findLegendItemOrCreate=function(a,c){a=void 0===a?"Unknown":a;c=void 0===c?"black":c;var b=this.findLegendItemByName(a);b||(b=new d.LegendItem(this,{text:a,swatchColor:c}));return b};b.prototype.draw=function(){if(this.visible){var a=this.ctx;this.fillBackground();var c;a.lineWidth=1;a.textBaseline="top";for(var b=0,g=this._items.length;b<
g;b++){var e=this._items[b];if(e.visible){var h=e.textY();c=e.drawSwatch;var k=e.swatchWidth;a.font=e.font.css;a.textAlign=e.textAlignment;if(c){a.strokeStyle=e.swatchSelected?"black":e.swatchHighlighted?"grey":this.backgroundColor.rgbaString;var l=d.pixel(2);c=e.swatchX();a.strokeRect(c-l,h-l,k+2*l,k+2*l);a.fillStyle=e.swatchColor.rgbaString;a.fillRect(c,h,k,k)}a.fillStyle=e.fontColor.rgbaString;a.fillText(e.text,e.textX(),h)}}}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,
get:function(){return this._viewer},set:function(a){this._viewer=a}},selectedSwatchedItem:{configurable:!0,enumerable:!0,get:function(){return this._selectedSwatchedItem},set:function(a){this._selectedSwatchedItem=a}},highlightedSwatchedItem:{configurable:!0,enumerable:!0,get:function(){return this._highlightedSwatchedItem},set:function(a){this._highlightedSwatchedItem=a}},swatchPadding:{configurable:!0,enumerable:!0,get:function(){return this.padding/2}}});d.Legend=b})(CGView);
(function(d){var b=function(a,c,b){c=void 0===c?{}:c;b=void 0===b?{}:b;d.CaptionItem.call(this,a,c,b);this._drawSwatch=d.defaultFor(c.drawSwatch,!0);this._swatchColor=new d.Color(d.defaultFor(c.swatchColor,"black"));this.refresh();this.viewer.trigger("legend-update")};$jscomp.inherits(b,d.CaptionItem);b.prototype.toString=function(){return"LegendItem"};b.prototype.textX=function(){if(this.drawSwatch){var a=this.parent;if("left"==this.textAlignment)return this.swatchX()+this.swatchWidth+a.swatchPadding;
if("center"==this.textAlignment)return a.originX+a.width/2;if("right"==this.textAlignment)return this.swatchX()-a.swatchPadding}else return d.CaptionItem.prototype.textX.call(this)};b.prototype.swatchX=function(){var a=this.parent;if("left"==this.textAlignment||"center"==this.textAlignment)return a.originX+a.padding;if("right"==this.textAlignment)return a.originX+a.width-a.padding-this.swatchWidth};b.prototype._swatchContainsPoint=function(a){for(var c=this.parent.originX+this.parent.padding,b=this.parent.originY+
this.parent.padding,d=this.parent.visibleItems(),e=0,h=d.length;e<h;e++){var k=d[e];if(k==this)break;b+=1.5*k.height}if(a.x>=c&&a.x<=c+this.height&&a.y>=b&&a.y<=b+this.height)return!0};b.prototype.features=function(a){var c=this;return(new d.CGArray(this.viewer._features.filter(function(a){return a.legendItem==c}))).get(a)};b.prototype.plots=function(a){var c=this;return(new d.CGArray(this.viewer._plots.filter(function(a){return a.legendItem==c||a.legendItemPositive==c||a.legendNegative==c}))).get(a)};
Object.defineProperties(b.prototype,{legend:{configurable:!0,enumerable:!0,get:function(){return this._parent}},drawSwatch:{configurable:!0,enumerable:!0,get:function(){return this._drawSwatch},set:function(a){this._drawSwatch=a;this.refresh()}},swatchWidth:{configurable:!0,enumerable:!0,get:function(){return this.height}},swatchColor:{configurable:!0,enumerable:!0,get:function(){return this._swatchColor},set:function(a){"Color"==a.toString()?this._swatchColor=a:this._swatchColor.setColor(a);this.refresh()}},
color:{configurable:!0,enumerable:!0,get:function(){return this.swatchColor},set:function(a){this.swatchColor=a}},swatchSelected:{configurable:!0,enumerable:!0,get:function(){return this.legend.selectedSwatchedItem==this},set:function(a){a?this.legend.selectedSwatchedItem=this:this.legend.selectedSwatchedItem==this&&(this.legend.selectedSwatchedItem=void 0)}},swatchHighlighted:{configurable:!0,enumerable:!0,get:function(){return this.legend.highlightedSwatchedItem==this},set:function(a){a?this.legend.highlightedSwatchedItem=
this:this.legend.highlightedSwatchedItem==this&&(this.legend.highlightedSwatchedItem=void 0)}}});d.LegendItem=b})(CGView);
(function(d){var b=function(a,c){c=void 0===c?{}:c;this._viewer=a;this._wrapper=a._wrapper.node();this.fadeTime=d.defaultFor(c.fadeTime,100);this.height=d.defaultFor(c.height,40);this.width=d.defaultFor(c.width,200);this.box=d3.select(this._wrapper).append("div").style("display","none").attr("class","cgv-messenger").style("width",this.height).style("height",this.width);this.contents=this.box.append("div").attr("class","cgv-messenger-contents");this._adjust_size();return this};b.prototype.toString=
function(){return"Messenger"};b.prototype.open=function(a){d.defaultFor(a,this.fadeTime);this._adjust_size();this.box.style("display","block");this.box.style("opacity",1);return this};b.prototype.close=function(a){a=d.defaultFor(a,this.fadeTime);this.box.transition().duration(a).style("opacity",0).on("end",function(){d3.select(this).style("display","none")});return this};b.prototype._adjust_size=function(){var a=this._wrapper.offsetWidth,c=this._wrapper.offsetHeight,b=this.width,d=this.height;this.height>
c-50&&(d=c-50);this.width>a-50&&(b=a-50);this.box.style("width",b+"px").style("height",d+"px")};b.prototype.flash=function(a){this.contents.html(a);this.open()};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},visible:{configurable:!0,enumerable:!0,get:function(){return"none"!=this.box.style("display")}},fadeTime:{configurable:!0,enumerable:!0,get:function(){return this._fadeTime},set:function(a){this._fadeTime=a}}});d.Messenger=b})(CGView);
(function(d){var b=function(a,c){a=void 0===a?[]:a;c=void 0===c?{}:c;this.intervals=[];this.circularLength=c.circularLength;this.fill(a)};b.prototype._normalize=function(a){for(var c,b=[],d=0,e=a.length;d<e;d++)c=a[d],c.start<=c.stop?b.push({interval:c,index:d}):(b.push({interval:c,index:d,start:c.start,stop:this.circularLength,crossesOrigin:!0}),b.push({interval:c,index:d,start:1,stop:c.stop,crossesOrigin:!0}));return b};b.prototype.fill=function(a){this._length=a.length;if(0==a.length)this.topList=
[];else{var b=this.start,d=this.end,g=this.sublist;this.intervals=a=this._normalize(a);a.sort(function(a,e){return b(a)!=b(e)?b(a)-b(e):d(e)-d(a)});var e=[],h=[];this.topList=h;h.push(a[0]);if(1!=a.length)for(var k,l,m=1,n=a.length;m<n;m++)if(k=a[m],d(k)<d(a[m-1]))e.push(h),h=Array(k),g(a[m-1],h);else for(;;)if(0==e.length){h.push(k);break}else if(l=e[e.length-1],d(l[l.length-1])>d(k)){h.push(k);break}else h=e.pop()}};b.prototype.end=function(a){return a.stop||a.interval.stop};b.prototype.start=function(a){return a.start||
a.interval.start};b.prototype.sublist=function(a,b){a.sublist=b};b.prototype._run=function(a,b,d,g,e){b=void 0===b?a:b;d=void 0===d?1:d;g=void 0===g?function(){}:g;e=void 0===e?this.topList:e;var h,k=e.length,l,m;0<d?(m=1,l=this._binarySearch(e,a,!0,"end")):0>d&&(m=-1,l=this._binarySearch(e,b,!1,"start"));for(;0<=l&&l<k&&(1==m?this.start(e[l])<=b:this.end(e[l])>=a);)h=!1,e[l].crossesOrigin&&(-1!=this._runIntervalsCrossingOrigin.indexOf(e[l].interval)?h=!0:this._runIntervalsCrossingOrigin.push(e[l].interval)),
h||0!=e[l].index%d||g.call(e[l].interval,e[l].interval),e[l].sublist&&this._run(a,b,d,g,e[l].sublist),l+=m};b.prototype.run=function(a,b,d,g){b=void 0===b?a:b;d=void 0===d?1:d;g=void 0===g?function(){}:g;this._runIntervalsCrossingOrigin=[];this.circularLength&&b<a?(this._run(a,this.circularLength,d,g),this._run(1,b,d,g)):this._run(a,b,d,g)};b.prototype.count=function(a,b,d){var g=0;this.run(a,b,d,function(a){g++});return g};b.prototype.find=function(a,b,d){var g=[];this.run(a,b,d,function(a){g.push(a)});
return g};b.prototype._binarySearch=function(a,b,d,g){for(var e=-1,h=a.length,k,l;1<h-e;)if(k=(e+h)/2|0,l=this[g](a[k]),l<b)e=k;else if(l>b)h=k;else return k;return d?h:e};b.test=function(){function a(a,b,c,d){a=a.find(b,c).map(function(a){return a.name}).sort().join(", ");d=d.sort().join(", ");b=""+b+".."+c+": "+d+" - "+(a==d?"Pass":"FAIL - "+a);console.log(b)}var b=new d.NCList([{name:"A",start:1,stop:20},{name:"B",start:10,stop:15},{name:"C",start:10,stop:20},{name:"D",start:15,stop:30},{name:"E",
start:20,stop:30},{name:"F",start:20,stop:50},{name:"G",start:80,stop:100},{name:"H",start:90,stop:95},{name:"I",start:90,stop:5},{name:"J",start:95,stop:15},{name:"K",start:95,stop:2},{name:"L",start:92,stop:50}],{circularLength:100});a(b,10,20,"ABCDEFJL".split(""));a(b,40,85,["F","G","L"]);a(b,40,95,"FGHIJKL".split(""));a(b,95,10,"ABCGHIJKL".split(""));return b};Object.defineProperties(b.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this._length}}});d.NCList=b})(CGView);
(function(d){var b=function(a,b,f,g){b=void 0===b?{}:b;this.viewer=a;this.positions=b.positions;this.scores=b.scores;this.source=d.defaultFor(b.source,"");this._baseline=d.defaultFor(b.baseline,.5);b.legend&&(this.legendItem=b.legend);b.legendPositive&&(this.legendItemPositive=b.legendPositive);b.legendNegative&&(this.legendItemNegative=b.legendNegative);a=a.plots().indexOf(this)+1;this.legendItemPositive||this.legendItemNegative?this.legendItemPositive?this.legendItemNegative||(this.legendItemNegative=
this.legendItemPositive):this.legendItemPositive=this.legendItemNegative:this.legendItem="Plot-"+a};b.prototype.scoreForPosition=function(a){var b=d.indexOfValue(this.positions,a);return 0==b&&a<this.positions[b]?void 0:this.scores[b]};b.prototype.draw=function(a,b,d,g,e){this.colorNegative.rgbaString==this.colorPositive.rgbaString?this._drawPath(a,b,d,g,e,this.colorPositive):(this._drawPath(a,b,d,g,e,this.colorPositive,"positive"),this._drawPath(a,b,d,g,e,this.colorNegative,"negative"))};b.prototype._drawPath=
function(a,b,f,g,e,h,k){var l=this,m=a.context("map"),n=this.positions,p=this.scores,q=this.viewer.sequence.length,r=d.indexOfValue(n,e.start,!1),t=d.indexOfValue(n,e.stop,!1);0==t&&e.stop<n[t]&&(t=n.length-1);var x=0==r?n[r]:e.start;e=e.stop;var z=p[r],z=this._keepPoint(z,k)?z:this.baseline;m.beginPath();var u=b-f/2+f*this.baseline;b=a.pointFor(x,u);m.moveTo(b.x,b.y);var v=u+(z-this.baseline)*f,y=x,w,A;b=1;g&&(g=n.countFromRange(x,e)/4E3,1<g&&(b=d.base2(g)));n.eachFromRange(x,e,b,function(b){0==
b&&0!=r&&(a.arcPath("map",v,y,q,!1,"lineTo"),y=1,v=u);w=p[b];A=n[b];a.arcPath("map",v,y,A,!1,"lineTo");v=l._keepPoint(w,k)?u+(w-l.baseline)*f:u;y=A});t==n.length-1&&e<n[0]&&(e=q);a.arcPath("map",v,y,e,!1,"lineTo");t=a.pointFor(e,u);m.lineTo(t.x,t.y);a.arcPath("map",u,e,x,!0,"noMoveTo");m.fillStyle=h.rgbaString;m.fill()};b.prototype._keepPoint=function(a,b){return void 0==b||"positive"==b&&a>this.baseline||"negative"==b&&a<this.baseline?!0:!1};Object.defineProperties(b.prototype,{viewer:{configurable:!0,
enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._plots.push(this)}},positions:{configurable:!0,enumerable:!0,get:function(){return this._positions||new d.CGArray},set:function(a){a&&(this._positions=new d.CGArray(a))}},score:{configurable:!0,enumerable:!0,get:function(){return this._score||new d.CGArray},set:function(a){a&&(this._score=new d.CGArray(a))}},length:{configurable:!0,enumerable:!0,get:function(){return this.positions.length}},color:{configurable:!0,enumerable:!0,
get:function(){return[this.colorPositive,this.colorNegative]}},colorPositive:{configurable:!0,enumerable:!0,get:function(){return this.legendItemPositive.color}},colorNegative:{configurable:!0,enumerable:!0,get:function(){return this.legendItemNegative.color}},legendItem:{configurable:!0,enumerable:!0,get:function(){return[this.legendItemPositive,this.legendItemNegative]},set:function(a){this.legendItemNegative=this.legendItemPositive=a}},legend:{configurable:!0,enumerable:!0,get:function(){return this.legendItem},
set:function(a){this.legendItem=a}},legendItemPositive:{configurable:!0,enumerable:!0,get:function(){return this._legendItemPositive},set:function(a){this.legendItemPositive&&void 0==a||(this._legendItemPositive=a&&"LegendItem"==a.toString()?a:this.viewer.legend.findLegendItemOrCreate(a))}},legendItemNegative:{configurable:!0,enumerable:!0,get:function(){return this._legendItemNegative},set:function(a){this.legendItemNegative&&void 0==a||(this._legendItemNegative=a&&"LegendItem"==a.toString()?a:this.viewer.legend.findLegendItemOrCreate(a))}},
legendPositive:{configurable:!0,enumerable:!0,get:function(){return this._legendItemPositive},set:function(a){this._legendItemPositive=a}},legendNegative:{configurable:!0,enumerable:!0,get:function(){return this._legendItemNegative},set:function(a){this._legendItemNegative=a}},baseline:{configurable:!0,enumerable:!0,get:function(){return this._baseline},set:function(a){this._baseline=1<a?1:0>a?0:a}}});d.Plot=b})(CGView);
(function(d){var b=function(a,b,d,g){this.x=a;this.y=b;this.width=d;this.height=g};b.prototype.overlap=function(a){for(var b=d.pixel(4),f=!1,g=0,e=a.length;g<e;g++)if(f=a[g],this.x<=f.right&&f.x<=this.right+b&&this.y<=f.bottom&&f.y<=this.bottom){f=!0;break}else f=!1;return f};b.prototype.containsPt=function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height};Object.defineProperties(b.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=
a}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this._height=a}},x:{configurable:!0,enumerable:!0,get:function(){return this._x},set:function(a){this._x=a}},y:{configurable:!0,enumerable:!0,get:function(){return this._y},set:function(a){this._y=a}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}},top:{configurable:!0,enumerable:!0,get:function(){return this.y}},left:{configurable:!0,enumerable:!0,get:function(){return this.x}},
right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}}});d.Rect=b})(CGView);
(function(d){var b=function(a,b,f){b=void 0===b?{}:b;f=void 0===f?{}:f;d.CGObject.call(this,a,b,f);this.tickCount=d.defaultFor(b.tickCount,10);this.tickWidth=d.defaultFor(b.tickWidth,1);this.tickLength=d.defaultFor(b.tickLength,4);this.rulerPadding=d.defaultFor(b.rulerPadding,10);this.spacing=d.defaultFor(b.spacing,2);this.font=d.defaultFor(b.font,"sans-serif, plain, 10");this.color=new d.Color(d.defaultFor(b.color,"black"));this.lineCap="round"};$jscomp.inherits(b,d.CGObject);b.prototype._createTickFormatter=
function(a){var b;50>=a?b=d3.formatPrefix(",.0",1):5E4>=a?(a=d3.precisionPrefix(a,1E3),b=d3.formatPrefix("."+a,1E3)):5E7>=a&&(a=d3.precisionPrefix(a,1E6),b=d3.formatPrefix("."+a,1E6));return b};b.prototype._updateTicks=function(a,b){var f=this.sequence.length,g=0,e=0,h=new d.CGArray,k=0,l=new d.CGArray,m=0,l=this.tickCount;if(5>this.viewer.zoomFactor)g=1,e=f;else{var l=Math.ceil(l/2),m=this.canvas.visibleRangeForRadius(a),n=this.canvas.visibleRangeForRadius(b);m&&n?(e=m.mergeWithRange(n),g=e.start,
e=e.stop):m?(g=m.start,e=m.stop):n&&(g=n.start,e=n.stop)}if(e>g)h.merge(d3.ticks(g,e,l)),k=d3.tickStep(g,e,l);else if(e<g)if(m=(f-g)/this.sequence.lengthOfRange(g,e),k=Math.round(l*m),m=2*Math.round(l*(1-m)),0<k)for(h.merge(d3.ticks(g,f,k)),k=Math.round(d3.tickStep(g,f,k)),e=1;e<=m;e++)k*e<g&&h.push(k*e);else h.merge(d3.ticks(1,e,l)),k=Math.round(d3.tickStep(1,e,l));l=new d.CGArray;if(m=k%5?k%2?0:k/2:k/5){this.sequence.lengthOfRange(h[h.length-1],h[0])<=3*k?(g=0,e=f):(g=h[0]-k,e=h[h.length-1]+k);
if(!(g<e)){for(;g<=f;g+=m)g%k&&l.push(g);g=0}for(;g<=e;g+=m)g%k&&l.push(g)}this._majorTicks=h;this._majorTickStep=k;this._minorTicks=l;this._minorTickStep=m;this._tickFormater=this._createTickFormatter(k)};b.prototype.draw=function(a,b){this.visible&&(this._updateTicks(a,b),this.drawForRadius(a,"inner"),this.drawForRadius(b,"outer",!1))};b.prototype.drawForRadius=function(a,b,d){b=void 0===b?"inner":b;d=void 0===d?!0:d;var g=this,e=this.canvas.context("map"),h="inner"==b?-this.tickLength:this.tickLength;
e.fillStyle=this.color.rgbaString;e.font=this.font.css;e.textAlign="left";e.textBaseline="top";this.canvas.radiantLine("map",1,a,h,2*this.tickWidth,this.color.rgbaString,this.lineCap);this.majorTicks.each(function(e,l){g.canvas.radiantLine("map",l,a,h,g.tickWidth,g.color.rgbaString,g.lineCap);if(d){var m=g.tickFormater(l);g.drawLabel(l,m,a,b)}});this.minorTicks.each(function(b,c){g.canvas.radiantLine("map",c,a,h/2,g.tickWidth,g.color.rgbaString,g.lineCap)})};b.prototype.drawLabel=function(a,b,f,g){var e=
this.canvas.scale;g=this.canvas.context("map");b=b.replace(/([kM])?$/," $1bp");f=this.canvas.pointFor(a,f-this.rulerPadding);a=e.bp(a);a=d.clockPositionForAngle(a);e=this.font.width(g,b);f=d.rectOriginForAttachementPoint(f,a,e,this.font.height);g.fillText(b,f.x,f.y)};Object.defineProperties(b.prototype,{font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new d.Font(a)}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},
set:function(a){"Color"==a.toString()?this._color=a:this._color.setColor(a)}},tickCount:{configurable:!0,enumerable:!0,get:function(){return this._tickCount},set:function(a){this._tickCount=a}},tickWidth:{configurable:!0,enumerable:!0,get:function(){return this._tickWidth},set:function(a){this._tickWidth=d.pixel(a)}},tickLength:{configurable:!0,enumerable:!0,get:function(){return this._tickLength},set:function(a){this._tickLength=d.pixel(a)}},rulerPadding:{configurable:!0,enumerable:!0,get:function(){return this._rulerPadding},
set:function(a){this._rulerPadding=d.pixel(a)}},spacing:{configurable:!0,enumerable:!0,get:function(){return this._spacing},set:function(a){this._spacing=a}},majorTicks:{configurable:!0,enumerable:!0,get:function(){return this._majorTicks}},majorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._majorTickStep}},minorTicks:{configurable:!0,enumerable:!0,get:function(){return this._minorTicks}},minorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._minorTickStep}},
tickFormater:{configurable:!0,enumerable:!0,get:function(){return this._tickFormater}}});d.Ruler=b})(CGView);
(function(d){var b=function(a,b){b=void 0===b?{}:b;this._viewer=a;this.color=d.defaultFor(b.color,"black");this.font=d.defaultFor(b.font,"sans-serif, plain, 14");this.seq=b.seq;this.seq||(this.length=b.length);this.length||(this.length=1E3)};b.complement=function(a){for(var b="",d,g,e=0,h=a.length;e<h;e++){d=a.charAt(e);switch(d){case "A":g="T";break;case "T":g="A";break;case "G":g="C";break;case "C":g="G"}b+=g}return b};b.baseCalculation=function(a,c){if("gc_content"==a)return b.calcGCContent(c);
if("gc_skew"==a)return b.calcGCSkew(c)};b.calcGCContent=function(a){if(0==a.length)return.5;var b=d.Sequence.count(a,"g"),f=d.Sequence.count(a,"c");return(b+f)/a.length};b.calcGCSkew=function(a){var b=d.Sequence.count(a,"g");a=d.Sequence.count(a,"c");return 0==b+a?.5:.5+(b-a)/(b+a)/2};b.reverseComplement=function(a){return b.complement(a.split("").reverse().join(""))};b.count=function(a,b){return(a.match(new RegExp(b,"gi"))||[]).length};b.random=function(a){for(var b="",d,g=0;g<a;g++)switch(d=Math.floor(4*
Math.random()),d%4){case 0:b+="A";break;case 1:b+="T";break;case 2:b+="G";break;case 3:b+="C"}return b};b.prototype.reverseComplement=function(){return b.reverseComplement(this.seq)};b.prototype.count=function(a){return b.count(this.seq,a)};b.prototype._updateScale=function(){this.canvas.scale.bp=d3.scaleLinear().domain([1,this.length]).range([-.5*Math.PI,1.5*Math.PI]);this.viewer._updateZoomMax()};b.prototype.lengthOfRange=function(a,b){return b>=a?b-a:this.length+(b-a)};b.prototype.subtractBp=function(a,
b){return b<a?a-b:this.length+a-b};b.prototype.addBp=function(a,b){return this.length>=b+a?b+a:a-this.length+b};b.prototype.forRange=function(a){return this.seq?a.spansOrigin()?this.seq.substr(a.start-1)+this.seq.substr(0,a.stop):this.seq.substr(a.start-1,a.length):this._fakeSequenceForRange(a)};b.prototype._fakeSequenceForRange=function(a){var b="",d=a.start,g=0;for(a=a.length;g<a;g++){switch(d%4){case 0:b+="A";break;case 1:b+="T";break;case 2:b+="G";break;case 3:b+="C"}d++}return b};b.prototype._drawSequence=
function(){var a=this.canvas.context("map"),b=d.pixel(this.zoomedRadius),f=this.visibleRange;if(f){var g=this._sequenceForRange(f),e=f.start;a.save();a.fillStyle=this.fontColor.rgbaString;a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var h=this.bpSpacing/2+this.bpMargin,k=0,f=f.length;k<f;k++){var l=this.canvas.pointFor(e,b+h);a.fillText(g[k],l.x,l.y);l=this.canvas.pointFor(e,b-h);a.fillText(g[k],l.x,l.y);e++}a.restore()}};b.prototype.findPattern=function(a,b){b=void 0===b?
1:b;for(var f=new RegExp(a,"g"),g=[],e,h,k=1==b?this.seq:this.reverseComplement();null!=(e=f.exec(k));)h=1==b?e.index+1:this.length-e.index-e[0].length+1,g.push(new d.CGRange(this,h,h+e[0].length-1)),f.lastIndex=e.index+1;return g};b.prototype.featuresByReadingFrame=function(a){var b=this,f={rf_plus_1:new d.CGArray,rf_plus_2:new d.CGArray,rf_plus_3:new d.CGArray,rf_minus_1:new d.CGArray,rf_minus_2:new d.CGArray,rf_minus_3:new d.CGArray},g;a.each(function(a,d){-1==d.strand?(g=(b.length-d.stop+1)%3,
0==g&&(g=3),f["rf_minus_"+g].push(d)):(g=d.start%3,0==g&&(g=3),f["rf_plus_"+g].push(d))});return f};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},seq:{configurable:!0,enumerable:!0,get:function(){return this._seq},set:function(a){(this._seq=a)?(this._seq=this._seq.toUpperCase(),this._length=a.length,this._updateScale(),this._sequenceExtractor=new d.SequenceExtractor(this)):
this._sequenceExtractor=void 0}},sequenceExtractor:{configurable:!0,enumerable:!0,get:function(){return this._sequenceExtractor}},length:{configurable:!0,enumerable:!0,get:function(){return this._length},set:function(a){a&&(this.seq?console.error("Can not change the sequence length of *seq* is set."):(this._length=Number(a),this._updateScale()))}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new d.Color(a)}},font:{configurable:!0,
enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new d.Font(a);this.bpSpacing=this.font.size}},isLinear:{configurable:!0,enumerable:!0,get:function(){return!1}},isCircular:{configurable:!0,enumerable:!0,get:function(){return!0}}});d.Sequence=b})(CGView);
(function(d){var b=function(a,b){this.sequence=a;if(!a.seq)throw"Sequence invalid. The sequence must be provided.";};b.prototype.fn2workerURL=function(a){a=new Blob(["("+a.toString()+")()"],{type:"application/javascript"});return URL.createObjectURL(a)};b.prototype.extractTrackData=function(a,b,f){f=void 0===f?{}:f;if(d.validate(b,["start_stop_codons","orfs","gc_skew","gc_content"]))switch(b){case "start_stop_codons":case "orfs":a.contents.type="feature";this.generateFeatures(a,b,f);break;case "gc_skew":case "gc_content":a.contents.type=
"plot",this.generatePlot(a,b,f)}};b.prototype.generateFeatures=function(a,b,f){f=void 0===f?{}:f;var g=this;if(d.validate(b,["start_stop_codons","orfs"])){var e=(new Date).getTime(),h=this.viewer,k=this.fn2workerURL(d.WorkerFeatureExtraction),k=new Worker(k);f={type:b,startPattern:d.defaultFor(f.start,"ATG"),stopPattern:d.defaultFor(f.stop,"TAA,TAG,TGA"),seqString:this.seqString,minORFLength:d.defaultFor(f.minORFLength,100)};k.postMessage(f);k.onmessage=function(f){var k=f.data.messageType;"progress"==
k&&(a.loadProgress=f.data.progress,h.layout.drawProgress());if("complete"==k){a.loadProgress=100;f=f.data.featureDataArray;console.log("Features '"+b+"' Worker Time: "+d.elapsed_time(e));k=new d.CGArray;e=(new Date).getTime();var n,p=g.createLegendItems(b);g.getFeatureType(b);console.log(b);for(var q=0,r=f.length;q<r;q++)n=f[q],n.legend=p[n.type],k.push(new d.Feature(h,n));console.log("Features '"+b+"' Creation Time: "+d.elapsed_time(e));e=(new Date).getTime();a._features=k;a.updateSlots();console.log("Features '"+
b+"' Update Time: "+d.elapsed_time(e));h.drawFull()}};k.onerror=function(a){}}};b.prototype.generatePlot=function(a,b,f){f=void 0===f?{}:f;var g=this;if(d.validate(b,["gc_content","gc_skew"])){var e=(new Date).getTime(),h=this.viewer,k=this.fn2workerURL(d.WorkerBaseContent),k=new Worker(k);f={type:b,window:d.defaultFor(f.window,this.getWindowStep().window),step:d.defaultFor(f.step,this.getWindowStep().step),deviation:d.defaultFor(f.deviation,"scale"),seqString:this.seqString};k.postMessage(f);k.onmessage=
function(f){var k=f.data.messageType;"progress"==k&&(a.loadProgress=f.data.progress,h.layout.drawProgress());"complete"==k&&(f=f.data.baseContent,f={positions:f.positions,scores:f.scores,baseline:f.average},f.legendPositive=g.getLegendItem(b,"+").text,f.legendNegative=g.getLegendItem(b,"-").text,f=new d.Plot(h,f),a._plot=f,a.updateSlots(),console.log("Plot '"+b+"' Worker Time: "+d.elapsed_time(e)),h.drawFull())};k.onerror=function(a){}}};b.prototype.getFeatureType=function(a){var b=this.viewer;switch(a){case "start_stop_codons":a=
b.findFeatureTypeOrCreate("Codon","arc");break;case "orfs":a=b.findFeatureTypeOrCreate("ORF","arrow");break;default:a=b.findFeatureTypeOrCreate("Unknown","arc")}return a};b.prototype.createLegendItems=function(a){var b={};"orfs"==a?b={ORF:this.getLegendItem("ORF")}:"start_stop_codons"==a&&(b={"start-codon":this.getLegendItem("start-codon"),"stop-codon":this.getLegendItem("stop-codon")});return b};b.prototype.getLegendItem=function(a,b){var d=this.viewer.legend;switch(a){case "start-codon":d=d.findLegendItemOrCreate("Start",
"blue");break;case "stop-codon":d=d.findLegendItemOrCreate("Stop","red");break;case "ORF":d=d.findLegendItemOrCreate("ORF","green");break;case "gc_content":d=d.findLegendItemOrCreate("GC Content","black");break;case "gc_skew":d=d.findLegendItemOrCreate("+"==b?"GC Skew+":"GC Skew-","+"==b?"rgb(0,153,0)":"rgb(153,0,153)");break;default:d=d.findLegendItemOrCreate("Unknown","grey")}return d};b.prototype.getWindowStep=function(){var a,b,d=this.length;1E3>d?(a=10,b=1):1E4>d?(a=50,b=1):1E5>d?(a=500,b=1):
1E6>d?(a=1E3,b=10):1E7>d&&(a=1E4,b=100);return{step:b,window:a}};Object.defineProperties(b.prototype,{sequence:{configurable:!0,enumerable:!0,get:function(){return this._sequence},set:function(a){a&&(this._sequence=a)}},seqString:{configurable:!0,enumerable:!0,get:function(){return this.sequence.seq}},viewer:{configurable:!0,enumerable:!0,get:function(){return this.sequence.viewer}},length:{configurable:!0,enumerable:!0,get:function(){return this.sequence.length}}});d.SequenceExtractor=b})(CGView);
(function(d){var b=function(a,b,f){b=void 0===b?{}:b;this.viewer=a;this._backgroundColor=new d.Color(d.defaultFor(b.backgroundColor,"white"));this.arrowHeadLength=d.defaultFor(b.arrowHeadLength,.3);this._showShading=d.defaultFor(b.showShading,!0)};Object.defineProperties(b.prototype,{backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==a?new d.Color("white"):"Color"==a.toString()?a:new d.Color(a);this.viewer.fillBackground()}},
arrowHeadLength:{configurable:!0,enumerable:!0,set:function(a){a&&(this._arrowHeadLength=d.constrain(a,0,1))},get:function(){return this._arrowHeadLength}},showShading:{configurable:!0,enumerable:!0,get:function(){return this._showShading},set:function(a){this._showShading=a;this.viewer.drawFull()}}});d.Settings=b})(CGView);
(function(d){var b=function(a,b,f){b=void 0===b?{}:b;f=void 0===f?{}:f;d.CGObject.call(this,a.viewer,b,f);this.track=a;this._strand=d.defaultFor(b.strand,"direct");this._features=new d.CGArray;this._plot;this.proportionOfRadius=d.defaultFor(b.proportionOfRadius,.1);this.refresh()};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Slot"};b.prototype.isDirect=function(){return"direct"==this.strand};b.prototype.isReverse=function(){return"reverse"==this.strand};b.prototype.features=
function(a){return this._features.get(a)};b.prototype.replaceFeatures=function(a){this._features=a;this.refresh()};b.prototype.pixelsPerBp=function(){return 2*this.radius*Math.PI/this.sequence.length};b.prototype.refresh=function(){this._featureNCList=new d.NCList(this._features,{circularLength:this.sequence.length})};b.prototype.containsRadius=function(a){var b=this.thickness/2;return a>=this.radius-b&&a<=this.radius+b};b.prototype.findFeaturesForBp=function(a){return this._featureNCList.find(a)};
b.prototype.findLargestFeatureLength=function(){for(var a=0,b,d=0,g=this._features.length;d<g;d++)b=this._features[d].length,b>a&&(a=b);return a};b.prototype.clear=function(){var a=this._visibleRange;if(a){var b=this.radius,d=this.thickness,g=this.canvas.context("map");g.globalCompositeOperation="destination-out";this.canvas.drawArc("map",a.start,a.stop,b,"white",d);g.globalCompositeOperation="source-over"}};b.prototype.highlight=function(a){var b=this._visibleRange;b&&this.visible&&this.canvas.drawArc("background",
b.start,b.stop,this.radius,void 0===a?"#FFB":a,this.thickness)};b.prototype.draw=function(a,b){var f=this.radius,g=this.thickness,e=a.visibleRangeForRadius(f,g);if(this._visibleRange=e){var h=e.start,k=e.stop;if(this.hasFeatures){var l=this._features.length;e.isFullCircle()||(l=this._featureNCList.count(h,k));var m=1;b&&l>this.layout.fastFeaturesPerSlot&&(m=d.base2(Math.ceil(l/this.layout.fastFeaturesPerSlot)));this.viewer.settings.showShading&&this.isDirect()&&(m*=-1);this._featureNCList.run(h,k,
m,function(a){a.draw("map",f,g,e)});this.viewer.debug&&this.viewer.debug.data.n&&(h=this.viewer._slots.indexOf(this),this.viewer.debug.data.n["slot_"+h]=l)}else this.hasPlot&&this._plot.draw(a,f,g,b,e)}};b.prototype.drawProgress=function(a){var b=this.canvas,d=this.radius,g=this.thickness,e=this._visibleRange;0<a&&100>a&&e&&b.drawArc("background",e.start,e.stop,d,"#EAEAEE",g*a/100)};b.prototype.removeFeature=function(a){this._features=this._features.remove(a);this.refresh()};Object.defineProperties(b.prototype,
{track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(a){this._track=a;a._slots.push(this)}},type:{configurable:!0,enumerable:!0,get:function(){return this.track.type}},layout:{configurable:!0,enumerable:!0,get:function(){return this.track.layout}},position:{configurable:!0,enumerable:!0,get:function(){return"both"==this.track.position?this.isDirect()?"outside":"inside":this.track.position}},inside:{configurable:!0,enumerable:!0,get:function(){return"inside"==this.position}},
outside:{configurable:!0,enumerable:!0,get:function(){return"outside"==this.position}},proportionOfRadius:{configurable:!0,enumerable:!0,get:function(){return this._proportionOfRadius},set:function(a){this._proportionOfRadius=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._radius}},thickness:{configurable:!0,enumerable:!0,get:function(){return this._thickness}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand}},hasFeatures:{configurable:!0,enumerable:!0,
get:function(){return 0<this._features.length}},hasPlot:{configurable:!0,enumerable:!0,get:function(){return this._plot}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}}});d.Slot=b})(CGView);
(function(d){var b=function(a,b,f){b=void 0===b?{}:b;f=void 0===f?{}:f;d.CGObject.call(this,a.viewer,b,f);this.layout=a;this._plot;this._features=new d.CGArray;this._slots=new d.CGArray;this.name=d.defaultFor(b.name,"Unknown");this.readingFrame=d.defaultFor(b.readingFrame,"combined");this.strand=d.defaultFor(b.strand,"separated");this.position=d.defaultFor(b.position,"both");this.contents=b.contents||{};this.loadProgress=0;this.refresh()};$jscomp.inherits(b,d.CGObject);b.prototype.toString=function(){return"Track"};
b.prototype.features=function(a){return this._features.get(a)};b.prototype.slots=function(a){return this._slots.get(a)};b.prototype.removeFeature=function(a){this._features=this._features.remove(a);this.slots().each(function(b,d){d.removeFeature(a)});this.viewer.trigger("track-update",this)};b.prototype.refresh=function(){this._features=new d.CGArray;this._plot=void 0;"sequence"==this.contents.from?this.extractFromSequence():"feature"==this.type?this.updateFeatures():"plot"==this.type&&this.updatePlot();
this.updateSlots()};b.prototype.extractFromSequence=function(){var a=this.viewer.sequence.sequenceExtractor;a?a.extractTrackData(this,this.contents.extract,this.contents.options):console.error("No sequence is available to extract features/plots from")};b.prototype.updateFeatures=function(){if("source"==this.contents.from){var a=this;this.viewer.features().each(function(b,c){c.source==a.contents.extract&&a._features.push(c)})}else if(this.contents.types){var b=this,f=new d.CGArray(this.contents.featureType);
this.viewer.features().each(function(a,d){f.contains(d.type)&&b._features.push(d)})}};b.prototype.updatePlot=function(){if("source"==this.contents.from){var a=this;this.viewer.plots().find(function(b){b.source==a.contents.extract&&(a._plot=b)})}};b.prototype.updateSlots=function(){"feature"==this.type?this.updateFeatureSlots():"plot"==this.type&&this.updatePlotSlot();this.layout._adjustProportions();this.viewer.trigger("track-update",this)};b.prototype.updateFeatureSlots=function(){this._slots=new d.CGArray;
if("separated"==this.readingFrame){for(var a=this.sequence.featuresByReadingFrame(this.features()),b=$jscomp.makeIterator([1,2,3]),f=b.next();!f.done;f=b.next()){var f=f.value,g=new d.Slot(this,{strand:"direct"});g.replaceFeatures(a["rf_plus_"+f])}b=$jscomp.makeIterator([1,2,3]);for(f=b.next();!f.done;f=b.next())f=f.value,g=new d.Slot(this,{strand:"reverse"}),g.replaceFeatures(a["rf_minus_"+f])}else"separated"==this.strand?(a=this.featuresByStrand(),g=new d.Slot(this,{strand:"direct"}),g.replaceFeatures(a.direct),
g=new d.Slot(this,{strand:"reverse"}),g.replaceFeatures(a.reverse)):"combined"==this.strand&&(g=new d.Slot(this,{strand:"direct"}),g.replaceFeatures(this.features()))};b.prototype.featuresByStrand=function(){var a={};a.direct=new d.CGArray;a.reverse=new d.CGArray;this.features().each(function(b,d){-1==d.strand?a.reverse.push(d):a.direct.push(d)});return a};b.prototype.updatePlotSlot=function(){this._slots=new d.CGArray;(new d.Slot(this,{type:"plot"}))._plot=this._plot};b.prototype.highlight=function(a){a=
void 0===a?"#FFB":a;this.visible&&this.slots().each(function(b,d){d.highlight(a)})};b.prototype.remove=function(){this.layout.removeTrack(this)};Object.defineProperties(b.prototype,{visible:{configurable:!0,enumerable:!0,set:function(a){this._visible=a;this.layout&&this.layout._adjustProportions()},get:function(){return this._visible}},id:{configurable:!0,enumerable:!0,get:function(){return this.name}},name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){this._name=
a}},layout:{configurable:!0,enumerable:!0,get:function(){return this._layout},set:function(a){this._layout=a;a._tracks.push(this)}},contents:{configurable:!0,enumerable:!0,get:function(){return this._contents},set:function(a){this._contents=a}},type:{configurable:!0,enumerable:!0,get:function(){return this.contents&&this.contents.type}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand},set:function(a){d.validate(a,["separated","combined"])&&(this._strand=a,this.updateSlots())}},
readingFrame:{configurable:!0,enumerable:!0,get:function(){return this._readingFrame},set:function(a){d.validate(a,["separated","combined"])&&(this._readingFrame=a,this.updateSlots())}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){d.validate(a,["inside","outside","both"])&&(this._position=a,this.updateSlots())}},plot:{configurable:!0,enumerable:!0,get:function(){return this._plot}},loadProgress:{configurable:!0,enumerable:!0,get:function(){return this._loadProgress},
set:function(a){this._loadProgress=a}},count:{configurable:!0,enumerable:!0,get:function(){if("plot"==this.type)return this.plot?this.plot.length:0;if("feature"==this.type)return this.features().length}}});d.Track=b})(CGView);
(function(d){d.testSearch=function(b){var a=/ATG/igm,c=[],f="";console.log("Making Sequence...");for(var g=0;g<b;g++)f+="ATCG".charAt(Math.floor(4*Math.random()));window.seq=f;console.log("Finding Pattern...");for(b=(new Date).getTime();match=a.exec(f);)c.push(match.index);console.log("ATGs found: "+c.length);console.log("Time: "+d.elapsed_time(b))};d.defaultFor=function(b,a){return void 0===b?a:b};d.validate=function(b,a){if(-1!=a.indexOf(b))return!0;console.error("The value '"+b+"' is not one of the following: "+
a.join(", "));return!1};d.booleanify=function(b){return"false"==b||"False"==b||void 0==b||0==b?!1:!0};d.pixelRatio=1;d.pixel=function(b){return b*d.pixelRatio};d.getPixelRatio=function(b){b=b.getContext("2d");return(window.devicePixelRatio||1)/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1)};d.scaleResolution=function(b,a){if(1!=a){var c=b.width,d=b.height;b.width=c*a;b.height=d*a;b.style.width=c+"px";
b.style.height=d+"px"}};d.elapsed_time=function(b){return(new Date).getTime()-b+" ms"};d.angleFromPosition=function(b,a){var c=.5*Math.PI;0!=b&&(c=Math.atan(Math.abs(a/b)));0<=a&&0<=b?c=0-c:0>a&&0<=b||(0>a&&0>b?c=Math.PI-c:0<=a&&0>b&&(c=Math.PI+c));return c};d.clockPositionForAngle=function(b){b=Math.round(6/Math.PI*(b+Math.PI/2));12<b?b-=12:1>b&&(b+=12);return b};d.rectOriginForAttachementPoint=function(b,a,c,d){var g,e;switch(a){case 1:g=b.x-3*c/4;e=b.y;break;case 2:g=b.x-c;e=b.y;break;case 3:g=
b.x-c;e=b.y-d/2;break;case 4:g=b.x-c;e=b.y-d;break;case 5:g=b.x-3*c/4;e=b.y-d;break;case 6:g=b.x-c/2;e=b.y-d;break;case 7:g=b.x-c/4;e=b.y-d;break;case 8:g=b.x;e=b.y-d;break;case 9:g=b.x;e=b.y-d/2;break;case 10:g=b.x;e=b.y;break;case 11:g=b.x-c/4;e=b.y;break;case 12:g=b.x-c/2,e=b.y}return{x:g,y:e}};d.round=function(b,a){return Number(b.toFixed(a||2))};d.dotProduct=function(b,a){for(var c=0,d=0,g=b.length;d<g;d++)c+=b[d]*a[d];return c};d.pointsAdd=function(b,a){var c=[0,0];c[0]=b[0]+a[0];c[1]=b[1]+
a[1];return c};d.pointsSubtract=function(b,a){var c=[0,0];c[0]=b[0]-a[0];c[1]=b[1]-a[1];return c};d.circleAnglesFromIntersectingLine=function(b,a,c,f,g){var e=d.pointsSubtract([f,g],[a,c]),h=[a,c],k=d.dotProduct(e,e),e=2*d.dotProduct(h,e);b=d.dotProduct(h,h)-b*b;var l=e*e-4*k*b;b={};0<=l&&(l=Math.sqrt(l),h=(-e-l)/(2*k),k=(-e+l)/(2*k),0<=h&&1>=h&&(b.t1=d.angleFromPosition(a+h*(f-a),c+h*(g-c))),0<=k&&1>=k&&(b.t2=d.angleFromPosition(a+k*(f-a),c+k*(g-c))));return b};d.circleAnglesFromIntersectingRect=
function(b,a,c,f,g){var e=[];e.push(d.circleAnglesFromIntersectingLine(b,a,c,a+f,c));e.push(d.circleAnglesFromIntersectingLine(b,a+f,c,a+f,c-g));e.push(d.circleAnglesFromIntersectingLine(b,a+f,c-g,a,c-g));e.push(d.circleAnglesFromIntersectingLine(b,a,c-g,a,c));e=e.filter(function(a){return 0<Object.keys(a).length});0<e.length&&(b=Object.keys(e[0]),1==b.length&&"t1"==b[0]&&e.push(e.shift()),2==b.length&&(e.push({t1:e[0].t1}),e[0].t1=void 0),e=e.map(function(a){var b=[];void 0!=a.t1&&b.push(a.t1);void 0!=
a.t2&&b.push(a.t2);return b}),e=[].concat.apply([],e));return e};d.indexOfValue=function(b,a,c){var d=0,g=b.length-1,e,h;if(b[d]>=a)return d;if(b[g]<=a)return g;for(;1<g-d;)if(e=(d+g)/2|0,h=b[e],h<a)d=e;else if(h>a)g=e;else return e;return c?g:d};d.oppositeSigns=function(b,a){return 0>b*a};d.base2=function(b){return Math.pow(2,Math.ceil(Math.log(b)/Math.log(2)))};d.constrain=function(b,a,c){return Math.max(Math.min(c,b),a)};d.merge=function(){for(var b={},a,c,d,g=0,e=arguments.length;g<e;g++)if(a=
arguments[g],"object"===typeof a){c=Object.keys(a);for(var h=0,k=c.length;h<k;h++)d=c[h],b[d]=a[d]}return b};d.scaleValue=function(b,a,c){a=void 0===a?{min:0,max:1}:a;c=void 0===c?{min:0,max:1}:c;return(c.max-c.min)*(b-a.min)/(a.max-a.min)+c.min}})(CGView);
(function(d){d.Viewer.prototype.initializeDragging=function(){var b=this;b._drag=d3.drag().on("start",function(){d3.select(b.canvas.node("ui")).style("cursor","all-scroll")}).on("drag",function(){var a=(new Date).getTime();domain_x=b.scale.x.domain();domain_y=b.scale.y.domain();var c=d.pixel(d3.event.dx),f=d.pixel(d3.event.dy);b.scale.x.domain([domain_x[0]-c,domain_x[1]-c]);b.scale.y.domain([domain_y[0]+f,domain_y[1]+f]);b.drawFast();b.debug&&(b.debug.data.time.drag=d.elapsed_time(a))}).on("end",
function(){b.drawFull()});d3.select(b.canvas.node("ui")).call(b._drag)}})(CGView);
(function(d){d.Viewer.prototype._updateZoomMax=function(){this._zoom&&this._zoom.scaleExtent([.8,this.backbone.maxZoomFactor()])};d.Viewer.prototype.initializeZooming=function(){var b=this,a=this.backbone.maxZoomFactor();b._zoom=d3.zoom().scaleExtent([1,a]).on("start",function(){}).on("zoom",function(){var a=(new Date).getTime(),f=d3.mouse(b.canvas.node("ui")),g=b.scale.x.invert(d.pixel(f[0])),e=b.scale.y.invert(d.pixel(f[1])),f=b.backbone.zoomedRadius,e=d.angleFromPosition(g,e);b._zoomFactor=d3.event.transform.k;
var f=f-b.backbone.zoomedRadius,g=d.pixel(Math.cos(-e)*f),f=d.pixel(Math.sin(-e)*f),e=b.scale.x.domain(),h=b.scale.y.domain();b.scale.x.domain([e[0]-g,e[1]-g]);b.scale.y.domain([h[0]-f,h[1]-f]);b.drawFast();b.debug&&(b.debug.data.time&&(b.debug.data.time.zoom=d.elapsed_time(a)),b.debug.data.zoom&&(b.debug.data.zoom.scale=d.round(b._zoomFactor,1)))}).on("end",function(){b.drawFull()});d3.select(b.canvas.node("ui")).call(b._zoom).on("dblclick.zoom",null)}})(CGView);
(function(d){d.WorkerFeatureExtraction=function(){onmessage=function(b){var a,c=b.data.type;console.log("Starting "+c);var d=[];"start_stop_codons"==c?(a={start:0,stop:50},d=extractStartStopCodons(1,b.data,a),a={start:50,stop:100},d=d.concat(extractStartStopCodons(-1,b.data,a))):"orfs"==c&&(d=extractORFs(b.data));d.sort(function(a,b){return a.start-b.start});postMessage({messageType:"complete",featureDataArray:d});console.log("Done "+c)};onerror=function(b){console.error("Oops. Problem with "+b.data.type)};
extractStartStopCodons=function(b,a,c){c=void 0===c?{}:c;var d=0,g=0,e=1==b?a.seqString:reverseComplement(a.seqString),h=a.startPattern.toUpperCase().split(",").map(function(a){return a.trim()}).join("|");a=a.stopPattern.toUpperCase().split(",").map(function(a){return a.trim()}).join("|");var k=h+"|"+a,h=h.split("|");a=a.split("|");for(var k=new RegExp(k,"g"),l,m,n,p=e.length,q=[];null!=(l=k.exec(e));)d=1==b?l.index+1:p-l.index-l[0].length+1,0<=h.indexOf(l[0])?n="start-codon":0<=a.indexOf(l[0])&&
(n="stop-codon"),m={type:n,start:d,stop:d+l[0].length-1,strand:b,source:"start-stop-codons",extractedFromSequence:!0},q.push(m),d=Math.round(1==b?d/p*100:(p-d)/p*100),g=postProgress(d,g,c),k.lastIndex=l.index+1;return q};postProgress=function(b,a,c){c=void 0===c?{}:c;var d=c.start||0,g=c.increment||1;c=(c.stop||100)-d;b>a&&0==b%g&&(a=b,b=d+c*b/100,0==b%g&&postMessage({messageType:"progress",progress:b}));return a};extractORFs=function(b){var a=b.minORFLength,c=b.seqString.length,d=[],g={start:0,stop:25},
d=extractStartStopCodons(1,b,g),g={start:25,stop:50},d=d.concat(extractStartStopCodons(-1,b,g)),g=d.filter(function(a){return"start-codon"==a.type}),d=d.filter(function(a){return"stop-codon"==a.type});b=featuresByReadingFrame(g,c);var e=featuresByReadingFrame(d,c),g={start:50,stop:75},d=orfsByStrand(1,b,e,a,c,g),g={start:75,stop:100};return d=d.concat(orfsByStrand(-1,b,e,a,c,g))};orfsByStrand=function(b,a,c,d,g,e){e=void 0===e?{}:e;var h,k,l,m,n,p,q,r,t,x=[],z=1==b?["rf_plus_1","rf_plus_2","rf_plus_3"]:
["rf_minus_1","rf_minus_2","rf_minus_3"];z.forEach(function(u){h=1==b?1:g;q=0;l=a[u];m=c[u];progressInitial=33*z.indexOf(u);t=r=0;-1==b&&(l.sort(function(a,b){return b.start-a.start}),m.sort(function(a,b){return b.start-a.start}));for(var v=0,y=l.length;v<y;v++)if(n=l[v],r=progressInitial+Math.round(v/y*33),t=postProgress(r,t,e),!(1==b&&n.start<h||-1==b&&n.start>h))for(var w=q,A=c[u].length;w<A;w++)if(p=m[w],k=1==b?p.stop-n.start:n.stop-p.start,k>=d){h=1==b?p.stop:p.start;featureData={type:"ORF",
start:1==b?n.start:p.start,stop:1==b?p.stop:n.stop,strand:b,source:"orfs",extractedFromSequence:!0};x.push(featureData);q=w;break}else if(0<k){h=1==b?p.stop:p.start;q=w;break}});return x};reverseComplement=function(b){return complement(b.split("").reverse().join(""))};complement=function(b){for(var a="",c,d,g=0,e=b.length;g<e;g++){c=b.charAt(g);switch(c){case "A":d="T";break;case "T":d="A";break;case "G":d="C";break;case "C":d="G"}a+=d}return a};featuresByReadingFrame=function(b,a){for(var c={rf_plus_1:[],
rf_plus_2:[],rf_plus_3:[],rf_minus_1:[],rf_minus_2:[],rf_minus_3:[]},d,g,e=0,h=b.length;e<h;e++)g=b[e],-1==g.strand?(d=(a-g.stop+1)%3,0==d&&(d=3),c["rf_minus_"+d].push(g)):(d=g.start%3,0==d&&(d=3),c["rf_plus_"+d].push(g));return c}}})(CGView);
(function(d){d.WorkerBaseContent=function(){onmessage=function(b){console.log("Starting "+b.data.type);calculateBaseContent(b.data);console.log("Done "+b.data.type)};onerror=function(b){console.error("Oops. Problem with "+b.data.type)};calculateBaseContent=function(b){var a=0,c=0,d=[],g=[],e=b.type,h=b.seqString,k=b.window,l=b.step;b=b.deviation;for(var m=baseCalculation(e,h),n=1,p=0,k=k/2,q,r=1,t=h.length;r<t;r+=l)a=subtractBp(h,r,k),q=addBp(h,r,k),a=subSequence(h,a,q),a=baseCalculation(e,a),a>p&&
(p=a),a<n&&(n=a),1==r?d.push(1):d.push(r-l/2),g.push(a),a=Math.round(r/t*100),a>c&&0==a%1&&(c=a,postMessage({messageType:"progress",progress:a}));"scale"==b&&(g=g.map(function(a){return a>=m?scaleValue(a,{min:m,max:p},{min:.5,max:1}):scaleValue(a,{min:n,max:m},{min:0,max:.5})}),n=0,p=1,m=.5);postMessage({messageType:"complete",baseContent:{positions:d,scores:g,min:n,max:p,average:m}})};baseCalculation=function(b,a){if("gc_content"==b)return calcGCContent(a);if("gc_skew"==b)return calcGCSkew(a)};calcGCContent=
function(b){if(0==b.length)return.5;var a=count(b,"g"),c=count(b,"c");return(a+c)/b.length};calcGCSkew=function(b){var a=count(b,"g");b=count(b,"c");return 0==a+b?.5:.5+(a-b)/(a+b)/2};count=function(b,a){return(b.match(new RegExp(a,"gi"))||[]).length};subtractBp=function(b,a,c){return c<a?a-c:b.length+a-c};addBp=function(b,a,c){return b.length>=c+a?c+a:a-b.length+c};subSequence=function(b,a,c){return c<a?b.substr(a-1)+b.substr(0,c):b.substr(a-1,c-a)};scaleValue=function(b,a,c){a=void 0===a?{min:0,
max:1}:a;c=void 0===c?{min:0,max:1}:c;return(c.max-c.min)*(b-a.min)/(a.max-a.min)+c.min}}})(CGView);
