var $jscomp={scope:{},global:this},Symbol;$jscomp.initSymbol=function(){$jscomp.global.Symbol||(Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return"jscomp_symbol_"+c+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();Symbol.iterator||(Symbol.iterator=Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();if(c[Symbol.iterator])return c[Symbol.iterator]();if(!(c instanceof Array||"string"==typeof c||c instanceof String))throw new TypeError(c+" is not iterable");var b=0;return{next:function(){return b==c.length?{done:!0}:{done:!1,value:c[b++]}}}};$jscomp.arrayFromIterator=function(c){for(var b,a=[];!(b=c.next()).done;)a.push(b.value);return a};$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};
$jscomp.arrayFromArguments=function(c){for(var b=[],a=0;a<c.length;a++)b.push(c[a]);return b};$jscomp.inherits=function(c,b){function a(){}a.prototype=b.prototype;c.prototype=new a;c.prototype.constructor=c;for(var d in b)if($jscomp.global.Object.defineProperties){var k=$jscomp.global.Object.getOwnPropertyDescriptor(b,d);void 0!==k&&$jscomp.global.Object.defineProperty(c,d,k)}else c[d]=b[d]};var CGView={version:"0.1"};void 0===window.CGV&&(window.CGV=CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this.containerId=a.replace("#","");this._container=d3.select(a);this._width=c.defaultFor(d.width,600);this._height=c.defaultFor(d.height,600);this._wrapper=this._container.append("div").attr("class","cgv-wrapper").style("position","relative").style("width",this.width+"px").style("height",this.height+"px");this.canvas=new c.Canvas(this,this._wrapper,{width:this.width,height:this.height});this.slotSpacing=c.defaultFor(d.slotSpacing,1);this.globalLabel=
c.defaultFor(d.globalLabel,!0);this.backgroundColor=d.backgroundColor;this._zoomFactor=1;this.debug=c.defaultFor(d.debug,!1);this._io=new c.IO(this);this._features=new c.CGArray;this._plots=new c.CGArray;this._captions=new c.CGArray;this._featureTypes=new c.CGArray;this.messenger=new c.Messenger(this,d.messenger);this.legend=new c.Legend(this,d.legend);this.sequence=new c.Sequence(this,d.sequence);this.backbone=new c.Backbone(this,d.backbone);this.slotDivider=new c.Divider(this,d.dividers&&d.dividers.slot);
this.layout=new c.Layout(this,d.layout);this.menu=new c.Menu(this);this.help=new c.Help(this);this.labelSet=new c.LabelSet(this,d.labelSet);this.ruler=new c.Ruler(this,d.ruler);this.initialize_dragging();this.initialize_zooming();this.eventMonitor=new c.EventMonitor(this)};b.prototype.resize=function(a,d,k,b){this._width=a||this.width;this._height=d||this.height;this._wrapper.style("width",this.width+"px").style("height",this.height+"px");this.canvas.resize(this.width,this.height);this.refreshCaptions();
this.legend.refresh();this.layout._adjustProportions();this.draw(b)};b.prototype.slots=function(a){return this.layout.slots(a)};b.prototype.features=function(a){return this._features.get(a)};b.prototype.tracks=function(a){return this.layout.tracks(a)};b.prototype.plots=function(a){return this._plots.get(a)};b.prototype.captions=function(a){return this._captions.get(a)};b.prototype.featureTypes=function(a){return this._featureTypes.get(a)};b.prototype.clear=function(a){this.canvas.clear(void 0===a?
"map":a)};b.prototype.flash=function(a){this.messenger.flash(a)};b.prototype.maxZoomedRadius=function(){return 1*this.minDimension};b.prototype.fillBackground=function(){this.clear("background");var a=this.canvas.context("background");a.fillStyle=this.backgroundColor.rgbaString;a.fillRect(0,0,c.pixel(this.width),c.pixel(this.height))};b.prototype.drawFull=function(){this.layout.drawFull()};b.prototype.drawFast=function(){this.layout.drawFast()};b.prototype.drawExport=function(){this.layout.drawExport()};
b.prototype.draw=function(a){this.layout.draw(a)};b.prototype.findFeatureTypeByName=function(a){return this._featureTypes.find(function(d){return d.name.toLowerCase()==a.toLowerCase()})};b.prototype.findFeatureTypeOrCreate=function(a,d){d=void 0===d?"arc":d;var k=this.findFeatureTypeByName(a);k||(k=new c.FeatureType(this,{name:a,decoration:d}));return k};b.prototype.refreshCaptions=function(){for(var a=0,d=this._captions.length;a<d;a++)this._captions[a].refresh()};b.prototype.moveTo=function(a,d){};
Object.defineProperties(b.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this.resize(a)}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this.resize(null,a)}},minDimension:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.height,this.width)}},backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==a?new c.Color("white"):
"Color"==a.toString()?a:new c.Color(a);this.fillBackground()}},labelFont:{configurable:!0,enumerable:!0,get:function(){return this.labelSet.font},set:function(a){this.labelSet.font=a}},globalLabel:{configurable:!0,enumerable:!0,get:function(){return this._globalLabel},set:function(a){this._globalLabel=c.booleanify(a)}},zoomFactor:{configurable:!0,enumerable:!0,get:function(){return this._zoomFactor},set:function(a){this._zoomFactor=a}},scale:{configurable:!0,enumerable:!0,get:function(){return this.canvas.scale}},
maxSlotThickness:{configurable:!0,enumerable:!0,get:function(){return this._maxSlotThickness},set:function(a){this._maxSlotThickness=a}},colorPicker:{configurable:!0,enumerable:!0,get:function(){if(void 0==this._colorPicker){var a=this.containerId+"-color-picker";this._container.append("div").classed("cp-color-picker-dialog",!0).attr("id",this.containerId+"-color-picker");this._colorPicker=new c.ColorPicker(a)}return this._colorPicker}},debug:{configurable:!0,enumerable:!0,get:function(){return this._debug},
set:function(a){a?(!0===a&&(a={},a.sections=b.debug_sections),this._debug=new c.Debug(a)):this._debug=void 0}},_testDrawRange:{configurable:!0,enumerable:!0,get:function(){return this.__testDrawRange},set:function(a){(this.__testDrawRange=a)?(this.canvas.width*=.4,this.canvas.height*=.4):(this.canvas.width/=.4,this.canvas.height/=.4);this.drawFull()}}});Object.defineProperties(b,{debug_sections:{configurable:!0,enumerable:!0,get:function(){return["time","zoom","position","n"]}}});c.Viewer=b})(CGView);
(function(c){var b=function(a,d,k,b){d=void 0===d?{}:d;this.viewer=a;this.positions=d.positions;this.scores=d.scores;this._baseline=c.defaultFor(d.baseline,.5);this._color=new c.Color(c.defaultFor(d.color,"black"));this._colorPositive=d.colorPositive?new c.Color(d.colorPositive):void 0;this._colorNegative=d.colorNegative?new c.Color(d.colorNegative):void 0;d.legend&&(this.legendItem=a.legend.findLegendItemByName(d.legend));d.legendPositive&&(this.legendItemPositive=a.legend.findLegendItemByName(d.legendPositive));
d.legendNegative&&(this.legendItemNegative=a.legend.findLegendItemByName(d.legendNegative))};b.prototype.draw=function(a,d,k,b,c){this.colorNegative.rgbaString==this.colorPositive.rgbaString?this._drawPath(a,d,k,b,c,this.colorPositive):(this._drawPath(a,d,k,b,c,this.colorPositive,"positive"),this._drawPath(a,d,k,b,c,this.colorNegative,"negative"))};b.prototype._drawPath=function(a,d,k,b,f,g,h){var l=this,m=a.context("map"),n=this.positions,q=this.scores,p=b?1:.5,r=c.indexOfValue(n,f.start,!1);f=c.indexOfValue(n,
f.stop,!0);r=n[r];f=n[f];m.beginPath();m.lineWidth=1E-4;var t=d-k/2+k*this.baseline;d=a.pointFor(r,t);m.moveTo(d.x,d.y);var u=t,v=r,w,x,y,z;d=1;b&&(b=n.countFromRange(r,f),d=Math.ceil(10*b/n.length));n.eachFromRange(r,f,d,function(d){z=x;x=q[d];y=n[d];w=t+(x-l.baseline)*k;h&&0>(z-l.baseline)*(x-l.baseline)?(w=t,a.arcPath("map",w,v,y,!1,!0),u=w,v=y):l._keepPoint(x,h)?Math.abs(w-u)>=p&&(a.arcPath("map",w,v,y,!1,!0),u=w,v=y):u=t});a.arcPath("map",u,v,f,!1,!0);b=a.pointFor(f,t);m.lineTo(b.x,b.y);a.arcPath("map",
t,f,r,!0,!0);m.fillStyle=g.rgbaString;m.fill()};b.prototype._keepPoint=function(a,d){return void 0==d||"positive"==d&&a>this.baseline||"negative"==d&&a<this.baseline?!0:!1};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._plots.push(this)}},positions:{configurable:!0,enumerable:!0,get:function(){return this._positions||new c.CGArray},set:function(a){a&&(this._positions=new c.CGArray(a))}},score:{configurable:!0,
enumerable:!0,get:function(){return this._score||new c.CGArray},set:function(a){a&&(this._score=new c.CGArray(a))}},color:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?this.legendItem.swatchColor:this._color}},colorPositive:{configurable:!0,enumerable:!0,get:function(){return this.legendItemPositive?this.legendItemPositive.swatchColor:this._colorPositive?this._colorPositive:this.color}},colorNegative:{configurable:!0,enumerable:!0,get:function(){return this.legendItemNegative?
this.legendItemNegative.swatchColor:this._colorNegative?this._colorNegative:this.color}},legendItem:{configurable:!0,enumerable:!0,get:function(){return this._legendItem},set:function(a){this.legendItemNegative=this.legendItemPositive=this._legendItem=a}},legendItemPositive:{configurable:!0,enumerable:!0,get:function(){return this._legendItemPositive},set:function(a){this._legendItemPositive=a}},legendItemNegative:{configurable:!0,enumerable:!0,get:function(){return this._legendItemNegative},set:function(a){this._legendItemNegative=
a}},baseline:{configurable:!0,enumerable:!0,get:function(){return this._baseline},set:function(a){this._baseline=1<a?1:0>a?0:a}}});c.ArcPlot=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;var k=.4*d3.min([this.viewer.width,this.viewer.height]);this.radius=c.defaultFor(d.radius,k);this.color=c.defaultFor(d.color,"black");this.font=c.defaultFor(d.font,"sans-serif, plain, 14");this.fontColor=c.defaultFor(d.fontColor,"black");this.thickness=c.defaultFor(d.thickness,5);this._bpThicknessAddition=0;this.bpMargin=4};b.prototype.maxZoomFactor=function(){return this.sequence.length*this.bpSpacing/(2*Math.PI*this.radius)};b.prototype.pixelsPerBp=
function(){return c.pixel(2*this.zoomedRadius*Math.PI/this.sequence.length)};b.prototype._drawSequence=function(){var a=this.canvas.context("map"),d=c.pixel(this.zoomedRadius),k=this.visibleRange;if(k){var b=this.sequence.forRange(k),f=c.Sequence.complement(b),g=k.start;a.save();a.fillStyle=this.fontColor.rgbaString;a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var h=this.bpSpacing/2+this.bpMargin,l=0,k=k.length;l<k;l++){var m=this.canvas.pointFor(g,d+h);a.fillText(b[l],m.x,
m.y);m=this.canvas.pointFor(g,d-h);a.fillText(f[l],m.x,m.y);g++}a.restore()}};b.prototype.draw=function(){this._visibleRange=this.canvas.visibleRangeForRadius(c.pixel(this.zoomedRadius),100);if(this.visibleRange)if(this.viewer.canvas.drawArc("map",this.visibleRange.start,this.visibleRange.stop,c.pixel(this.zoomedRadius),this.color.rgbaString,c.pixel(this.zoomedThickness)),1<this.pixelsPerBp()){var a=Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius),d=2*this.pixelsPerBp();
this._bpThicknessAddition=a+d>=this.maxThickness?this.maxThickness-a:d;this.pixelsPerBp()>=this.bpSpacing-this.bpMargin&&this._drawSequence()}else this._bpThicknessAddtion=0};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},
set:function(a){this._color="Color"==a.toString()?a:new c.Color(a)}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor="Color"==a.toString()?a:new c.Color(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.bpSpacing=this.font.size}},radius:{configurable:!0,enumerable:!0,set:function(a){a&&(this._radius=a,this.viewer._updateZoomMax())},get:function(){return this._radius}},
zoomedRadius:{configurable:!0,enumerable:!0,get:function(){return this.radius*this.viewer._zoomFactor}},thickness:{configurable:!0,enumerable:!0,set:function(a){a&&(this._thickness=a)},get:function(){return this._thickness}},zoomedThickness:{configurable:!0,enumerable:!0,get:function(){return Math.min(this.zoomedRadius,this.viewer.maxZoomedRadius())*(this.thickness/this.radius)+this.bpThicknessAddition/c.pixel(1)}},maxThickness:{configurable:!0,enumerable:!0,get:function(){return 2*this.bpSpacing+
4*this.bpMargin}},bpSpacing:{configurable:!0,enumerable:!0,get:function(){return this._bpSpacing},set:function(a){this._bpSpacing=a;this.viewer._updateZoomMax()}},bpMargin:{configurable:!0,enumerable:!0,get:function(){return this._bpMargin},set:function(a){this._bpMargin=a}},bpThicknessAddition:{configurable:!0,enumerable:!0,get:function(){return this._bpThicknessAddition}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}}});c.Backbone=b})(CGView);
(function(c){var b=function(a,d,k){k=void 0===k?{}:k;this._viewer=a;this.width=c.defaultFor(k.width,600);this.height=c.defaultFor(k.height,600);this.determinePixelRatio(d);this._layerNames=["background","map","captions","ui"];this._layers=this.createLayers(d,this._layerNames,this._width,this._height);this.scale={};this.refreshScales()};b.prototype.determinePixelRatio=function(a){var d=a.append("canvas").style("position","absolute").style("top",0).style("left",0).attr("width",this._width).attr("height",
this._height).node();d.getContext?c.pixelRatio=c.getPixelRatio(d):a.html("<h3>CGView requires Canvas, which is not supported by this browser.</h3>");d3.select(d).remove()};b.prototype.createLayers=function(a,d,k,b){for(var f={},g=0,h=d.length;g<h;g++){var l=d[g],m=10*(g+1),m=a.append("canvas").classed("cgv-layer",!0).classed("cgv-layer-"+l,!0).style("z-index",m).attr("width",k).attr("height",b).node();c.scaleResolution(m,c.pixelRatio);var n=m.getContext("2d");f[l]={ctx:n,node:m}}return f};b.prototype.resize=
function(a,d){this.width=a;this.height=d;for(var b=$jscomp.makeIterator(this.layerNames),e=b.next();!e.done;e=b.next())e=this.layers(e.value).node,e.width=this.width,e.height=this.height,e.style.width=a+"px",e.style.height=d+"px";this.refreshScales()};b.prototype.refreshScales=function(){var a,d,b,e;this.scale.x?(d=this.scale.x.domain(),e=d[1]-d[0],a=d[0]/e,d=d[1]/e):(a=-.5,d=.5);if(this.scale.y){var c=this.scale.y.domain();e=c[0]-c[1];b=c[0]/e;e=c[1]/e}else b=.5,e=-.5;this.scale.x=d3.scaleLinear().domain([this.width*
a,this.width*d]).range([0,this.width]);this.scale.y=d3.scaleLinear().domain([this.height*b,this.height*e]).range([0,this.height])};b.prototype.clear=function(a){a=void 0===a?"map":a;if("all"==a){a=0;for(var d=this.layerNames.length;a<d;a++)this.clear(this.layerNames[a])}else this.context(a).clearRect(0,0,c.pixel(this.width),c.pixel(this.height))};b.prototype.drawArc=function(a,d,b,e,c,g,h){c=void 0===c?"#000000":c;g=void 0===g?1:g;h=void 0===h?"arc":h;var l=this.context(a);"arc"==h&&(l.beginPath(),
l.strokeStyle=c,l.lineWidth=g,this.arcPath(a,e,d,b),l.stroke());if("arc"!=h){var m=g/2/this.pixelsPerBp(e),n=this.sequence.lengthOfRange(d,b);n<m&&(n=d+n/2,d=n-m/2,b=n+m/2);n="clockwise-arrow"==h?d:b;d="clockwise-arrow"==h?b:d;h="clockwise-arrow"==h?1:-1;g/=2;m=d-h*m;d=this.pointFor(d,e);b=this.pointFor(m,e-g);l.beginPath();l.fillStyle=c;this.arcPath(a,e+g,n,m,-1==h);l.lineTo(d.x,d.y);l.lineTo(b.x,b.y);this.arcPath(a,e-g,m,n,1==h,!0);l.closePath();l.fill()}};b.prototype.arcPath=function(a,d,b,e,c,
g){c=void 0===c?!1:c;g=void 0===g?!1:g;a=this.context(a);var h=this.scale;this.sequence.lengthOfRange(b,e)<this.sequence.length/1E3&&!c?(e=this.pointFor(e,d),g||(d=this.pointFor(b,d),a.moveTo(d.x,d.y)),a.lineTo(e.x,e.y)):a.arc(h.x(0),h.y(0),d,h.bp(b),h.bp(e),c)};b.prototype.radiantLine=function(a,d,b,e,c,g){c=void 0===c?1:c;g=void 0===g?"black":g;var h=this.pointFor(d,b);d=this.pointFor(d,b+e);a=this.context(a);a.beginPath();a.moveTo(h.x,h.y);a.lineTo(d.x,d.y);a.strokeStyle=g;a.lineWidth=c;a.stroke()};
b.prototype.pointFor=function(a,d){var b=this.scale.bp(a),e=this.scale.x(0)+d*Math.cos(b),b=this.scale.y(0)+d*Math.sin(b);return{x:e,y:b}};b.prototype.bpForPoint=function(a){return Math.round(this.scale.bp.invert(c.angleFromPosition(a.x,a.y)))};b.prototype.visibleRangesForRadius=function(a,d){d=void 0===d?0:d;var b=this;return c.circleAnglesFromIntersectingRect(a,this.scale.x.invert(0-d),this.scale.y.invert(0-d),this.width+2*d,this.height+2*d).map(function(a){return Math.round(b.scale.bp.invert(a))})};
b.prototype.visibleRangeForRadius=function(a,d){d=void 0===d?0:d;var b=this.visibleRangesForRadius(a,d);return 2==b.length?new c.CGRange(this.sequence,b[0],b[1]):2<b.length?new c.CGRange(this.sequence,b[0],b[b.length-1]):a-d>this.maximumVisibleRadius()?void 0:a+d<this.minimumVisibleRadius()?void 0:new c.CGRange(this.sequence,1,this.sequence.length)};b.prototype.centerVisible=function(){var a=this.scale.x(0),d=this.scale.y(0);return 0<=a&&a<=this.width&&0<=d&&d<=this.height};b.prototype.maximumVisibleRadius=
function(){var a=Math.max(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width))),d=Math.max(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+d*d)};b.prototype.minimumVisibleRadius=function(){if(this.centerVisible())return 0;if(c.oppositeSigns(this.scale.x.invert(0),this.scale.x.invert(this.width)))return Math.min(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));if(c.oppositeSigns(this.scale.y.invert(0),
this.scale.y.invert(this.height)))return Math.min(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width)));var a=Math.min(Math.abs(this.scale.x.invert(0)),Math.abs(this.scale.x.invert(this.width))),d=Math.min(Math.abs(this.scale.y.invert(0)),Math.abs(this.scale.y.invert(this.height)));return Math.sqrt(a*a+d*d)};b.prototype.visibleRadii=function(a){return{min:this.minimumVisibleRadius(),max:this.maximumVisibleRadius()}};b.prototype.pixelsPerBp=function(a){return 2*a*Math.PI/this.sequence.length};
b.prototype.layers=function(a){if(c.validate(a,this._layerNames))return this._layers[a];console.error("Returning map layer by default");return this._layers.map};b.prototype.context=function(a){if(c.validate(a,this._layerNames))return this.layers(a).ctx;console.error("Returning map layer by default");return this.layers("map").ctx};b.prototype.node=function(a){if(c.validate(a,this._layerNames))return this.layers(a).node;console.error("Returning map layer by default");return this.layers("map").node};
Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},layerNames:{configurable:!0,enumerable:!0,get:function(){return this._layerNames}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},width:{configurable:!0,enumerable:!0,get:function(){return c.pixel(this._width)},set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return c.pixel(this._height)},set:function(a){this._height=
a}},cursor:{configurable:!0,enumerable:!0,get:function(){return d3.select(this.node("ui")).style("cursor")},set:function(a){d3.select(this.node("ui")).style("cursor",a)}}});c.Canvas=b})(CGView);
(function(c){var b=function(a,d,b){d=void 0===d?{}:d;b=void 0===b?{}:b;this.viewer=a;this.meta=c.merge(d.meta,b);this._items=new c.CGArray;this._position=c.defaultFor(d.position,"upper-right");this.backgroundColor=d.backgroundColor;this.font=c.defaultFor(d.font,"SansSerif, plain, 8");this.fontColor=c.defaultFor(d.fontColor,"black");this.textAlignment=c.defaultFor(d.textAlignment,"left");if(d.items){var e=this;d.items.forEach(function(a){new (c[e.toString()+"Item"])(e,a)})}this.refresh()};b.prototype.toString=
function(){return"Caption"};b.prototype.items=function(a){return this._items.get(a)};b.prototype.refresh=function(){this.clear();for(var a=this.height=0,d=0,b=this._items.length;d<b;d++){var e=this._items[d].height;this.height+=e;d<b-1&&(this.height+=e/2);e>a&&(a=e)}this.padding=a/2;this.height+=2*this.padding;this.width=0;d=this._items.map(function(a){return a.font.css});b=this._items.map(function(a){return a.text});a=c.Font.calculateWidths(this.ctx,d,b);d=0;for(b=a.length;d<b;d++)e=this._items[d],
e.drawSwatch&&(a[d]+=e.height+this.padding/2),e._width=a[d];this.width=d3.max(a)+2*this.padding;this._updateOrigin();this.draw()};b.prototype._updateOrigin=function(){var a=c.pixel(0),d=this.canvas.width,b=this.canvas.height,e=this.width,f=this.height,g=this.position;"upper-left"==g?this.originY=this.originX=a:"upper-center"==g?(this.originX=d/2-e/2,this.originY=a):"upper-right"==g?(this.originX=d-e-a,this.originY=a):"middle-left"==g?(this.originX=a,this.originY=b/2-f/2):"middle-center"==g?(this.originX=
d/2-e/2,this.originY=b/2-f/2):"middle-right"==g?(this.originX=d-e-a,this.originY=b/2-f/2):"lower-left"==g?(this.originX=a,this.originY=b-f-a):"lower-center"==g?(this.originX=d/2-e/2,this.originY=b-f-a):"lower-right"==g&&(this.originX=d-e-a,this.originY=b-f-a)};b.prototype.clear=function(){this.ctx.clearRect(this.originX,this.originY,this.width,this.height)};b.prototype.fillBackground=function(){this.ctx.fillStyle=this.backgroundColor.rgbaString;this.ctx.fillRect(this.originX,this.originY,this.width,
this.height)};b.prototype.draw=function(){var a=this.ctx;this.fillBackground();var d=this.originY+this.padding;a.textBaseline="top";for(var b=0,e=this._items.length;b<e;b++){var c=this._items[b],g=c.height;a.font=c.font.css;a.textAlign=c.textAlignment;a.fillStyle=c.fontColor.rgbaString;a.fillText(c.text,c.textX(),d);d+=1.5*g}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._captions.push(this)}},canvas:{configurable:!0,
enumerable:!0,get:function(){return this.viewer.canvas}},ctx:{configurable:!0,enumerable:!0,get:function(){return this.canvas.context("captions")}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){this._position=a;this.refresh()}},backgroundColor:{configurable:!0,enumerable:!0,get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=void 0==a?this.viewer.backgroundColor:"Color"==a.toString()?a:new c.Color(a);this.refresh()}},font:{configurable:!0,
enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.refresh()}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor.rgbaString},set:function(a){this._fontColor="Color"==a.toString()?a:new c.Color(a);this.refresh()}},textAlignment:{configurable:!0,enumerable:!0,get:function(){return this._textAlignment},set:function(a){c.validate(a,["left","center","right"])&&(this._textAlignment=a);this.refresh()}}});c.Caption=
b})(CGView);
(function(c){var b=function(a,d,b){d=void 0===d?{}:d;b=void 0===b?{}:b;this.parent=a;this.meta=c.merge(d.meta,b);this._text=c.defaultFor(d.text,"");this.font=d.font;this.fontColor=d.fontColor;this.textAlignment=d.textAlignment;this._initializationComplete=!0;this.refresh()};b.prototype.toString=function(){return"CaptionItem"};b.prototype.refresh=function(){this._initializationComplete&&this.parent.refresh()};b.prototype.textX=function(){var a=this.parent;if("left"==this.textAlignment)return a.originX+a.padding;
if("center"==this.textAlignment)return a.originX+a.width/2;if("right"==this.textAlignment)return a.originX+a.width-a.padding};Object.defineProperties(b.prototype,{caption:{configurable:!0,enumerable:!0,get:function(){return this._parent}},parent:{configurable:!0,enumerable:!0,get:function(){return this._parent},get:function(){return this._parent},set:function(a){var d=this.parent;this._viewer=a.viewer;this._parent=a;a._items.push(this);d&&(d._items=d._items.remove(this),d.refresh(),a.refresh())}},
text:{configurable:!0,enumerable:!0,get:function(){return this._text},set:function(a){this._text=a;this.refresh()}},textAlignment:{configurable:!0,enumerable:!0,get:function(){return this._textAlignment},set:function(a){this._textAlignment=void 0==a?this.parent.textAlignment:a;this.refresh()}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},width:{configurable:!0,enumerable:!0,get:function(){return this._width}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.height}},
swatchWidth:{configurable:!0,enumerable:!0,get:function(){return this.height}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font=void 0==a?this.parent.font:"Font"==a.toString()?a:new c.Font(a);this.refresh()}},fontColor:{configurable:!0,enumerable:!0,get:function(){return this._fontColor},set:function(a){this._fontColor=void 0==a?this.parent._fontColor:"Color"==a.toString()?a:new c.Color(a);this.refresh()}}});c.CaptionItem=b})(CGView);
(function(c){function b(a,b,e){return e.indexOf(a)===b}var a=function(){if(1==arguments.length&&Array.isArray(arguments[0]))for(var a=0,b=arguments[0].length;a<b;a++)this.push(arguments[0][a]);else 0<arguments.length&&this.push.apply(this,arguments)};a.prototype=Object.create(Array.prototype);a.prototype.toString=function(){return"CGArray"};a.prototype.merge=function(a){for(var b=0,e=a.length;b<e;b++)this.push(a[b]);return this};a.prototype.attr=function(a){if(1==arguments.length&&"object"==typeof a)for(var b=
Object.keys(a),e=b.length,c=0,g=this.length;c<g;c++)for(var h=0;h<e;h++)this[c][b[h]]=a[b[h]];else if(2==arguments.length)for(b=0,e=this.length;b<e;b++)this[b][arguments[0]]=arguments[1];else if(void 0!=a)throw Error("attr(): must be 2 arguments or a single object");return this};a.prototype.draw=function(a,b,e,c,g){for(var h=0,l=this.length;h<l;h++)this[h].draw(a,b,e,c,g);return this};a.prototype.each=function(a){for(var b=0,e=this.length;b<e;b++)a.call(this[b],b,this[b]);return this};a.prototype.eachFromRange=
function(a,b,e,f){var g=c.indexOfValue(this,a,!0),h=c.indexOfValue(this,b,!1);0<g&&1<e&&(g+=e-g%e);if(b>=a)a=g;else{a=g;for(b=this.length;a<b;a+=e)f.call(this[a],a,this[a]);a=0}for(;a<=h;a+=e)f.call(this[a],a,this[a]);return this};a.prototype.countFromRange=function(a,b,e){e=c.indexOfValue(this,a,!0);var f=c.indexOfValue(this,b,!1);a>this[this.length-1]&&e++;b<this[0]&&f--;return b>=a?f-e+1:this.length-e+f+1};a.prototype.contains=function(a){return 0<=this.indexOf(a)};a.prototype.remove=function(d){var b;
return b=new a(this.filter(function(a){return a!=d}))};a.prototype.empty=function(){return 0==this.length};a.prototype.present=function(){return 0<this.length};a.prototype.order_by=function(a,b){0<this.length&&("function"===typeof this[0][a]?this.sort(function(b,k){return b[a]()>k[a]()?1:b[a]()<k[a]()?-1:0}):this.sort(function(b,k){return b[a]>k[a]?1:b[a]<k[a]?-1:0}));b&&this.reverse();return this};a.prototype.lineWidth=function(a){for(var b=0,e=this.length;b<e;b++)this[b].lineWidth=a;return this};
a.prototype.get=function(d){if(void 0==d)return this;if(Number.isInteger(d))return this[d-1];if("string"==typeof d)return d.match(/^path-id-/)?this.filter(function(a){return a.path_id()==d})[0]:d.match(/^label-id-/)?this.filter(function(a){return a.label_id()==d})[0]:this.filter(function(a){return a.id==d})[0];if(Array.isArray(d)){var b=this.filter(function(a){return d.some(function(d){return a.id==d})}),e=new a;e.push.apply(e,b);return e}return new a};a.prototype.equals=function(a){if("CGArray"!=
a.toString()&&!Array.isArray(a))return!1;var b=this.unique(),e=a.unique(),c=!0;if(b.length!=e.length)return!1;b.forEach(function(a){e.contains(a)||(c=!1)});return c};a.prototype.unique=function(){return new a(this.filter(b))};a.prototype.find=function(a,b){if("function"!==typeof a)throw new TypeError("predicate must be a function");for(var e=Object(this),c=e.length>>>0,g,h=0;h<c;h++)if(g=e[h],a.call(b,g,h,e))return g};c.CGArray=a})(CGView);
(function(c){var b=function(a,d,b){this._sequence=a;this.start=d;this.stop=b};b.prototype.overHalfCircle=function(){return this.length>this.sequenceLength/2};b.prototype.normalize=function(a){var d;return a>this.sequenceLength?(d=Math.floor(a/this.sequenceLength),a-this.sequenceLength*d):1>a?(d=Math.ceil(Math.abs(a/this.sequenceLength)),this.sequenceLength*d+a):a};b.prototype.getStartPlus=function(a){return this.normalize(this.start+a)};b.prototype.getStopPlus=function(a){return this.normalize(this.stop+
a)};b.prototype.isFullCircle=function(){return this.length==this.sequenceLength};b.prototype.spansOrigin=function(){return this.stop<this.start};b.prototype.contains=function(a){return this.stop>=this.start?a>=this.start&&a<=this.stop:a>=this.start||a<=this.stop};b.prototype.copy=function(){return new c.CGRange(this.sequence,this.start,this.stop)};b.prototype.overlapsRange=function(a){return this.contains(a.start)||this.contains(a.stop)||a.contains(this.start)};b.prototype.mergeWithRange=function(a){var d=
new c.CGRange(this.sequence,this.start,a.stop),b=new c.CGRange(this.sequence,a.start,this.stop);a=[this,a,d,b];for(var d=0,e,f=0,g=a.length;f<g;f++)b=a[f].length,b>d&&(d=b,e=a[f]);return e};Object.defineProperties(b.prototype,{sequence:{configurable:!0,enumerable:!0,get:function(){return this._sequence}},sequenceLength:{configurable:!0,enumerable:!0,get:function(){return this.sequence.length}},start:{configurable:!0,enumerable:!0,get:function(){return this._start},set:function(a){this._start=a}},
stop:{configurable:!0,enumerable:!0,get:function(){return this._stop},set:function(a){this._stop=a}},length:{configurable:!0,enumerable:!0,get:function(){return this.stop>=this.start?this.stop-this.start:this.sequenceLength+(this.stop-this.start)}},middle:{configurable:!0,enumerable:!0,get:function(){var a=this.start+this.length/2;return a>this.sequenceLength?a-this.sequenceLength:a}}});c.CGRange=b})(CGView);
(function(c){var b=function(a){this.setColor(a)};b.prototype.toString=function(){return"Color"};b.prototype.setColor=function(a){if("string"===typeof a||a instanceof String)this._string=a;else{var d=new c.CGArray(Object.keys(a));d.contains("h")&&d.contains("s")&&d.contains("v")?this.hsv=a:d.contains("r")&&d.contains("g")&&d.contains("b")&&d.contains("a")?this.rgba=a:d.contains("r")&&d.contains("g")&&d.contains("b")&&(this.rgb=a)}};b.prototype._updateRgbaOpacity=function(){var a=this;this._rgbaString=
this._rgbaString.replace(/^(rgba\(.*,)([\d\.]+?)(\))/,function(d,b,e,c){return b+a.opacity+c})};b.prototype._updateOpacityFromRgba=function(){var a=/^rgba.*,([\d\.]+?)\)$/.exec(this.rgbaString);a&&(this._opacity=b._validateOpacity(a[1]))};Object.defineProperties(b.prototype,{_string:{configurable:!0,enumerable:!0,set:function(a){a=b.string2rgba(a,this.opacity);this._rgbaString=b.rgba2String(a);this._updateOpacityFromRgba()}},opacity:{configurable:!0,enumerable:!0,get:function(){return void 0==this._opacity?
1:this._opacity},set:function(a){this._opacity=b._validateOpacity(a);this._updateRgbaOpacity()}},rgbaString:{configurable:!0,enumerable:!0,get:function(){return this._rgbaString}},rgbString:{configurable:!0,enumerable:!0,get:function(){return b.rgb2String(this.rgb)}},rgb:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+)/.exec(this.rgbaString);return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3])}:void 0},set:function(a){this._string=b.rgb2String(a);this._updateOpacityFromRgba()}},
rgba:{configurable:!0,enumerable:!0,get:function(){var a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)/.exec(this.rgbaString);return a?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0},set:function(a){this._string=b.rgba2String(a);this._updateOpacityFromRgba()}},hsv:{configurable:!0,enumerable:!0,get:function(){return b.rgb2hsv(this.rgb)},set:function(a){a=b.hsv2rgb(a);a.a=this.opacity;this.rgba=a}},hex:{configurable:!0,enumerable:!0,get:function(){}},hla:{configurable:!0,enumerable:!0,
get:function(){}}});b.string2rgba=function(a,d){d=void 0===d?1:d;if(/^#/.test(a))return b.hexString2rgba(a,d);if(/^rgb\(/.test(a))return b.rgbString2rgba(a,d);if(/^rgba\(/.test(a))return b.rgbaString2rgba(a,d);if(/^hsl\(/.test(a))return b.hslStringToRgba(a,d);var k=b.name2HexString(a);return b.hexString2rgba(k,d)};b._validateOpacity=function(a){a=Number(a);isNaN(a)?a=1:1<a?a=1:0>a&&(a=0);return a};b._validateRgba=function(a){return{r:b._validateRgbNumber(a.r),g:b._validateRgbNumber(a.g),b:b._validateRgbNumber(a.b),
a:b._validateOpacity(a.a)}};b._validateRgbNumber=function(a){a=Number(a);NaN==a?a=0:255<a?a=255:0>a&&(a=0);return a};b.rgbString2rgba=function(a,d){d=void 0===d?1:d;a=a.replace(/ +/g,"");var b=/^rgb\((\d+),(\d+),(\d+)\)/.exec(a);return b?{r:Number(b[1]),g:Number(b[2]),b:Number(b[3]),a:d}:void 0};b.rgbaString2rgba=function(a){a=a.replace(/ +/g,"");return(a=/^rgba\((\d+),(\d+),(\d+),([\d\.]+)\)/.exec(a))?{r:Number(a[1]),g:Number(a[2]),b:Number(a[3]),a:Number(a[4])}:void 0};b.hslStringToRgba=function(a){console.log("NOT IMPLEMENTED")};
b.rgb2hsv=function(a){var d=a.r,b=a.g,e=a.b;if(1<d||1<b||1<e)d/=255,b/=255,e/=255;var c;a=Math.max(d,b,e);c=a-Math.min(d,b,e);d=(0==c?0:a==d?(b-e)/c+(b<e?6:0):a==b?(e-d)/c+2:(d-b)/c+4)%6*60;return{h:d,s:0==c?0:c/a,v:a}};b.hsv2rgb=function(a){var d,b,e,c,g=a.h%360/60;c=a.v*a.s;e=c*(1-Math.abs(g%2-1));a=d=b=a.v-c;g=~~g;a+=[c,e,0,0,e,c][g];d+=[e,c,c,e,0,0][g];b+=[0,0,e,c,c,e][g];return{r:Math.floor(255*a),g:Math.floor(255*d),b:Math.floor(255*b)}};b.hexString2rgba=function(a,d){d=void 0===d?1:d;a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,
function(a,d,b,k){return d+d+b+b+k+k});var b=0,e=0,c=0,g=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);g&&(b=parseInt(g[1],16),e=parseInt(g[2],16),c=parseInt(g[3],16));return{r:b,g:e,b:c,a:d}};b.rgba2String=function(a){a=b._validateRgba(a);return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"};b.rgb2String=function(a){return"rgb("+a.r+","+a.g+","+a.b+")"};b.name2HexString=function(a){a=a.toLowerCase();if(a=b.names()[a])return a;console.log("Name not found! Defaulting to Black");return"#000000"};b.names=
function(){return{aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",
ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",
lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",
seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}};c.Color=b})(CGView);
(function(c){function b(a,d,b){a=document.createElementNS("http://www.w3.org/2000/svg",a);for(var c in d)a.setAttribute(c,d[c]);"[object Array]"!=Object.prototype.toString.call(b)&&(b=[b]);d=0;for(c=b[0]&&b.length||0;d<c;d++)a.appendChild(b[d]);return a}function a(a){var d=a.offsetWidth,b=a.offsetHeight;a=d3.mouse(a);a={x:a[0],y:a[1]};a.x>d?a.x=d:0>a.x&&(a.x=0);a.y>b?a.y=b:0>a.y&&(a.y=0);return a}var d=function(a,d){d=void 0===d?{}:d;this.containerId=a;this.container=d3.select("#"+a).node();this._width=
c.defaultFor(d.width,100);this._height=c.defaultFor(d.height,100);this._color=new c.Color(c.defaultFor(d.colorString,"rgba(255,0,0,1)"));this.hsv=this._color.hsv;this.opacity=this._color.opacity;this.onChange=d.onChange;this.onClose=d.onClose;this.container.innerHTML=this._colorpickerHTMLSnippet();d3.select(this.container).classed("cp-dialog",!0);this.dialogElement=this.container.getElementsByClassName("cp-dialog")[0];this.slideElement=this.container.getElementsByClassName("cp-color-slider")[0];this.pickerElement=
this.container.getElementsByClassName("cp-color-picker")[0];this.alphaElement=this.container.getElementsByClassName("cp-alpha-slider")[0];this.slideIndicator=this.container.getElementsByClassName("cp-color-slider-indicator")[0];this.pickerIndicator=this.container.getElementsByClassName("cp-color-picker-indicator")[0];this.alphaIndicator=this.container.getElementsByClassName("cp-alpha-slider-indicator")[0];this.currentColorIndicator=this.container.getElementsByClassName("cp-color-current")[0];this.originalColorIndicator=
this.container.getElementsByClassName("cp-color-original")[0];this.doneButton=this.container.getElementsByClassName("cp-done-button")[0];this._configureView();this.slideIndicator.style.pointerEvents="none";this.pickerIndicator.style.pointerEvents="none";this.alphaIndicator.style.pointerEvents="none";d3.select(this.slideElement).on("mousedown.click",this.slideListener());d3.select(this.pickerElement).on("mousedown.click",this.pickerListener());d3.select(this.alphaElement).on("mousedown.click",this.alphaListener());
d3.select(this.originalColorIndicator).on("mousedown.click",this.originalColorListener());d3.select(this.doneButton).on("mousedown.click",this.doneListener());this.enableDragging(this,this.slideElement,this.slideListener());this.enableDragging(this,this.pickerElement,this.pickerListener());this.enableDragging(this,this.alphaElement,this.alphaListener());this.enableDragging(this,this.container,this.dialogListener());d3.select(this.container).style("visibility","hidden")};d.prototype.updateColor=function(){this._color.hsv=
this.hsv;this._color.opacity=this.opacity;this.updateIndicators();var a=c.Color.rgb2String(c.Color.hsv2rgb({h:this.hsv.h,s:1,v:1}));this.pickerElement.style.backgroundColor=a;d3.select(this.alphaElement).selectAll("stop").attr("stop-color",this.color.rgbString);this.currentColorIndicator.style.backgroundColor=this.color.rgbaString;this.onChange&&this.onChange(this.color)};d.prototype.setColor=function(a){this._color.setColor(a);this.hsv=this._color.hsv;this.opacity=this._color.opacity;this.originalColorIndicator.style.backgroundColor=
this._color.rgbaString;this.updateColor()};d.prototype.updateIndicators=function(){var a=this.hsv,d=this.pickerElement.offsetHeight,b=a.s*this.pickerElement.offsetWidth,d=d-a.v*d,c=this.alphaElement.offsetWidth*this.opacity,h=this.pickerIndicator,l=this.slideIndicator,m=this.alphaIndicator;l.style.top=a.h*this.slideElement.offsetHeight/360-l.offsetHeight/2+"px";h.style.top=d-h.offsetHeight/2+"px";h.style.left=b-h.offsetWidth/2+"px";m.style.left=c-m.offsetWidth/2+"px"};d.prototype.setPosition=function(a){this.container.style.left=
a.x+"px";this.container.style.top=a.y+"px"};d.prototype._colorpickerHTMLSnippet=function(){return'<div class="cp-color-picker-wrapper"><div class="cp-color-picker"></div><div class="cp-color-picker-indicator"><div class="cp-picker-indicator-rect-1"></div><div class="cp-picker-indicator-rect-2"></div></div></div><div class="cp-color-slider-wrapper"><div class="cp-color-slider"></div><div class="cp-color-slider-indicator"><div class="cp-color-indicator-rect-1"></div><div class="cp-color-indicator-rect-2"></div></div></div><div class="cp-alpha-slider-wrapper"><div class="cp-alpha-slider"></div><div class="cp-alpha-slider-indicator"><div class="cp-alpha-indicator-rect-1"></div><div class="cp-alpha-indicator-rect-2"></div></div></div><div class="cp-dialog-footer"><div class="cp-footer-color-section"><div class="cp-color-original"></div><div class="cp-color-current"></div></div><div class="cp-footer-button-section"><button class="cp-done-button">Done</button></div></div>'};
d.prototype._configureView=function(){var a,d,c;c=this.containerId;a=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"20px",height:"100px"},[b("defs",{},b("linearGradient",{id:c+"-gradient-hsv",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#FF0000","stop-opacity":"1"}),b("stop",{offset:"13%","stop-color":"#FF00FF","stop-opacity":"1"}),b("stop",{offset:"25%","stop-color":"#8000FF","stop-opacity":"1"}),b("stop",{offset:"38%","stop-color":"#0040FF","stop-opacity":"1"}),
b("stop",{offset:"50%","stop-color":"#00FFFF","stop-opacity":"1"}),b("stop",{offset:"63%","stop-color":"#00FF40","stop-opacity":"1"}),b("stop",{offset:"75%","stop-color":"#0BED00","stop-opacity":"1"}),b("stop",{offset:"88%","stop-color":"#FFFF00","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#FF0000","stop-opacity":"1"})])),b("rect",{x:"0",y:"0",width:"20px",height:"100px",fill:"url(#"+c+"-gradient-hsv)"})]);d=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"100px",height:"100px"},
[b("defs",{},[b("linearGradient",{id:c+"-gradient-black",x1:"0%",y1:"100%",x2:"0%",y2:"0%"},[b("stop",{offset:"0%","stop-color":"#000000","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})]),b("linearGradient",{id:c+"-gradient-white",x1:"0%",y1:"100%",x2:"100%",y2:"100%"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"1"}),b("stop",{offset:"100%","stop-color":"#CC9A81","stop-opacity":"0"})])]),b("rect",{x:"0",y:"0",width:"100px",height:"100px",
fill:"url(#"+c+"-gradient-white)"}),b("rect",{x:"0",y:"0",width:"100px",height:"100px",fill:"url(#"+c+"-gradient-black)"})]);c=b("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"127px",height:"10px",style:"position: absolute;"},[b("defs",{},[b("linearGradient",{id:c+"-alpha-gradient"},[b("stop",{offset:"0%","stop-color":"#FFFFFF","stop-opacity":"0"}),b("stop",{offset:"100%","stop-color":"#FFFFFF","stop-opacity":"1"})]),b("pattern",{id:c+"-alpha-squares",x:"0",y:"0",width:"10px",height:"10px",
patternUnits:"userSpaceOnUse"},[b("rect",{x:"0",y:"0",width:"10px",height:"10px",fill:"white"}),b("rect",{x:"0",y:"0",width:"5px",height:"5px",fill:"lightgray"}),b("rect",{x:"5px",y:"5px",width:"5px",height:"5px",fill:"lightgray"})])]),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+c+"-alpha-squares)"}),b("rect",{x:"0",y:"0",width:"127px",height:"10px",fill:"url(#"+c+"-alpha-gradient)"})]);this.slideElement.appendChild(a);this.pickerElement.appendChild(d);this.alphaElement.appendChild(c)};
d.prototype.enableDragging=function(d,b,c){d3.select(b).on("mousedown",function(){d3.event.preventDefault();d3.event.stopPropagation();var d=a(b);d3.select(document).on("mousemove.colordrag",function(){document.selection?document.selection.empty():window.getSelection().removeAllRanges();c(d)});d3.select(document).on("mouseup",function(){d3.select(document).on("mousemove.colordrag",null)})})};d.prototype.slideListener=function(){var d=this,b=d.slideElement;return function(){var c=a(b);d.hsv.h=c.y/
b.offsetHeight*360;359<=d.hsv.h&&(d.hsv.h=359);d.updateColor()}};d.prototype.pickerListener=function(){var d=this,b=d.pickerElement;return function(){var c=b.offsetWidth,g=b.offsetHeight,h=a(b);d.hsv.s=h.x/c;d.hsv.v=(g-h.y)/g;d.updateColor()}};d.prototype.alphaListener=function(){var d=this,b=d.alphaElement;return function(){var c=a(b);d.opacity=c.x/b.offsetWidth;d.updateColor()}};d.prototype.dialogListener=function(){var a=this.container;return function(d){a.style.left=d3.event.pageX-d.x+"px";a.style.top=
d3.event.pageY-d.y+"px"}};d.prototype.originalColorListener=function(){var a=this;return function(){a.setColor(a.originalColorIndicator.style.backgroundColor)}};d.prototype.doneListener=function(){var a=this;return function(){a.onChange=void 0;a.close()}};d.prototype.open=function(){var a=d3.select(this.container);a.style("visibility","visible");a.transition().duration(200).style("opacity",1);return this};d.prototype.close=function(){d3.select(this.container).transition().duration(200).style("opacity",
0).on("end",function(){d3.select(this).style("visibility","hidden")});this.onClose&&this.onClose();this.onClose=void 0;return this};Object.defineProperties(d.prototype,{color:{configurable:!0,enumerable:!0,get:function(){return this._color}},width:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetWidth}},height:{configurable:!0,enumerable:!0,get:function(){return this.container.offsetHeight}},visible:{configurable:!0,enumerable:!0,get:function(){return"visible"==d3.select(this.container).style("visibility")},
set:function(a){a?this.open():this.close()}}});c.ColorPicker=d})(CGView);
(function(c){var b=function(a){a=void 0===a?{}:a;this._data={};this._sections=c.defaultFor(a.sections,[]);a=$jscomp.makeIterator(this.sections);for(var d=a.next();!d.done;d=a.next())this.data[d.value]={}};b.prototype.draw=function(a,d,b){d=void 0===d?10:d;b=void 0===b?20:b;d=c.pixel(d);b=c.pixel(b);var e=this._data,f=this._sections;a.font=c.pixel(10)+"pt Sans-Serif";a.fillStyle="black";var g=c.pixel(18);a.textAlign="left";!0===this.debug&&Object.keys(e);var h=0;f.forEach(function(c){Object.keys(e[c]).forEach(function(f){a.fillText(c+
"|"+f+": "+e[c][f],d,b+g*h);h+=1})})};Object.defineProperties(b.prototype,{sections:{configurable:!0,enumerable:!0,get:function(){return this._sections}},data:{configurable:!0,enumerable:!0,get:function(){return this._data}}});c.Debug=b})(CGView);
(function(c){var b=function(a,d){var b=this;d=d||{};this._wrapper=a._wrapper.node();this.fadeTime=c.defaultFor(d.fadeTime,500);this.header_text=c.defaultFor(d.header_text,"");this.content_text=c.defaultFor(d.content_text,"");this.height=c.defaultFor(d.height,300);this.width=c.defaultFor(d.width,300);this.buttons=d.buttons;this.box=d3.select(this._wrapper).append("div").style("display","none").attr("class","cgv-dialog");this.header=this.box.append("div").attr("class","cgv-dialog-header").html(this.header_text);
this.dismiss=this.box.append("div").attr("class","cgv-dialog-dismiss").html("X").on("click",function(){b.close()});this.contents=this.box.append("div").attr("class","cgv-dialog-contents cgv-scroll");this.buttons&&(this.footer=this.box.append("div").attr("class","cgv-dialog-footer"),this._generate_buttons());this.contents.html(this.content_text);this._adjust_size();return this};b.prototype.open=function(a){a=c.defaultFor(a,this.fadeTime);this._adjust_size();this.box.style("display","block");this.box.transition().duration(a).style("opacity",
1);return this};b.prototype.close=function(a){a=c.defaultFor(a,this.fadeTime);this.box.transition().duration(a).style("opacity",0).on("end",function(){d3.select(this).style("display","none")});return this};b.prototype._generate_buttons=function(){var a=this;Object.keys(this.buttons).forEach(function(d){a.footer.append("button").html(d).attr("class","cgv-button").on("click",function(){a.buttons[d].call(a)})})};b.prototype._adjust_size=function(){var a=this._wrapper.offsetWidth,d=this._wrapper.offsetHeight,
b=this.width,c=this.height;this.height>d-50&&(c=d-50);this.width>a-50&&(b=a-50);a=c-40-(this.buttons?35:0);this.box.style("width",b+"px").style("height",c+"px");this.contents.style("height",a+"px")};Object.defineProperties(b.prototype,{visible:{configurable:!0,enumerable:!0,get:function(){return"none"!=this.box.style("display")}},fadeTime:{configurable:!0,enumerable:!0,get:function(){return this._fadeTime},set:function(a){this._fadeTime=a}}});c.Dialog=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;this.color=c.defaultFor(d.color,"grey");this.thickness=c.defaultFor(d.thickness,1);this.visible=c.defaultFor(d.visible,!0);this.radii=new c.CGArray};b.prototype.clearRadii=function(){this.radii=new c.CGArray};b.prototype.addRadius=function(a){this._radii.push(a)};b.prototype.draw=function(){for(var a=0,d=this._radii.length;a<d;a++){var b=this._radii[a];this._visibleRange=this.canvas.visibleRangeForRadius(b,100);this.visibleRange&&this.viewer.canvas.drawArc("map",
this.visibleRange.start,this.visibleRange.stop,b,this.color.rgbaString,c.pixel(this.thickness))}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new c.Color(a)}},
thickness:{configurable:!0,enumerable:!0,set:function(a){a&&(this._thickness=a)},get:function(){return this._thickness}},radii:{configurable:!0,enumerable:!0,set:function(a){a&&"CGArray"==a.toString()&&(this._radii=a)},get:function(){return this._radii}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}}});c.Divider=b})(CGView);
(function(c){var b=function(a){var d=this;this._viewer=a;this.events=new c.Events;this._initializeMousemove();this._initializeClick();this.events.on("mousemove",function(a){d.viewer.debug&&d.viewer.debug.data.position&&(d.viewer.debug.data.position.xy=Math.round(a.mapX)+", "+Math.round(a.mapY),d.viewer.debug.data.position.bp=a.bp,d.canvas.clear("ui"),d.viewer.debug.draw(d.canvas.context("ui")))});this._legendSwatchClick();this._legendSwatchMouseOver()};b.prototype._initializeMousemove=function(){var a=
this;d3.select(this.canvas.node("ui")).on("mousemove.cgv",function(){a.events.trigger("mousemove",a._createEvent(d3.event))})};b.prototype._initializeClick=function(){var a=this;d3.select(this.canvas.node("ui")).on("click.cgv",function(){a.events.trigger("click",a._createEvent(d3.event))})};b.prototype._createEvent=function(a){var d=this.canvas.scale,b=c.pixel(a.offsetX);a=c.pixel(a.offsetY);var e=d.x.invert(b),d=d.y.invert(a),f=Math.sqrt(e*e+d*d);return{bp:this.canvas.bpForPoint({x:e,y:d}),radius:f,
canvasX:b,canvasY:a,mapX:e,mapY:d,d3:d3.event}};b.prototype._legendSwatchClick=function(){var a=this.viewer;this.events.on("click.swatch",function(d){for(var b=a.legend,c=b.items(),f=0,g=c.length;f<g;f++)if(c[f]._swatchContainsPoint({x:d.canvasX,y:d.canvasY})){var h=c[f];h.swatchSelected=!0;d=a.colorPicker;d.visible||b.setColorPickerPosition(d);d.onChange=function(a){h.swatchColor=a.rgbaString;cgv.drawFast()};d.onClose=function(){h.swatchSelected=!1;cgv.drawFull();b.draw()};d.setColor(h._swatchColor.rgba);
d.open();break}})};b.prototype._legendSwatchMouseOver=function(){var a=this,d=this.viewer;this.events.on("mousemove.swatch",function(b){var c=d.legend,f=c.items(),g=c.highlightedSwatchedItem;c.highlightedSwatchedItem=void 0;for(var h=0,l=f.length;h<l;h++)if(f[h]._swatchContainsPoint({x:b.canvasX,y:b.canvasY})){f[h].swatchHighlighted=!0;a.canvas.cursor="pointer";c.draw();break}g&&!c.highlightedSwatchedItem&&(a.canvas.cursor="auto",c.draw())})};Object.defineProperties(b.prototype,{viewer:{configurable:!0,
enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}}});c.EventMonitor=b})(CGView);
(function(c){var b=function(){this._handlers={}};b.prototype.on=function(b,c){var k=this._handlers;a(b);var h=b.replace(/\..*/,"");k[h]||(k[h]=[]);k[h].push(new d(b,c))};b.prototype.off=function(d,b){var c=this._handlers;a(d);var h=d.replace(/\..*/,""),l=k(d);1==arguments.length?l?h?c[h]=c[h].filter(function(a){return a.namespace!=l}):Object.keys(c).forEach(function(a){c[a]=c[a].filter(function(a){return a.namespace!=l})}):c[h]=void 0:c[h]=c[h].filter(function(a){return a.callback!=b})};b.prototype.trigger=
function(d,b){var c=this._handlers;a(d);var h=d.replace(/\..*/,""),l=k(d);Array.isArray(c[h])&&c[h].forEach(function(a){l?a.namespace==l&&a.callback.call(null,b):a.callback.call(null,b)})};var a=function(a){if("string"!=typeof a)throw Error("Type must be a string");},d=function(a,d){this.callback=d;this.event_type=a.replace(/\..*/,"");this.namespace=k(a)},k=function(a){return(result=a.match(/\.(.*)/))?result[1]:void 0};c.Events=b})(CGView);
(function(c){var b=function(a,d,b,e){d=void 0===d?{}:d;this.viewer=a;this.type=c.defaultFor(d.type,"");this.source=c.defaultFor(d.source,"");this.range=new c.CGRange(this.viewer.sequence,Number(d.start),Number(d.stop));this._strand=c.defaultFor(d.strand,1);this.label=new c.Label(this,{name:d.label});this._radiusAdjustment=Number(d.radiusAdjustment)||0;this._proportionOfThickness=Number(d.proportionOfThickness)||1;this.extractedFromSequence=c.defaultFor(d.extractedFromSequence,!1);this.legendItem=
d.legend&&"LegendItem"==d.legend.toString()?d.legend:a.legend.findLegendItemByName(d.legend)};b.prototype.isDirect=function(){return 1==this.strand};b.prototype.isReverse=function(){return-1==this.strand};b.prototype.draw=function(a,d,b,c){if(this.range.overlapsRange(c)){var f=this.start,g=this.stop,h=c.contains(f),l=c.contains(g);h||(f=c.start-100);l||(g=c.stop+100);1E3<this.viewer.zoomFactor&&h&&l&&this.range.overHalfCircle()?(a.drawArc("map",c.start-100,g,this.adjustedRadius(d,b),this.color.rgbaString,
this.adjustedWidth(b),this.decoration),a.drawArc("map",f,c.stop+100,this.adjustedRadius(d,b),this.color.rgbaString,this.adjustedWidth(b),this.decoration)):a.drawArc("map",f,g,this.adjustedRadius(d,b),this.color.rgbaString,this.adjustedWidth(b),this.decoration)}};b.prototype.adjustedRadius=function(a,d){return 0==this._radiusAdjustment&&1==this._proportionOfThickness?a:0==this._radiusAdjustment?a-d/2+this._proportionOfThickness*d/2:a};b.prototype.adjustedWidth=function(a){return this._proportionOfThickness*
a};Object.defineProperties(b.prototype,{type:{configurable:!0,enumerable:!0,get:function(){return this._type},set:function(a){this._type=a;this.featureType=this.viewer.findFeatureTypeOrCreate(a,"arc")}},featureType:{configurable:!0,enumerable:!0,get:function(){return this._featureType},set:function(a){this._featureType=a}},extractedFromSequence:{configurable:!0,enumerable:!0,get:function(){return this._extractedFromSequence},set:function(a){this._extractedFromSequence=a}},viewer:{configurable:!0,
enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._features.push(this)}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand}},range:{configurable:!0,enumerable:!0,get:function(){return this._range},set:function(a){this._range=a}},start:{configurable:!0,enumerable:!0,get:function(){return this.range.start},set:function(a){this.range.start=a}},stop:{configurable:!0,enumerable:!0,get:function(){return this.range.stop},set:function(a){this.range.stop=
a}},length:{configurable:!0,enumerable:!0,get:function(){return this.range.length}},label:{configurable:!0,enumerable:!0,get:function(){return this._label},set:function(a){this._label=a}},color:{configurable:!0,enumerable:!0,get:function(){return this.legendItem?this.legendItem.swatchColor:this._color}},decoration:{configurable:!0,enumerable:!0,get:function(){return this.featureType?"arrow"==this.featureType.decoration?1==this.strand?"clockwise-arrow":"counterclockwise-arrow":this.featureType.decoration:
"arc"}},legendItem:{configurable:!0,enumerable:!0,get:function(){return this._legendItem},set:function(a){this._legendItem=a}}});c.Feature=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this.viewer=a;this.name=c.defaultFor(d.name,"");this.decoration=c.defaultFor(d.decoration,"arc")};b.prototype.features=function(a){var d=this;return(new c.CGArray(this.viewer._features.filter(function(a){return a.featureType==d}))).get(a)};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=a;a._featureTypes.push(this)}},type:{configurable:!0,enumerable:!0,get:function(){return this._type},
set:function(a){this._type=a}},decoration:{configurable:!0,enumerable:!0,get:function(){return this._decoration},set:function(a){c.validate(a,["arc","arrow","score"])&&(this._decoration=a)}}});c.FeatureType=b})(CGView);
(function(c){var b=function(a){this._rawFont=a};b.prototype.toString=function(){return"Font"};b.prototype.cssScaled=function(a){return a&&1!=a?this._styleAsCss()+" "+this.size*a+"px "+this.family:this.css};b.prototype.width=function(a,d){a.font=this.css;return a.measureText(d).width};b.prototype._styleAsCss=function(){return"plain"==this.style?"normal":"bold"==this.style?"bold":"italic"==this.style?"italic":"bold-italic"==this.style?"italic bold":""};b.prototype._generateFont=function(){this._font=
this._styleAsCss()+" "+this.size+"px "+this.family};Object.defineProperties(b.prototype,{_rawFont:{configurable:!0,enumerable:!0,set:function(a){if("string"===typeof a||a instanceof String)this.string=a;else{var d=new c.CGArray(Object.keys(a));d.contains("family")&&d.contains("style")&&d.contains("size")?(this.family=a.family,this.style=a.style,this.size=a.size):console.log("Font objects require the following keys: family, style, and size")}}},string:{configurable:!0,enumerable:!0,get:function(){return this.family+
","+this.style+","+this.size},set:function(a){a=a.replace(/ +/g,"");a=a.split(",");3==a.length?(this.family=a[0],this.style=a[1],this.size=a[2]):console.log("Font must have 3 parts");this._generateFont()}},css:{configurable:!0,enumerable:!0,get:function(){return this._font}},family:{configurable:!0,enumerable:!0,get:function(){return this._family||"sans-serif"},set:function(a){this._family=a;this._generateFont()}},size:{configurable:!0,enumerable:!0,get:function(){return this._size||c.pixel(12)},
set:function(a){this._size=c.pixel(Number(a));this._generateFont()}},style:{configurable:!0,enumerable:!0,get:function(){return this._style||"plain"},set:function(a){this._style=a;this._generateFont()}},height:{configurable:!0,enumerable:!0,get:function(){return this.size}}});b.calculateWidths=function(a,d,b){a.save();for(var c=[],f=[],g=0,h=d.length;g<h;g++)f.push({index:g,font:d[g],text:b[g]});f.sort(function(a,d){return a.font>d.font?1:-1});d="";g=0;for(h=f.length;g<h;g++)b=f[g].font,text=f[g].text,
b!=d&&(d=a.font=b),c[f[g].index]=a.measureText(text).width;a.restore();return c};c.Font=b})(CGView);
(function(c){c.Help=function(b){this.viewer=b;this.dialog=new c.Dialog(b,{header_text:"CGView (CGV) Help",content_text:'The map can be scrolled around or scaled using the controls in the menu or by using the various mouse and keyboard shortcuts:<h3>Viewer Controls</h3><table class="cgv-table"><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>Zoom In/Out</td><td>Scroll wheel</td></tr><tr><td>Move Around</td><td>Click and Drag</td></tr></tbody></table><h3>Change Map</h3><table class="cgv-table"><thead><tr><th>Action</th><th>Command</th></tr></thead><tbody><tr><td>Change Feature Colors</td><td>Click on color swatches in legend</td></tr></tbody></table><h3>Troubleshooting</h3><p>If the viewer is not showing any map or is slow, try updating to the latest version of your browser. We have found that <a href="https://www.google.com/chrome" target="_blank">Google Chrome</a> is the fastest.</p></div></div>',width:700,
height:350})}})(CGView);
(function(c){var b=function(a){this._viewer=a};b.prototype.loadJSON=function(a){var d=this._viewer;d.sequence=new c.Sequence(d,a.sequence);var b=a.settings;d.ruler=new c.Ruler(d,b.ruler);d.backbone=new c.Backbone(d,b.backbone);a.captions&&a.captions.forEach(function(a){new c.Caption(d,a)});d.legend=new c.Legend(d,a.legend);a.featureTypes&&a.featureTypes.forEach(function(a){new c.FeatureType(d,a)});a.features&&a.features.forEach(function(a){new c.Feature(d,a)});a.plots&&a.plots.forEach(function(a){});d.layout=
new c.Layout(d,a.layout)};b.prototype.exportImage=function(a,d){var b=this._viewer,e=b.canvas;a=a||b.width;d=d||b.height;var f="CGV-Image-"+a+"x"+d;a/=c.pixelRatio;d/=c.pixelRatio;var g=e._layers,h=b.debug;b.debug=!1;for(var l=e.layerNames.concat(["export"]),m=e.createLayers(d3.select("body"),l,a,d),n=d3.min([a,d])/b.minDimension,q=$jscomp.makeIterator(e.layerNames),p=q.next();!p.done;p=q.next())p=p.value,m[p].ctx.scale(n,n);e._layers=m;b.drawExport();b.fillBackground();b.legend.draw();p=0;for(n=
b._captions.length;p<n;p++)b._captions[p].draw();p=m["export"].ctx;p.drawImage(m.background.node,0,0);p.drawImage(m.map.node,0,0);p.drawImage(m.captions.node,0,0);n=m["export"].node.toDataURL();e._layers=g;b.debug=h;e=$jscomp.makeIterator(l);for(p=e.next();!p.done;p=e.next())p=p.value,d3.select(m[p].node).remove();m=window.open();b=["<html><head><title>",f,"</title></head><body>",'<img style="border: 1px solid grey" width="'+b.width+'" height="'+b.height+'" src="'+n+'"/ >',"<h3>Actual Size</h3>",
'<img style="border: 1px solid grey" src="'+n+'"/ >',"</body><html>"].join("");m.document.write(b)};c.IO=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._feature=a;this.name=d.name;this.bp=this.feature.start+this.feature.length/2};Object.defineProperties(b.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name},set:function(a){void 0==a||""==a?(this.width=0,""!=this._name&&void 0!=this._name&&this.labelSet.removeLabel(this),this._name=""):(""!=this._name&&void 0!=this._name||this.labelSet.addLabel(this),this._name=a,this.width=this.font.width(this.viewer.canvas.context("map"),
this._name))}},rect:{configurable:!0,enumerable:!0,get:function(){return this._rect},set:function(a){this._rect=a}},width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=a}},height:{configurable:!0,enumerable:!0,get:function(){return this.font.size}},origin:{configurable:!0,enumerable:!0,get:function(){return this._origin},set:function(a){this._origin=a}},lineAttachment:{configurable:!0,enumerable:!0,get:function(){return this._lineAttachment},set:function(a){this._lineAttachment=
a}},font:{configurable:!0,enumerable:!0,get:function(){return this._font||this.labelSet.font},set:function(a){this._font=void 0==a?this.labelSet.font:"Font"==a.toString()?a:new c.Font(a)}},viewer:{configurable:!0,enumerable:!0,get:function(){return this.feature.viewer}},labelSet:{configurable:!0,enumerable:!0,get:function(){return this.viewer.labelSet}},feature:{configurable:!0,enumerable:!0,get:function(){return this._feature}}});c.Label=b})(CGView);
(function(c){var b=function(a,d){d=void 0===d?{}:d;this._viewer=a;this._canvas=a.canvas;this._labels=new c.CGArray;this.font=c.defaultFor(d.font,"SansSerif, plain, 12");this.labelLineLength=c.defaultFor(d.labelLineLength,20);this._labelLineMargin=c.pixel(10);this._labelLineWidth=c.pixel(1)};b.prototype.addLabel=function(a){this._labels.push(a);this.sort()};b.prototype.removeLabel=function(a){this._labels=this._labels.remove(a)};b.prototype.sort=function(){this._labels.sort(function(a,d){return a.bp>
d.bp?1:-1})};b.prototype.refreshLabelWidths=function(){for(var a=this._labels.map(function(a){return a.font.css}),d=this._labels.map(function(a){return a.name}),a=c.Font.calculateWidths(this._canvas.context("map"),a,d),d=0,b=this._labels.length;d<b;d++)this._labels[d].width=a[d]};b.prototype._calculateLabelRects=function(){for(var a=this._canvas,d=a.scale,b,e,f,g=this._outerRadius+this._labelLineMargin,h=0,l=this._labels.length;h<l;h++)b=this._labels[h],e=b.feature,f=e.start+e.length/2,e=d.bp(f),
a.pointFor(f,g),f=a.pointFor(f,g+this.labelLineLength),b.lineAttachment=c.clockPositionForAngle(e+Math.PI),e=c.rectOriginForAttachementPoint(f,b.lineAttachment,b.width,b.height),b.rect=new c.Rect(e.x,e.y,b.width,b.height)};b.prototype.visibleLabels=function(a){var d=new c.CGArray;if(a=this._canvas.visibleRangeForRadius(a))if(1==a.start&&a.stop==this.viewer.sequence.length)d=this._labels;else for(var b=0,e=this._labels.length;b<e;b++)a.contains(this._labels[b].bp)&&d.push(this._labels[b]);return d};
b.prototype.draw=function(a,d){this._innerRadius=a;this._outerRadius=d;this._calculateLabelRects();this._labelsToDraw=this.visibleLabels(d);var b=new c.CGArray;this._visibleLabels=new c.CGArray;for(var e=0,f=this._labelsToDraw.length;e<f;e++)h=this._labelsToDraw[e],h.rect.overlap(b)||(this._visibleLabels.push(h),b.push(h.rect));var b=this._canvas,g=b.context("map"),h,l;g.font=this.font.css;g.textAlign="left";g.textBaseline="top";e=0;for(f=this._visibleLabels.length;e<f;e++)h=this._visibleLabels[e],
l=h.feature,b.radiantLine("map",h.bp,d+this._labelLineMargin,this.labelLineLength,this._labelLineWidth,l.color.rgbaString),g.fillStyle=l.color.rgbaString,g.fillText(h.name,h.rect.x,h.rect.y);this.viewer.debug&&this.viewer.debug.data.n&&(this.viewer.debug.data.n.labels=this._visibleLabels.length)};Object.defineProperties(b.prototype,{labelLineLength:{configurable:!0,enumerable:!0,get:function(){return this._labelLineLength},set:function(a){this._labelLineLength=c.pixel(a)}},font:{configurable:!0,enumerable:!0,
get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.refreshLabelWidths()}},viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},length:{configurable:!0,enumerable:!0,get:function(){return this._labels.length}}});c.LabelSet=b})(CGView);
(function(c){var b=function(a,d,b,e){d=void 0===d?{}:d;this._viewer=a;this._tracks=new c.CGArray;this._fastMaxFeatures=1E3;if(d.tracks){var f=this;d.tracks.forEach(function(a){new c.Track(f,a)})}this._adjustProportions()};b.prototype._adjustProportions=function(){var a=this.viewer,d=.35*a.minDimension,b=.15*a.minDimension,c=this.slots().length*(a.slotDivider.thickness+a.slotSpacing),b=d-b-a.backbone.thickness-c,c=this.slots().filter(function(a){return"plot"==a.type}).length,f=this.slots().filter(function(a){return"feature"==
a.type}).length,g=b/(6*c+f),h=6*g,g=Math.min(g,30),h=Math.min(h,100),l=0;this.slots().filter(function(a){return a.outside}).forEach(function(a){"feature"==a.type?l+=g:"plot"==a.type&&(l+=h)});d-=l;a.backbone.radius=d;var m=g/d,n=h/d;this.slots().each(function(a,d){"feature"==d.type?d.proportionOfRadius=m:"plot"==d.type&&(d.proportionOfRadius=n)});this.updateLayout(!0)};b.prototype.tracks=function(a){return this._tracks.get(a)};b.prototype.slots=function(a){for(var d=new c.CGArray,b=0,e=this._tracks.length;b<
e;b++)d.merge(this._tracks[b]._slots);return d.get(a)};b.prototype.drawMapWithoutSlots=function(){var a=this.viewer,d=a.backbone,b=a.canvas,e=(new Date).getTime();a.clear();a.messenger.visible&&a.messenger.close();d.draw();this.updateLayout();a.slotDivider.draw();a.ruler.draw(this.insideRadius,this.outsideRadius);a.globalLabel&&a.labelSet.draw(this.insideRadius,this.outsideRadius);this.drawProgress();a.debug&&(a.debug.data.time.draw=c.elapsed_time(e),a.clear("ui"),a.debug.draw(b.context("ui")));a._testDrawRange&&
(a=b.context("captions"),a.strokeStyle="grey",a.rect(0,0,b.width,b.height),a.stroke());this._slotIndex=0;this._slotTimeoutID&&(clearTimeout(this._slotTimeoutID),this._slotTimeoutID=void 0)};b.prototype.drawFast=function(){this.drawMapWithoutSlots();this.drawAllSlots(!0)};b.prototype.drawFull=function(){this.drawMapWithoutSlots();this.drawAllSlots(!0);this.drawSlotWithTimeOut(this)};b.prototype.drawExport=function(){this.drawMapWithoutSlots();this.drawAllSlots(!1)};b.prototype.draw=function(a){a?this.drawFast():
this.drawFull()};b.prototype.drawAllSlots=function(a){for(var d,b,c=0,f=this._tracks.length;c<f;c++){d=this._tracks[c];for(var g=0,h=d._slots.length;g<h;g++)b=d._slots[g],b.draw(this.viewer.canvas,a)}};b.prototype.drawSlotWithTimeOut=function(a){var d=a.slots(),b=d[a._slotIndex];b.clear();b.draw(a.viewer.canvas);a._slotIndex++;a._slotIndex<d.length&&(a._slotTimeoutID=setTimeout(a.drawSlotWithTimeOut,0,a))};b.prototype.updateLayout=function(a){var b=this.viewer;if(a||this._savedZoomFactor!=b._zoomFactor){this._savedZoomFactor=
b._zoomFactor;a=b.backbone;var k=c.pixel(a.zoomedThickness),e=c.pixel(a.zoomedRadius);a=e+k/2;var k=e-k/2,f=c.pixel(b.slotSpacing),e=0,g,h;b.slotDivider.clearRadii();for(var l=this._slotLength=0,m=this._tracks.length;l<m;l++){g=this._tracks[l];for(var n=0,q=g._slots.length;n<q;n++){h=g._slots[n];this._slotLength++;var p=this._calculateSlotThickness(h.proportionOfRadius);h._thickness=p;e="outside"==g.position||"both"==g.position&&h.isDirect()?a+=p/2+f+e:k-=p/2+f+e;h._radius=e;e=p/2;b.slotDivider.visible&&
(p=b.slotDivider.thickness,e="outside"==g.position||"both"==g.position&&h.isDirect()?a+=f+e+p:k-=f+e+p,b.slotDivider.addRadius(e),e=p/2)}}this._fastFeaturesPerSlot=this._fastMaxFeatures/this.slotLength;this._insideRadius=k;this._outsideRadius=a}};b.prototype._calculateSlotThickness=function(a){var b=this.viewer;a=c.pixel(Math.min(b.backbone.zoomedRadius,b.maxZoomedRadius())*a);return b.maxSlotThickness?Math.min(a,c.pixel(b.maxSlotThickness)):a};b.prototype.drawProgress=function(){this.viewer.canvas.clear("background");
for(var a,b,c,e=0,f=this._tracks.length;e<f;e++){a=this._tracks[e];c=a.loadProgress;for(var g=0,h=a._slots.length;g<h;g++)b=a._slots[g],b.drawProgress(c)}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},insideRadius:{configurable:!0,enumerable:!0,get:function(){return this._insideRadius}},outsideRadius:{configurable:!0,enumerable:!0,get:function(){return this._outsideRadius}},slotLength:{configurable:!0,enumerable:!0,get:function(){return this._slotLength||
0}},fastMaxFeatures:{configurable:!0,enumerable:!0,get:function(){return this._fastMaxFeatures}},fastFeaturesPerSlot:{configurable:!0,enumerable:!0,get:function(){return this._fastFeaturesPerSlot}}});c.Layout=b})(CGView);
(function(c){var b=function(a,b,k){b=void 0===b?{}:b;k=void 0===k?{}:k;c.Caption.call(this,a,b,k)};$jscomp.inherits(b,c.Caption);b.prototype.toString=function(){return"Legend"};b.prototype.setColorPickerPosition=function(a){var b,k=this.viewer._container.node().getBoundingClientRect();b=this.originX/c.pixel(1)+k.left+window.pageXOffset;var k=this.originY/c.pixel(1)+k.top+window.pageYOffset,e=this.width/c.pixel(1);b=/-left$/.exec(this.position)?{x:b+e+5,y:k}:{x:b-a.width-5,y:k};a.setPosition(b)};b.prototype.findLegendItemByName=
function(a){if(a)return this._items.find(function(b){return a.toLowerCase()==b.text.toLowerCase()})};b.prototype.findLegendItemOrCreate=function(a,b){a=void 0===a?"Unknown":a;b=void 0===b?"black":b;var k=this.findLegendItemByName(a);k||(k=new c.LegendItem(this,{text:a,swatchColor:b}));return k};b.prototype.draw=function(){var a=this.ctx;this.fillBackground();var b,k=this.originY+this.padding;a.lineWidth=1;a.textBaseline="top";for(var e=0,f=this._items.length;e<f;e++){var g=this._items[e],h=g.height;
b=g.drawSwatch;var l=g.swatchWidth;a.font=g.font.css;a.textAlign=g.textAlignment;if(b){a.strokeStyle=g.swatchSelected?"black":g.swatchHighlighted?"grey":this.backgroundColor.rgbaString;var m=c.pixel(2);b=g.swatchX();a.strokeRect(b-m,k-m,l+2*m,l+2*m);a.fillStyle=g.swatchColor.rgbaString;a.fillRect(b,k,l,l)}a.fillStyle=g.fontColor.rgbaString;a.fillText(g.text,g.textX(),k);k+=1.5*h}};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer},set:function(a){this._viewer=
a}},selectedSwatchedItem:{configurable:!0,enumerable:!0,get:function(){return this._selectedSwatchedItem},set:function(a){this._selectedSwatchedItem=a}},highlightedSwatchedItem:{configurable:!0,enumerable:!0,get:function(){return this._highlightedSwatchedItem},set:function(a){this._highlightedSwatchedItem=a}},swatchPadding:{configurable:!0,enumerable:!0,get:function(){return this.padding/2}}});c.Legend=b})(CGView);
(function(c){var b=function(a,b,k){b=void 0===b?{}:b;k=void 0===k?{}:k;c.CaptionItem.call(this,a,b,k);this._drawSwatch=c.defaultFor(b.drawSwatch,!0);this._swatchColor=new c.Color(c.defaultFor(b.swatchColor,"black"));this.refresh()};$jscomp.inherits(b,c.CaptionItem);b.prototype.toString=function(){return"LegendItem"};b.prototype.textX=function(){if(this.drawSwatch){var a=this.parent;if("left"==this.textAlignment)return this.swatchX()+this.swatchWidth+a.swatchPadding;if("center"==this.textAlignment)return a.originX+
a.width/2;if("right"==this.textAlignment)return this.swatchX()-a.swatchPadding}else return c.CaptionItem.prototype.textX.call(this)};b.prototype.swatchX=function(){var a=this.parent;if("left"==this.textAlignment||"center"==this.textAlignment)return a.originX+a.padding;if("right"==this.textAlignment)return a.originX+a.width-a.padding-this.swatchWidth};b.prototype._swatchContainsPoint=function(a){for(var b=this.parent.originX+this.parent.padding,c=this.parent.originY+this.parent.padding,e=0,f=this.parent._items.length;e<
f;e++){var g=this.parent._items[e];if(g==this)break;c+=1.5*g.height}if(a.x>=b&&a.x<=b+this.height&&a.y>=c&&a.y<=c+this.height)return!0};b.prototype.features=function(a){var b=this;return(new c.CGArray(this.viewer._features.filter(function(a){return a.legendItem==b}))).get(a)};Object.defineProperties(b.prototype,{legend:{configurable:!0,enumerable:!0,get:function(){return this._parent}},drawSwatch:{configurable:!0,enumerable:!0,get:function(){return this._drawSwatch},set:function(a){this._drawSwatch=
a;this.refresh()}},swatchWidth:{configurable:!0,enumerable:!0,get:function(){return this.height}},swatchColor:{configurable:!0,enumerable:!0,get:function(){return this._swatchColor},set:function(a){"Color"==a.toString()?this._swatchColor=a:this._swatchColor.setColor(a);this.refresh()}},swatchSelected:{configurable:!0,enumerable:!0,get:function(){return this.legend.selectedSwatchedItem==this},set:function(a){a?this.legend.selectedSwatchedItem=this:this.legend.selectedSwatchedItem==this&&(this.legend.selectedSwatchedItem=
void 0)}},swatchHighlighted:{configurable:!0,enumerable:!0,get:function(){return this.legend.highlightedSwatchedItem==this},set:function(a){a?this.legend.highlightedSwatchedItem=this:this.legend.highlightedSwatchedItem==this&&(this.legend.highlightedSwatchedItem=void 0)}}});c.LegendItem=b})(CGView);
(function(c){var b=function(a){var b=this;this.viewer=a;this.slideTime=500;this._menu_div=a._wrapper.append("div").style("visibility","hidden").attr("class","cgv-menu").on("click",function(){window.getSelection().removeAllRanges()});this._menu_svg=this._menu_div.append("svg").attr("width",this.width).attr("height",this.height);this._handle_div=a._wrapper.append("div").attr("class","cgv-menu-handle").on("click",function(){b.opened?b.close():b.open()}).on("mouseover",function(){b._handle_mouseover()}).on("mouseout",
function(){b._handle_mouseout()});this._handle_svg=this._handle_div.append("svg").attr("width",40).attr("height",12);this._handle_stroke_width=4;this._handle_data_closed=[{x:0,y:0},{x:20,y:12-this._handle_stroke_width},{x:40,y:0}];this._handle_data_opened=[{x:0,y:12},{x:20,y:this._handle_stroke_width},{x:40,y:12}];this._draw()};b.prototype.open=function(a){a=c.defaultFor(a,this.slideTime);this._menu_div.style("visibility","visible");this._menu_div.transition().duration(a).style("top","0px").style("opacity",
1);this._handle_path.transition("shape").duration(a).attr("d",l(this._handle_data_opened))};b.prototype.close=function(a){a=c.defaultFor(a,this.slideTime);this._menu_div.transition().duration(a).style("top","-50px").style("opacity",0).on("end",function(){d3.select(this).style("visibility","hidden")});this._handle_path.transition("shape").duration(a).attr("d",l(this._handle_data_closed))};b.prototype._handle_mouseover=function(){this._handle_path.transition("color").duration(200).attr("stroke","black")};
b.prototype._handle_mouseout=function(){this._handle_path.transition().duration(200).attr("stroke","grey")};b.prototype._draw=function(){var b=this.viewer,n=this;this._handle_path=this._handle_svg.append("path").attr("d",l(this._handle_data_closed)).attr("stroke","grey").attr("stroke-width",this._handle_stroke_width).attr("fill","none");var q=a(this._menu_svg,[{x:11,y:4},{x:4,y:15},{x:11,y:26}]),p=a(this._menu_svg,[{x:4,y:4},{x:11,y:15},{x:4,y:26}]);this.nav_group=this._menu_svg.append("g");this.scroll_left_button=
h(this.nav_group,0,0,15,30,q);this.scroll_right_button=h(this.nav_group,17,0,15,30,p);this.nav_group.attr("transform","translate(7,4)");$(document).mouseup(function(){});this.zoom_group=this._menu_svg.append("g");this.zoom_y_minus_button=h(this.zoom_group,6,18,16,16,k(this._menu_svg));this.zoom_y_plus_button=h(this.zoom_group,6,0,16,16,d(this._menu_svg));this.zoom_x_minus_button=h(this.zoom_group,25,9,16,16,k(this._menu_svg));this.zoom_x_plus_button=h(this.zoom_group,43,9,16,16,d(this._menu_svg));
e(this.zoom_group,0,.5,5,34,0);e(this.zoom_group,25.5,32,5,34,-90);this.zoom_group.attr("transform","translate(55,2)");this.zoom_x_minus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/2,a=[[b.scale.x.min()-a,b.scale.x.max()+a],b.scale.y.domain()];b.move_to(a)}});this.zoom_x_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.x.diff()/4,a=[[b.scale.x.min()+a,b.scale.x.max()-a],b.scale.y.domain()];b.move_to(a)}});this.zoom_y_minus_button.on("click",
function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/2,a=[b.scale.x.domain(),[b.scale.y.min()-a,b.scale.y.max()+a]];b.move_to(a)}});this.zoom_y_plus_button.on("click",function(){if(!d3.select(this).classed("disabled")){var a=b.scale.y.diff()/4,a=[b.scale.x.domain(),[b.scale.y.min()+a,b.scale.y.max()-a]];b.move_to(a)}});q=this._menu_svg.append("text").attr("x",15).attr("y",24).attr("font-family","sans-serif").attr("font-size","26px").attr("stroke-width",1).attr("fill","black").attr("class",
"cgv-button-text").style("text-anchor","middle").text("?");this.help_button=h(this._menu_svg,260,4,30,30,q);this.help_button.on("click",function(){b.help.dialog.open()});q=g(this._menu_svg).attr("transform","translate(5,7)");this.download_button=h(this._menu_svg,220,4,30,30,q);this.download_dialog=new c.Dialog(b,{header_text:"Save Image",content_text:'<div class="cgv-alert">Display the viewer image in a new window to download or print. Note that you must allow pop-ups!</div><div><label class="cgv-label">Size</label><div class="cgv-input-group"><input class="cgv-input" id="cgv-save-width" type="text" value="'+
b.width+'" /><div class="cgv-input-addon">px</div></div></div>',buttons:{Cancel:function(){this.close()},Generate:function(){var a=b._wrapper.select("#cgv-save-width").property("value"),d=b._wrapper.select("#cgv-save-width").property("value");b._io.exportImage(d,a);this.close()}},width:400,height:200});this.download_button.on("click",function(){n.download_dialog.open()});q=f(this._menu_svg).attr("transform","translate(5,5)");this.settings_button=h(this._menu_svg,180,4,30,30,q);this.settings_button.on("click",
function(){b.settings.open()});this._menu_svg.append("text").attr("x",149).attr("y",32).attr("font-family","sans-serif").attr("font-size","16px").attr("font-weight","bold").attr("stroke-width",1).attr("fill","grey").attr("class","cgv-button-text").style("text-anchor","middle").text("CGV")};Object.defineProperties(b.prototype,{slideTime:{configurable:!0,enumerable:!0,get:function(){return this._slideTime},set:function(a){this._slideTime=a}},available:{configurable:!0,enumerable:!0,get:function(){return this._available},
set:function(a){a?(this._available=!0,this._handle_div.style("visibility","visible"),this._menu_div.style("visibility","visible")):(this._available=!1,this._handle_div.style("visibility","hidden"),this._menu_div.style("visibility","hidden"))}},opened:{configurable:!0,enumerable:!0,get:function(){return"visible"==this._menu_div.style("visibility")}},width:{configurable:!0,enumerable:!0,get:function(){return 300}},height:{configurable:!0,enumerable:!0,get:function(){return 41}}});var a=function(a,b){return a.append("path").attr("d",
l(b)).attr("stroke","black").attr("stroke-width",3).attr("fill","none")},d=function(a){a=a.append("g");a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke","black");a.append("line").attr("x1",8).attr("y1",3).attr("x2",8).attr("y2",13).attr("stroke-width",3).attr("stroke","black");return a},k=function(a){return a.append("line").attr("x1",3).attr("y1",8).attr("x2",13).attr("y2",8).attr("stroke-width",3).attr("stroke","black")},e=function(a,b,d,c,
e,k){a=a.append("g");var g=d+2,f=d+e-2,h=b+c/2;a.append("line").attrs({x1:b,y1:d,x2:b+c,y2:d,"stroke-width":1});a.append("line").attrs({x1:b,y1:d+e,x2:b+c,y2:d+e,"stroke-width":1});a.append("line").attrs({x1:h,y1:g,x2:h,y2:f,"stroke-width":1});a.append("line").attrs({x1:h,y1:g,x2:h-2,y2:g+2,"stroke-width":1});a.append("line").attrs({x1:h,y1:g,x2:h+2,y2:g+2,"stroke-width":1});a.append("line").attrs({x1:h,y1:f,x2:h-2,y2:f-2,"stroke-width":1});a.append("line").attrs({x1:h,y1:f,x2:h+2,y2:f-2,"stroke-width":1});
a.attr("stroke","rgb(150, 150, 150)").attr("transform","rotate("+k+","+b+","+d+")");return a},f=function(a){a=a.append("g");a.append("circle").attrs({cx:10,cy:10,r:7}).style("fill","rgb(75, 75, 75");a.append("line").attrs({x1:10,y1:1,x2:10,y2:19,"stroke-width":4});a.append("line").attrs({x1:1,y1:10,x2:19,y2:10,"stroke-width":4});a.append("line").attrs({x1:3.5,y1:3.5,x2:16.5,y2:16.5,"stroke-width":4});a.append("line").attrs({x1:16.5,y1:3.5,x2:3.5,y2:16.5,"stroke-width":4});a.append("circle").attrs({cx:10,
cy:10,r:3}).style("fill","white");return a},g=function(a){a=a.append("g");a.append("line").attrs({x1:10,y1:0,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:6,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:14,y1:7,x2:10,y2:12,"stroke-linecap":"round","stroke-width":3});a.append("line").attrs({x1:2,y1:16,x2:18,y2:16,"stroke-linecap":"round","stroke-width":3});return a},h=function(a,b,d,c,e,k){a=a.append("g").attr("class","cgv-menu-button");
a.append("rect").attr("x",0).attr("y",0).attr("width",c).attr("height",e).attr("rx",2).attr("ry",2).style({"stroke-width":1});var g=k.remove();a.append("g").attr("class","cgv-button-image").append(function(){return g.node()});a.attr("transform","translate("+b+".5,"+d+".5)");return a},l=d3.line().x(function(a){return a.x}).y(function(a){return a.y});c.Menu=b})(CGView);
(function(c){var b=function(a,b){b=void 0===b?{}:b;this._viewer=a;this._wrapper=a._wrapper.node();this.fadeTime=c.defaultFor(b.fadeTime,100);this.height=c.defaultFor(b.height,40);this.width=c.defaultFor(b.width,200);this.box=d3.select(this._wrapper).append("div").style("display","none").attr("class","cgv-messenger").style("width",this.height).style("height",this.width);this.contents=this.box.append("div").attr("class","cgv-messenger-contents");this._adjust_size();return this};b.prototype.toString=
function(){return"Messenger"};b.prototype.open=function(a){c.defaultFor(a,this.fadeTime);this._adjust_size();this.box.style("display","block");this.box.style("opacity",1);return this};b.prototype.close=function(a){a=c.defaultFor(a,this.fadeTime);this.box.transition().duration(a).style("opacity",0).on("end",function(){d3.select(this).style("display","none")});return this};b.prototype._adjust_size=function(){var a=this._wrapper.offsetWidth,b=this._wrapper.offsetHeight,c=this.width,e=this.height;this.height>
b-50&&(e=b-50);this.width>a-50&&(c=a-50);this.box.style("width",c+"px").style("height",e+"px")};b.prototype.flash=function(a){this.contents.html(a);this.open()};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},visible:{configurable:!0,enumerable:!0,get:function(){return"none"!=this.box.style("display")}},fadeTime:{configurable:!0,enumerable:!0,get:function(){return this._fadeTime},set:function(a){this._fadeTime=a}}});c.Messenger=b})(CGView);
(function(c){var b=function(a,b,c,e){this.x=a;this.y=b;this.width=c;this.height=e};b.prototype.overlap=function(a){for(var b=c.pixel(4),k=!1,e=0,f=a.length;e<f;e++)if(k=a[e],this.x<=k.right&&k.x<=this.right+b&&this.y<=k.bottom&&k.y<=this.bottom){k=!0;break}else k=!1;return k};b.prototype.containsPt=function(a,b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height};Object.defineProperties(b.prototype,{width:{configurable:!0,enumerable:!0,get:function(){return this._width},set:function(a){this._width=
a}},height:{configurable:!0,enumerable:!0,get:function(){return this._height},set:function(a){this._height=a}},x:{configurable:!0,enumerable:!0,get:function(){return this._x},set:function(a){this._x=a}},y:{configurable:!0,enumerable:!0,get:function(){return this._y},set:function(a){this._y=a}},bottom:{configurable:!0,enumerable:!0,get:function(){return this.y+this.height}},top:{configurable:!0,enumerable:!0,get:function(){return this.y}},left:{configurable:!0,enumerable:!0,get:function(){return this.x}},
right:{configurable:!0,enumerable:!0,get:function(){return this.x+this.width}}});c.Rect=b})(CGView);
(function(c){var b=function(a,b){b=void 0===b?{}:b;this._viewer=a;this.tickCount=c.defaultFor(b.tickCount,10);this.tickWidth=c.defaultFor(b.tickWidth,1);this.tickLength=c.defaultFor(b.tickLength,5);this.rulerPadding=c.defaultFor(b.rulerPadding,10);this.font=c.defaultFor(b.font,"sans-serif, plain, 10")};b.prototype._createTickFormatter=function(a){var b;50>=a?b=d3.formatPrefix(",.0",1):5E4>=a?(a=d3.precisionPrefix(a,1E3),b=d3.formatPrefix("."+a,1E3)):5E7>=a&&(a=d3.precisionPrefix(a,1E6),b=d3.formatPrefix("."+
a,1E6));return b};b.prototype._updateTicks=function(a,b){var k=this.sequence.length,e=0,f=0,g=new c.CGArray,h=0,l=new c.CGArray,m=0,l=this.tickCount;if(5>this.viewer.zoomFactor)e=1,f=k;else{var l=Math.ceil(l/2),m=this.canvas.visibleRangeForRadius(a),n=this.canvas.visibleRangeForRadius(b);m&&n?(f=m.mergeWithRange(n),e=f.start,f=f.stop):m?(e=m.start,f=m.stop):n&&(e=n.start,f=n.stop)}if(f>e)g.merge(d3.ticks(e,f,l)),h=d3.tickStep(e,f,l);else if(f<e)if(m=(k-e)/this.sequence.lengthOfRange(e,f),h=Math.round(l*
m),m=2*Math.round(l*(1-m)),0<h)for(g.merge(d3.ticks(e,k,h)),h=Math.round(d3.tickStep(e,k,h)),f=1;f<=m;f++)h*f<e&&g.push(h*f);else g.merge(d3.ticks(1,f,l)),h=Math.round(d3.tickStep(1,f,l));l=new c.CGArray;if(m=h%5?h%2?0:h/2:h/5){this.sequence.lengthOfRange(g[g.length-1],g[0])<=3*h?(e=0,f=k):(e=g[0]-h,f=g[g.length-1]+h);if(!(e<f)){for(;e<=k;e+=m)e%h&&l.push(e);e=0}for(;e<=f;e+=m)e%h&&l.push(e)}this._majorTicks=g;this._majorTickStep=h;this._minorTicks=l;this._minorTickStep=m;this._tickFormater=this._createTickFormatter(h)};
b.prototype.draw=function(a,b){this._updateTicks(a,b);this.drawForRadius(a,"inner");this.drawForRadius(b,"outer",!1)};b.prototype.drawForRadius=function(a,b,c){b=void 0===b?"inner":b;c=void 0===c?!0:c;var e=this,f=this.canvas.context("map"),g="inner"==b?-this.tickLength:this.tickLength;f.fillStyle="black";f.font=this.font.css;f.textAlign="left";f.textBaseline="top";this.canvas.radiantLine("map",1,a,g,2*this.tickWidth);this.majorTicks.each(function(f,l){e.canvas.radiantLine("map",l,a,g,e.tickWidth);
if(c){var m=e.tickFormater(l);e.drawLabel(l,m,a,b)}});this.minorTicks.each(function(b,d){e.canvas.radiantLine("map",d,a,g/2,e.tickWidth)})};b.prototype.drawLabel=function(a,b,k,e){var f=this.canvas.scale;e=this.canvas.context("map");b=b.replace(/([kM])?$/," $1bp");k=this.canvas.pointFor(a,k-this.rulerPadding);a=f.bp(a);a=c.clockPositionForAngle(a);f=this.font.width(e,b);k=c.rectOriginForAttachementPoint(k,a,f,this.font.height);e.fillText(b,k.x,k.y)};Object.defineProperties(b.prototype,{viewer:{configurable:!0,
enumerable:!0,get:function(){return this._viewer}},canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a)}},tickCount:{configurable:!0,enumerable:!0,get:function(){return this._tickCount},set:function(a){this._tickCount=a}},tickWidth:{configurable:!0,enumerable:!0,
get:function(){return this._tickWidth},set:function(a){this._tickWidth=c.pixel(a)}},tickLength:{configurable:!0,enumerable:!0,get:function(){return this._tickLength},set:function(a){this._tickLength=c.pixel(a)}},rulerPadding:{configurable:!0,enumerable:!0,get:function(){return this._rulerPadding},set:function(a){this._rulerPadding=c.pixel(a)}},majorTicks:{configurable:!0,enumerable:!0,get:function(){return this._majorTicks}},majorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._majorTickStep}},
minorTicks:{configurable:!0,enumerable:!0,get:function(){return this._minorTicks}},minorTickStep:{configurable:!0,enumerable:!0,get:function(){return this._minorTickStep}},tickFormater:{configurable:!0,enumerable:!0,get:function(){return this._tickFormater}}});c.Ruler=b})(CGView);
(function(c){var b=function(a,b){b=void 0===b?{}:b;this._viewer=a;this.color=c.defaultFor(b.color,"black");this.font=c.defaultFor(b.font,"sans-serif, plain, 14");this.seq=b.seq;this.seq||(this.length=b.length);this.length||(this.length=1E3)};b.complement=function(a){for(var b="",c,e,f=0,g=a.length;f<g;f++){c=a.charAt(f);switch(c){case "A":e="T";break;case "T":e="A";break;case "G":e="C";break;case "C":e="G"}b+=e}return b};b.baseCalculation=function(a,d){if("gc_content"==a)return b.calcGCContent(d);
if("gc_skew"==a)return b.calcGCSkew(d)};b.calcGCContent=function(a){if(0==a.length)return.5;var b=c.Sequence.count(a,"g"),k=c.Sequence.count(a,"c");return(b+k)/a.length};b.calcGCSkew=function(a){var b=c.Sequence.count(a,"g");a=c.Sequence.count(a,"c");return 0==b+a?.5:.5+(b-a)/(b+a)/2};b.reverseComplement=function(a){return b.complement(a.split("").reverse().join(""))};b.count=function(a,b){return(a.match(new RegExp(b,"gi"))||[]).length};b.prototype.reverseComplement=function(){return b.reverseComplement(this.seq)};
b.prototype.count=function(a){return b.count(this.seq,a)};b.prototype._updateScale=function(){this.canvas.scale.bp=d3.scaleLinear().domain([1,this.length]).range([-.5*Math.PI,1.5*Math.PI]);this.viewer._updateZoomMax()};b.prototype.lengthOfRange=function(a,b){return b>=a?b-a:this.length+(b-a)};b.prototype.subtractBp=function(a,b){return b<a?a-b:this.length+a-b};b.prototype.addBp=function(a,b){return this.length>=b+a?b+a:a-this.length+b};b.prototype.forRange=function(a){return this.seq?a.spansOrigin()?
this.seq.substr(a.start-1)+this.seq.substr(0,a.stop):this.seq.substr(a.start-1,a.length):this._fakeSequenceForRange(a)};b.prototype._fakeSequenceForRange=function(a){var b=[],c=a.start,e=0;for(a=a.length;e<a;e++){switch(c%4){case 0:b[e]="A";break;case 1:b[e]="T";break;case 2:b[e]="G";break;case 3:b[e]="C"}c++}return b};b.prototype._drawSequence=function(){var a=this.canvas.context("map"),b=c.pixel(this.zoomedRadius),k=this.visibleRange;if(k){var e=this._sequenceForRange(k),f=k.start;a.save();a.fillStyle=
this.fontColor.rgbaString;a.font=this.font.css;a.textAlign="center";a.textBaseline="middle";for(var g=this.bpSpacing/2+this.bpMargin,h=0,k=k.length;h<k;h++){var l=this.canvas.pointFor(f,b+g);a.fillText(e[h],l.x,l.y);l=this.canvas.pointFor(f,b-g);a.fillText(e[h],l.x,l.y);f++}a.restore()}};b.prototype.findPattern=function(a,b){b=void 0===b?1:b;for(var k=new RegExp(a,"g"),e=[],f,g,h=1==b?this.seq:this.reverseComplement();null!=(f=k.exec(h));)g=1==b?f.index+1:this.length-f.index-f[0].length+1,e.push(new c.CGRange(this,
g,g+f[0].length-1)),k.lastIndex=f.index+1;return e};b.prototype.featuresByReadingFrame=function(a){var b=this,k={rf_plus_1:new c.CGArray,rf_plus_2:new c.CGArray,rf_plus_3:new c.CGArray,rf_minus_1:new c.CGArray,rf_minus_2:new c.CGArray,rf_minus_3:new c.CGArray},e;a.each(function(a,c){-1==c.strand?(e=(b.length-c.stop+1)%3,0==e&&(e=3),k["rf_minus_"+e].push(c)):(e=c.start%3,0==e&&(e=3),k["rf_plus_"+e].push(c))});return k};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this._viewer}},
canvas:{configurable:!0,enumerable:!0,get:function(){return this.viewer.canvas}},seq:{configurable:!0,enumerable:!0,get:function(){return this._seq},set:function(a){(this._seq=a)?(this._seq=this._seq.toUpperCase(),this._length=a.length,this._updateScale(),this._sequenceExtractor=new c.SequenceExtractor(this)):this._sequenceExtractor=void 0}},sequenceExtractor:{configurable:!0,enumerable:!0,get:function(){return this._sequenceExtractor}},length:{configurable:!0,enumerable:!0,get:function(){return this._length},
set:function(a){a&&(this.seq?console.error("Can not change the sequence length of *seq* is set."):(this._length=Number(a),this._updateScale()))}},color:{configurable:!0,enumerable:!0,get:function(){return this._color},set:function(a){this._color="Color"==a.toString()?a:new c.Color(a)}},font:{configurable:!0,enumerable:!0,get:function(){return this._font},set:function(a){this._font="Font"==a.toString()?a:new c.Font(a);this.bpSpacing=this.font.size}},isLinear:{configurable:!0,enumerable:!0,get:function(){return!1}},
isCircular:{configurable:!0,enumerable:!0,get:function(){return!0}}});c.Sequence=b})(CGView);
(function(c){var b=function(a,b){this.sequence=a;if(!a.seq)throw"Sequence invalid. The sequence must be provided.";};b.prototype.extractFeatures=function(a){a=void 0===a?{}:a;var b=new c.CGArray;"start_stop_codons"==a.sequence?b=this.extractStartStops(a):"orfs"==a.sequence&&(b=this.extractORFs(a));return b};b.prototype.generateFeatures=function(a,b){var k=this;if(c.validate(b.sequence,["start_stop_codons","orfs"])){var e=(new Date).getTime(),f=b.sequence,g=this.viewer,h=this.fn2workerURL(c.WorkerFeatureExtraction),
h=new Worker(h),l={};l.type=f;l.startPattern=c.defaultFor(b.start,"ATG");l.stopPattern=c.defaultFor(b.stop,"TAA,TAG,TGA");l.seqString=this.seqString;l.minORFLength=c.defaultFor(b.minORFLength,100);h.postMessage(l);h.onmessage=function(b){var d=b.data.messageType;"progress"==d&&(a.loadProgress=b.data.progress,g.layout.drawProgress());if("complete"==d){a.loadProgress=100;b=b.data.featureDataArray;console.log("Features '"+f+"' Worker Time: "+c.elapsed_time(e));d=new c.CGArray;e=(new Date).getTime();
var h,l=k.createLegendItems(f);k.getFeatureType(f);console.log(f);for(var r=0,t=b.length;r<t;r++)h=b[r],h.legend=l[h.type],d.push(new c.Feature(g,h));console.log("Features '"+f+"' Creation Time: "+c.elapsed_time(e));e=(new Date).getTime();a._features=d;a.updateSlots();console.log("Features '"+f+"' Update Time: "+c.elapsed_time(e));g.drawFull()}};h.onerror=function(a){}}};b.prototype.createLegendItems=function(a){var b={};"orfs"==a?b={ORF:this.getLegendItem("ORF")}:"start_stop_codons"==a&&(b={"start-codon":this.getLegendItem("start-codon"),
"stop-codon":this.getLegendItem("stop-codon")});return b};b.prototype.extractORFs=function(a){a=void 0===a?{}:a;this.viewer.flash("Finding ORFs...");var b=(new Date).getTime(),k=new c.CGArray,e=c.defaultFor(a.minORFLength,100),f=c.defaultFor(a.start,"ATG"),f=this.createFeaturesFromPattern(f,"start-codon","start-stop-codons"),f=this.sequence.featuresByReadingFrame(f);a=c.defaultFor(a.stop,"TAA,TAG,TGA");a=this.createFeaturesFromPattern(a,"start-codon","start-stop-codons");a=this.sequence.featuresByReadingFrame(a);
var g,h;g=["rf_plus_1","rf_plus_2","rf_plus_3"];var l,m,n,q=$jscomp.makeIterator(g);for(g=q.next();!g.done;g=q.next()){var p=g.value;g=1;for(var r=n=0,t=f[p].length;r<t;r++)if(l=f[p][r],!(l.start<g))for(var u=n,v=a[p].length;u<v;u++)if(m=a[p][u],h=m.stop-l.start,h>=e){g=m.stop;h=new c.CGRange(this.sequence,l.start,m.stop);k.push(this.createFeature(h,"ORF",1,"orfs"));n=u;break}}g=["rf_minus_1","rf_minus_2","rf_minus_3"];q=$jscomp.makeIterator(g);for(g=q.next();!g.done;g=q.next())for(p=g.value,n=0,
g=this.sequence.length,f[p].order_by("start",!0),a[p].order_by("start",!0),r=0,t=f[p].length;r<t;r++)if(l=f[p][r],!(l.start>g))for(u=n,v=a[p].length;u<v;u++)if(m=a[p][u],h=l.stop-m.start,h>=e){g=m.start;h=new c.CGRange(this.sequence,m.start,l.stop);k.push(this.createFeature(h,"ORF",-1,"orfs"));n=u;break}console.log("ORF Extraction Time: "+c.elapsed_time(b));return k};b.prototype.extractStartStops=function(a){a=void 0===a?{}:a;this.viewer.flash("Finding Start/Stop Codons...");var b=(new Date).getTime(),
k=c.defaultFor(a.start,"ATG"),k=this.createFeaturesFromPattern(k,"start-codon","start-stop-codons");a=c.defaultFor(a.stop,"TAA,TAG,TGA");k.merge(this.createFeaturesFromPattern(a,"stop-codon","start-stop-codons"));console.log("Start/Stop Extraction Time: "+c.elapsed_time(b));return k};b.prototype.createFeaturesFromPattern=function(a,b,k){var e=new c.CGArray;a=a.toUpperCase().split(",").map(function(a){return a.trim()}).join("|");for(var f=$jscomp.makeIterator([1,-1]),g=f.next();!g.done;g=f.next())for(var g=
g.value,h=this.sequence.findPattern(a,g),l=0,m=h.length;l<m;l++)e.push(this.createFeature(h[l],b,g,k));return e.order_by("start")};b.prototype.createFeature=function(a,b,k,e){a={type:b,start:a.start,stop:a.stop,strand:k,source:e,extractedFromSequence:!0};a.legend=this.getLegendItem(b).text;return new c.Feature(this.viewer,a)};b.prototype.getFeatureType=function(a){var b=this.viewer;switch(a){case "start_stop_codons":a=b.findFeatureTypeOrCreate("Codon","arc");break;case "orfs":a=b.findFeatureTypeOrCreate("ORF",
"arrow");break;default:a=b.findFeatureTypeOrCreate("Unknown","arc")}return a};b.prototype.getLegendItem=function(a,b){var c=this.viewer.legend;switch(a){case "start-codon":c=c.findLegendItemOrCreate("Start","blue");break;case "stop-codon":c=c.findLegendItemOrCreate("Stop","red");break;case "ORF":c=c.findLegendItemOrCreate("ORF","green");break;case "gc_content":c=c.findLegendItemOrCreate("GC Content","black");break;case "gc_skew":c=c.findLegendItemOrCreate("+"==b?"GC Skew+":"GC Skew-","+"==b?"rgb(0,153,0)":
"rgb(153,0,153)");break;default:c=c.findLegendItemOrCreate("Unknown","grey")}return c};b.prototype.fn2workerURL=function(a){a=new Blob(["("+a.toString()+")()"],{type:"application/javascript"});return URL.createObjectURL(a)};b.prototype.generatePlot=function(a,b){b=void 0===b?{}:b;var k=this;if(c.validate(b.sequence,["gc_content","gc_skew"])){var e=(new Date).getTime(),f=b.sequence,g=this.viewer,h=this.fn2workerURL(c.WorkerBaseContent),h=new Worker(h),l={};l.type=f;l.window=c.defaultFor(b.window,this.getWindowStep().window);
var m=c.defaultFor(b.step,this.getWindowStep().step);l.step=m;l.deviation=c.defaultFor(b.deviation,"scale");l.seqString=this.seqString;h.postMessage(l);h.onmessage=function(b){var d=b.data.messageType;"progress"==d&&(a.loadProgress=b.data.progress,g.layout.drawProgress());"complete"==d&&(b=b.data.baseContent,b={positions:b.positions,scores:b.scores,baseline:b.average},b.legendPositive=k.getLegendItem(f,"+").text,b.legendNegative=k.getLegendItem(f,"-").text,b=new c.ArcPlot(g,b),a._arcPlot=b,a.updateSlots(),
console.log("Plot '"+f+"' Worker Time: "+c.elapsed_time(e)),g.drawFull())};h.onerror=function(a){}}};b.prototype.getWindowStep=function(){var a,b,c=this.length;1E3>c?(a=10,b=1):1E4>c?(a=50,b=1):1E5>c?(a=500,b=1):1E6>c?(a=1E3,b=10):1E7>c&&(a=1E4,b=100);return{step:b,window:a}};Object.defineProperties(b.prototype,{sequence:{configurable:!0,enumerable:!0,get:function(){return this._sequence},set:function(a){a&&(this._sequence=a)}},seqString:{configurable:!0,enumerable:!0,get:function(){return this.sequence.seq}},
viewer:{configurable:!0,enumerable:!0,get:function(){return this.sequence.viewer}},length:{configurable:!0,enumerable:!0,get:function(){return this.sequence.length}}});c.SequenceExtractor=b})(CGView);
(function(c){var b=function(a,b,k,e){b=void 0===b?{}:b;this.track=a;this._strand=c.defaultFor(b.strand,"direct");this._features=new c.CGArray;this._arcPlot;this.proportionOfRadius=c.defaultFor(b.proportionOfRadius,.1);this.type="plot"==b.type?"plot":"feature";this._featureStarts=new c.CGArray};b.prototype.isDirect=function(){return"direct"==this.strand};b.prototype.isReverse=function(){return"reverse"==this.strand};b.prototype.replaceFeatures=function(a){this._features=a;this.refresh()};b.prototype.pixelsPerBp=
function(){return 2*this.radius*Math.PI/this.sequence.length};b.prototype.refresh=function(){this._featureStarts=new c.CGArray;for(var a=0,b=this._features.length;a<b;a++)this._featureStarts.push(this._features[a].start);this._largestFeatureLength=this.findLargestFeatureLength()};b.prototype.findLargestFeatureLength=function(){for(var a=0,b,c=0,e=this._features.length;c<e;c++)b=this._features[c].length,b>a&&(a=b);return a};b.prototype.clear=function(){var a=this._visibleRange;if(a){var b=this.radius,
c=this.thickness,e=this.viewer.canvas.context("map");e.globalCompositeOperation="destination-out";this.viewer.canvas.drawArc("map",a.start,a.stop,b,"white",c);e.globalCompositeOperation="source-over"}};b.prototype.draw=function(a,b){var c=this.radius,e=this.thickness,f=a.visibleRangeForRadius(c,e);if(this._visibleRange=f){var g=f.start,h=f.stop;if(this.hasFeatures){var l=this,m=this._features.length,n=this.largestFeatureLength;n<=this.sequence.length-Math.abs(g-h)&&this.sequence.subtractBp(g,h)>n&&
(g=f.getStartPlus(-n),m=this._featureStarts.countFromRange(g,h));n=1;b&&m>this.layout.fastFeaturesPerSlot&&(n=Math.pow(2,Math.ceil(Math.log(Math.ceil(m/this.layout.fastFeaturesPerSlot))/Math.log(2))));this._featureStarts.eachFromRange(g,h,n,function(b){l._features[b].draw(a,c,e,f)});this.viewer.debug&&this.viewer.debug.data.n&&(g=this.viewer._slots.indexOf(this),this.viewer.debug.data.n["slot_"+g]=m)}else this.hasArcPlot&&this._arcPlot.draw(a,c,e,b,f)}};b.prototype.drawProgress=function(a){var b=
this.viewer.canvas,c=this.radius,e=this.thickness,f=this._visibleRange;0<a&&100>a&&f&&b.drawArc("background",f.start,f.stop,c,"#EAEAEE",e*a/100)};Object.defineProperties(b.prototype,{track:{configurable:!0,enumerable:!0,get:function(){return this._track},set:function(a){this._track=a;a._slots.push(this)}},layout:{configurable:!0,enumerable:!0,get:function(){return this.track.layout}},viewer:{configurable:!0,enumerable:!0,get:function(){return this.track.viewer}},sequence:{configurable:!0,enumerable:!0,
get:function(){return this.viewer.sequence}},position:{configurable:!0,enumerable:!0,get:function(){return"both"==this.track.position?this.isDirect()?"outside":"inside":this.track.position}},inside:{configurable:!0,enumerable:!0,get:function(){return"inside"==this.position}},outside:{configurable:!0,enumerable:!0,get:function(){return"outside"==this.position}},proportionOfRadius:{configurable:!0,enumerable:!0,get:function(){return this._proportionOfRadius},set:function(a){this._proportionOfRadius=
a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._radius}},thickness:{configurable:!0,enumerable:!0,get:function(){return this._thickness}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand}},hasFeatures:{configurable:!0,enumerable:!0,get:function(){return 0<this._features.length}},hasArcPlot:{configurable:!0,enumerable:!0,get:function(){return this._arcPlot}},visibleRange:{configurable:!0,enumerable:!0,get:function(){return this._visibleRange}},largestFeatureLength:{configurable:!0,
enumerable:!0,get:function(){return this._largestFeatureLength}}});c.Slot=b})(CGView);
(function(c){var b=function(a,b,k,e){b=void 0===b?{}:b;this.layout=a;this._arcPlot;this._features=new c.CGArray;this._slots=new c.CGArray;this.readingFrame=c.defaultFor(b.readingFrame,"combined");this.strand=c.defaultFor(b.strand,"separated");this.position=c.defaultFor(b.position,"both");this.contents=b.contents;this.loadProgress=0;this.refresh()};b.prototype.features=function(a){return this._features.get(a)};b.prototype.refresh=function(){"features"==this.contentType?this.updateFeatures():"plot"==
this.contentType&&this.updatePlot();this.updateSlots()};b.prototype.updatePlot=function(){if(this.contents.plot.sequence){var a=this.viewer.sequence.sequenceExtractor;a&&a.generatePlot(this,this.contents.plot)}};b.prototype.updateFeatures=function(){this._features=new c.CGArray;if(this.contents.features.sequence)this.viewer.sequence.sequenceExtractor?this.extractFeaturesFromSequence():console.error("No sequence is available to extract features from");else if(this.contents.features.source){var a=this;
this.viewer.features().each(function(b,d){d.source==a.contents.features.source&&a._features.push(d)})}else if(this.contents.features.types){var b=this,k=new c.CGArray(this.contents.features.types);this.viewer.features().each(function(a,c){k.contains(c.type)&&b._features.push(c)})}};b.prototype.extractFeaturesFromSequence=function(){var a=this.viewer.sequence.sequenceExtractor;a&&a.generateFeatures(this,this.contents.features)};b.prototype.updateSlots=function(){"features"==this.contentType?this.updateFeatureSlots():
"plot"==this.contentType&&this.updatePlotSlot();this.layout._adjustProportions()};b.prototype.updateFeatureSlots=function(){this._slots=new c.CGArray;if("separated"==this.readingFrame){for(var a=this.sequence.featuresByReadingFrame(this.features()),b=$jscomp.makeIterator([1,2,3]),k=b.next();!k.done;k=b.next()){var k=k.value,e=new c.Slot(this,{strand:"direct"});e.replaceFeatures(a["rf_plus_"+k])}b=$jscomp.makeIterator([1,2,3]);for(k=b.next();!k.done;k=b.next())k=k.value,e=new c.Slot(this,{strand:"reverse"}),
e.replaceFeatures(a["rf_minus_"+k])}else"separated"==this.strand?(a=this.featuresByStrand(),e=new c.Slot(this,{strand:"direct"}),e.replaceFeatures(a.direct),e=new c.Slot(this,{strand:"reverse"}),e.replaceFeatures(a.reverse)):"combined"==this.strand&&(e=new c.Slot(this,{strand:"direct"}),e.replaceFeatures(this.features()))};b.prototype.featuresByStrand=function(){var a={};a.direct=new c.CGArray;a.reverse=new c.CGArray;this.features().each(function(b,c){-1==c.strand?a.reverse.push(c):a.direct.push(c)});
return a};b.prototype.updatePlotSlot=function(){this._slots=new c.CGArray;(new c.Slot(this,{type:"plot"}))._arcPlot=this._arcPlot};Object.defineProperties(b.prototype,{viewer:{configurable:!0,enumerable:!0,get:function(){return this.layout.viewer}},layout:{configurable:!0,enumerable:!0,get:function(){return this._layout},set:function(a){this._layout=a;a._tracks.push(this)}},contents:{configurable:!0,enumerable:!0,get:function(){return this._contents},set:function(a){this._contents=a;this._contentType=
a.features?"features":a.plot?"plot":void 0}},contentType:{configurable:!0,enumerable:!0,get:function(){return this._contentType}},sequence:{configurable:!0,enumerable:!0,get:function(){return this.viewer.sequence}},strand:{configurable:!0,enumerable:!0,get:function(){return this._strand},set:function(a){c.validate(a,["separated","combined"])&&(this._strand=a,this.updateSlots())}},readingFrame:{configurable:!0,enumerable:!0,get:function(){return this._readingFrame},set:function(a){c.validate(a,["separated",
"combined"])&&(this._readingFrame=a,this.updateSlots())}},position:{configurable:!0,enumerable:!0,get:function(){return this._position},set:function(a){c.validate(a,["inside","outside","both"])&&(this._position=a)}},loadProgress:{configurable:!0,enumerable:!0,get:function(){return this._loadProgress},set:function(a){this._loadProgress=a}}});c.Track=b})(CGView);
(function(c){c.testSearch=function(b){var a=/ATG/igm,d=[],k="";console.log("Making Sequence...");for(var e=0;e<b;e++)k+="ATCG".charAt(Math.floor(4*Math.random()));window.seq=k;console.log("Finding Pattern...");for(b=(new Date).getTime();match=a.exec(k);)d.push(match.index);console.log("ATGs found: "+d.length);console.log("Time: "+c.elapsed_time(b))};c.defaultFor=function(b,a){return void 0===b?a:b};c.validate=function(b,a){if(-1!=a.indexOf(b))return!0;console.error("The value '"+b+"' is not one of the following: "+
a.join(", "));return!1};c.booleanify=function(b){return"false"==b||"False"==b||void 0==b||0==b?!1:!0};c.pixelRatio=1;c.pixel=function(b){return b*c.pixelRatio};c.getPixelRatio=function(b){b=b.getContext("2d");return(window.devicePixelRatio||1)/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1)};c.scaleResolution=function(b,a){if(1!=a){var d=b.width,c=b.height;b.width=d*a;b.height=c*a;b.style.width=d+"px";
b.style.height=c+"px"}};c.elapsed_time=function(b){return(new Date).getTime()-b+" ms"};c.angleFromPosition=function(b,a){var d=.5*Math.PI;0!=b&&(d=Math.atan(Math.abs(a/b)));0<=a&&0<=b?d=0-d:0>a&&0<=b||(0>a&&0>b?d=Math.PI-d:0<=a&&0>b&&(d=Math.PI+d));return d};c.clockPositionForAngle=function(b){b=Math.round(6/Math.PI*(b+Math.PI/2));12<b?b-=12:1>b&&(b+=12);return b};c.rectOriginForAttachementPoint=function(b,a,d,c){var e,f;switch(a){case 1:e=b.x-3*d/4;f=b.y;break;case 2:e=b.x-d;f=b.y;break;case 3:e=
b.x-d;f=b.y-c/2;break;case 4:e=b.x-d;f=b.y-c;break;case 5:e=b.x-3*d/4;f=b.y-c;break;case 6:e=b.x-d/2;f=b.y-c;break;case 7:e=b.x-d/4;f=b.y-c;break;case 8:e=b.x;f=b.y-c;break;case 9:e=b.x;f=b.y-c/2;break;case 10:e=b.x;f=b.y;break;case 11:e=b.x-d/4;f=b.y;break;case 12:e=b.x-d/2,f=b.y}return{x:e,y:f}};c.round=function(b,a){return Number(b.toFixed(a||2))};c.dotProduct=function(b,a){for(var d=0,c=0,e=b.length;c<e;c++)d+=b[c]*a[c];return d};c.pointsAdd=function(b,a){var d=[0,0];d[0]=b[0]+a[0];d[1]=b[1]+
a[1];return d};c.pointsSubtract=function(b,a){var d=[0,0];d[0]=b[0]-a[0];d[1]=b[1]-a[1];return d};c.circleAnglesFromIntersectingLine=function(b,a,d,k,e){var f=c.pointsSubtract([k,e],[a,d]),g=[a,d],h=c.dotProduct(f,f),f=2*c.dotProduct(g,f);b=c.dotProduct(g,g)-b*b;var l=f*f-4*h*b;b={};0<=l&&(l=Math.sqrt(l),g=(-f-l)/(2*h),h=(-f+l)/(2*h),0<=g&&1>=g&&(b.t1=c.angleFromPosition(a+g*(k-a),d+g*(e-d))),0<=h&&1>=h&&(b.t2=c.angleFromPosition(a+h*(k-a),d+h*(e-d))));return b};c.circleAnglesFromIntersectingRect=
function(b,a,d,k,e){var f=[];f.push(c.circleAnglesFromIntersectingLine(b,a,d,a+k,d));f.push(c.circleAnglesFromIntersectingLine(b,a+k,d,a+k,d-e));f.push(c.circleAnglesFromIntersectingLine(b,a+k,d-e,a,d-e));f.push(c.circleAnglesFromIntersectingLine(b,a,d-e,a,d));f=f.filter(function(a){return 0<Object.keys(a).length});0<f.length&&(b=Object.keys(f[0]),1==b.length&&"t1"==b[0]&&f.push(f.shift()),2==b.length&&(f.push({t1:f[0].t1}),f[0].t1=void 0),f=f.map(function(a){var b=[];void 0!=a.t1&&b.push(a.t1);void 0!=
a.t2&&b.push(a.t2);return b}),f=[].concat.apply([],f));return f};c.indexOfValue=function(b,a,d){var c=0,e=b.length-1,f,g;if(b[c]>=a)return c;if(b[e]<=a)return e;for(;1<e-c;)if(f=(c+e)/2|0,g=b[f],g<a)c=f;else if(g>a)e=f;else return f;return d?e:c};c.oppositeSigns=function(b,a){return 0>b*a};c.merge=function(){for(var b={},a,d,c,e=0,f=arguments.length;e<f;e++)if(a=arguments[e],"object"===typeof a){d=Object.keys(a);for(var g=0,h=d.length;g<h;g++)c=d[g],b[c]=a[c]}return b};c.scaleValue=function(b,a,d){a=
void 0===a?{min:0,max:1}:a;d=void 0===d?{min:0,max:1}:d;return(d.max-d.min)*(b-a.min)/(a.max-a.min)+d.min}})(CGView);
(function(c){c.Viewer.prototype.initialize_dragging=function(){var b=this;b._drag=d3.drag().on("start",function(){d3.select(b.canvas.node("ui")).style("cursor","all-scroll")}).on("drag",function(){var a=(new Date).getTime();domain_x=b.scale.x.domain();domain_y=b.scale.y.domain();var d=c.pixel(d3.event.dx),k=c.pixel(d3.event.dy);b.scale.x.domain([domain_x[0]-d,domain_x[1]-d]);b.scale.y.domain([domain_y[0]+k,domain_y[1]+k]);b.drawFast();b.debug&&(b.debug.data.time.drag=c.elapsed_time(a))}).on("end",
function(){b.drawFull()});d3.select(b.canvas.node("ui")).call(b._drag)}})(CGView);
(function(c){c.Viewer.prototype._updateZoomMax=function(){this._zoom&&this._zoom.scaleExtent([.8,this.backbone.maxZoomFactor()])};c.Viewer.prototype.initialize_zooming=function(){var b=this,a=this.backbone.maxZoomFactor();b._zoom=d3.zoom().scaleExtent([1,a]).on("start",function(){}).on("zoom",function(){var a=(new Date).getTime(),k=d3.mouse(b.canvas.node("ui")),e=b.scale.x.invert(c.pixel(k[0])),f=b.scale.y.invert(c.pixel(k[1])),k=b.backbone.zoomedRadius,f=c.angleFromPosition(e,f);b._zoomFactor=d3.event.transform.k;
var k=k-b.backbone.zoomedRadius,e=c.pixel(Math.cos(-f)*k),k=c.pixel(Math.sin(-f)*k),f=b.scale.x.domain(),g=b.scale.y.domain();b.scale.x.domain([f[0]-e,f[1]-e]);b.scale.y.domain([g[0]-k,g[1]-k]);b.drawFast();b.debug&&(b.debug.data.time&&(b.debug.data.time.zoom=c.elapsed_time(a)),b.debug.data.zoom&&(b.debug.data.zoom.scale=c.round(b._zoomFactor,1)))}).on("end",function(){b.drawFull()});d3.select(b.canvas.node("ui")).call(b._zoom).on("dblclick.zoom",null)}})(CGView);
(function(c){c.WorkerFeatureExtraction=function(){onmessage=function(b){var a,d=b.data.type;console.log("Starting "+d);var c=[];"start_stop_codons"==d?(a={start:0,stop:50},c=extractStartStopCodons(1,b.data,a),a={start:50,stop:100},c=c.concat(extractStartStopCodons(-1,b.data,a))):"orfs"==d&&(c=extractORFs(b.data));c.sort(function(a,b){return a.start-b.start});postMessage({messageType:"complete",featureDataArray:c});console.log("Done "+d)};onerror=function(b){console.error("Oops. Problem with "+b.data.type)};
extractStartStopCodons=function(b,a,d){d=void 0===d?{}:d;var c=0,e=0,f=1==b?a.seqString:reverseComplement(a.seqString),g=a.startPattern.toUpperCase().split(",").map(function(a){return a.trim()}).join("|");a=a.stopPattern.toUpperCase().split(",").map(function(a){return a.trim()}).join("|");var h=g+"|"+a,g=g.split("|");a=a.split("|");for(var h=new RegExp(h,"g"),l,m,n,q=f.length,p=[];null!=(l=h.exec(f));)c=1==b?l.index+1:q-l.index-l[0].length+1,0<=g.indexOf(l[0])?n="start-codon":0<=a.indexOf(l[0])&&
(n="stop-codon"),m={type:n,start:c,stop:c+l[0].length-1,strand:b,source:"start-stop-codons",extractedFromSequence:!0},p.push(m),c=Math.round(1==b?c/q*100:(q-c)/q*100),e=postProgress(c,e,d),h.lastIndex=l.index+1;return p};postProgress=function(b,a,d){d=void 0===d?{}:d;var c=d.start||0,e=d.increment||1;d=(d.stop||100)-c;b>a&&0==b%e&&(a=b,b=c+d*b/100,0==b%e&&postMessage({messageType:"progress",progress:b}));return a};extractORFs=function(b){var a=b.minORFLength,d=b.seqString.length,c=[],e={start:0,stop:25},
c=extractStartStopCodons(1,b,e),e={start:25,stop:50},c=c.concat(extractStartStopCodons(-1,b,e)),e=c.filter(function(a){return"start-codon"==a.type}),c=c.filter(function(a){return"stop-codon"==a.type});b=featuresByReadingFrame(e,d);var f=featuresByReadingFrame(c,d),e={start:50,stop:75},c=orfsByStrand(1,b,f,a,d,e),e={start:75,stop:100};return c=c.concat(orfsByStrand(-1,b,f,a,d,e))};orfsByStrand=function(b,a,d,c,e,f){f=void 0===f?{}:f;var g,h,l,m,n,q,p,r,t,u=[],v=1==b?["rf_plus_1","rf_plus_2","rf_plus_3"]:
["rf_minus_1","rf_minus_2","rf_minus_3"];v.forEach(function(w){g=1==b?1:e;p=0;l=a[w];m=d[w];progressInitial=33*v.indexOf(w);t=r=0;-1==b&&(l.sort(function(a,b){return b.start-a.start}),m.sort(function(a,b){return b.start-a.start}));for(var x=0,y=l.length;x<y;x++)if(n=l[x],r=progressInitial+Math.round(x/y*33),t=postProgress(r,t,f),!(1==b&&n.start<g||-1==b&&n.start>g))for(var z=p,A=d[w].length;z<A;z++)if(q=m[z],h=1==b?q.stop-n.start:n.stop-q.start,h>=c){g=1==b?q.stop:q.start;featureData={type:"ORF",
start:1==b?n.start:q.start,stop:1==b?q.stop:n.stop,strand:b,source:"orfs",extractedFromSequence:!0};u.push(featureData);p=z;break}else if(0<h){g=1==b?q.stop:q.start;p=z;break}});return u};reverseComplement=function(b){return complement(b.split("").reverse().join(""))};complement=function(b){for(var a="",d,c,e=0,f=b.length;e<f;e++){d=b.charAt(e);switch(d){case "A":c="T";break;case "T":c="A";break;case "G":c="C";break;case "C":c="G"}a+=c}return a};featuresByReadingFrame=function(b,a){for(var d={rf_plus_1:[],
rf_plus_2:[],rf_plus_3:[],rf_minus_1:[],rf_minus_2:[],rf_minus_3:[]},c,e,f=0,g=b.length;f<g;f++)e=b[f],-1==e.strand?(c=(a-e.stop+1)%3,0==c&&(c=3),d["rf_minus_"+c].push(e)):(c=e.start%3,0==c&&(c=3),d["rf_plus_"+c].push(e));return d}}})(CGView);
(function(c){c.WorkerBaseContent=function(){onmessage=function(b){console.log("Starting "+b.data.type);calculateBaseContent(b.data);console.log("Done "+b.data.type)};onerror=function(b){console.error("Oops. Problem with "+b.data.type)};calculateBaseContent=function(b){var a=0,c=0,k=[],e=[],f=b.type,g=b.seqString,h=b.window,l=b.step;b=b.deviation;for(var m=baseCalculation(f,g),n=1,q=0,h=h/2,p,r=1,t=g.length;r<t;r+=l)a=subtractBp(g,r,h),p=addBp(g,r,h),a=subSequence(g,a,p),a=baseCalculation(f,a),a>q&&
(q=a),a<n&&(n=a),1==r?k.push(1):k.push(r-l/2),e.push(a),a=Math.round(r/t*100),a>c&&0==a%1&&(c=a,postMessage({messageType:"progress",progress:a}));"scale"==b&&(e=e.map(function(a){return a>=m?scaleValue(a,{min:m,max:q},{min:.5,max:1}):scaleValue(a,{min:n,max:m},{min:0,max:.5})}),n=0,q=1,m=.5);postMessage({messageType:"complete",baseContent:{positions:k,scores:e,min:n,max:q,average:m}})};baseCalculation=function(b,a){if("gc_content"==b)return calcGCContent(a);if("gc_skew"==b)return calcGCSkew(a)};calcGCContent=
function(b){if(0==b.length)return.5;var a=count(b,"g"),c=count(b,"c");return(a+c)/b.length};calcGCSkew=function(b){var a=count(b,"g");b=count(b,"c");return 0==a+b?.5:.5+(a-b)/(a+b)/2};count=function(b,a){return(b.match(new RegExp(a,"gi"))||[]).length};subtractBp=function(b,a,c){return c<a?a-c:b.length+a-c};addBp=function(b,a,c){return b.length>=c+a?c+a:a-b.length+c};subSequence=function(b,a,c){return c<a?b.substr(a-1)+b.substr(0,c):b.substr(a-1,c-a)};scaleValue=function(b,a,c){a=void 0===a?{min:0,
max:1}:a;c=void 0===c?{min:0,max:1}:c;return(c.max-c.min)*(b-a.min)/(a.max-a.min)+c.min}}})(CGView);
